import{c as M,a as g,r as o,j as e,f as I,U as v,T as N,X as P,m as T}from"./index-me4rMZUI.js";import{a as q,A as y}from"./Adjuntos-C2TXHFt3.js";import{R as D}from"./ResolutionModal-CWYf7WvS.js";import{P as F}from"./plus-CVOr2pzG.js";import{Z as $}from"./zap-rWVicgmD.js";import{C as L}from"./circle-check-BYdJYVN6.js";import{M as O}from"./map-pin-CvzHop5b.js";import{K as Z,A as w}from"./kanban-bfDQDT4Q.js";import"./upload-DDQq8R06.js";import"./eye-CL1ozEkO.js";import"./download-CohkA6dt.js";import"./chevron-right-BtOXaLSJ.js";const _=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],U=M("shield-alert",_),c={Activa:{bg:"bg-accent-red/20",text:"text-accent-red",dot:"bg-accent-red"},"En reparación":{bg:"bg-accent-yellow/20",text:"text-accent-yellow",dot:"bg-accent-yellow"},Coordinando:{bg:"bg-accent-blue/20",text:"text-accent-blue",dot:"bg-accent-blue"},Resuelta:{bg:"bg-accent-green/20",text:"text-accent-green",dot:"bg-accent-green"}};function re(){const a=g(t=>t.averias),A=g(t=>t.addAveria),h=g(t=>t.updateAveria),[C,l]=o.useState(!1),[r,d]=o.useState(null),[i,R]=o.useState("all"),[f,j]=o.useState([]),[k,m]=o.useState(!1),[p,u]=o.useState(null);o.useEffect(()=>{if(r){const t=a.find(s=>s.id===r.id);t&&t!==r&&d(t)}},[a,r]);const z=o.useMemo(()=>i==="all"?a:a.filter(t=>t.estado===i),[a,i]),x=o.useMemo(()=>({activas:a.filter(t=>t.estado==="Activa").length,enReparacion:a.filter(t=>t.estado==="En reparación").length,resueltas:a.filter(t=>t.estado==="Resuelta").length,totalAfectados:a.filter(t=>t.estado!=="Resuelta").reduce((t,s)=>t+s.clientesAfectados,0)}),[a]),S=t=>{t.preventDefault();const s=new FormData(t.target);A({tipo:s.get("tipo"),zona:s.get("zona"),nodo:s.get("nodo"),clientesAfectados:parseInt(s.get("afectados"))||0,estado:"Activa",prioridad:s.get("prioridad"),reportadoPor:s.get("reportado"),tecnicoAsignado:s.get("tecnico"),descripcion:s.get("descripcion"),adjuntos:f}),l(!1),j([])},n=(t,s)=>{s==="Resuelta"?(u(t),m(!0)):h(t,{estado:s,_historyComment:"Cambio de estado manual desde detalle"})},E=({solucion:t,accionesRealizadas:s,adjuntosResolucion:b})=>{p&&(h(p,{estado:"Resuelta",fechaResolucion:new Date().toISOString().split("T")[0],solucion:t,accionesRealizadas:s,adjuntosResolucion:b,_historyComment:"Avería resuelta con informe de solución"}),m(!1),u(null))};return e.jsxs("div",{className:"animate-fade p-6 px-8 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-[26px] font-bold tracking-tight",children:"Averias e Incidencias"}),e.jsx("p",{className:"text-text-secondary text-sm mt-1",children:"Gestión de fallas de red e infraestructura"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"py-2.5 px-4 rounded-xl bg-accent-red border-none text-white text-sm font-semibold cursor-pointer flex items-center gap-2 hover:opacity-90 transition-opacity",children:[e.jsx(F,{size:16})," Reportar Avería"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-red/15 text-accent-red",children:e.jsx($,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:x.activas}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"Activas"})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-yellow/15 text-accent-yellow",children:e.jsx(I,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:x.enReparacion}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"En reparación"})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-green/15 text-accent-green",children:e.jsx(L,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:x.resueltas}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"Resueltas"})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-purple/15 text-accent-purple",children:e.jsx(v,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:x.totalAfectados}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"Afectados"})]})]})]}),e.jsx("div",{className:"flex gap-3 mb-5",children:["all","Activa","En reparación","Coordinando","Resuelta"].map(t=>e.jsx("button",{onClick:()=>R(t),className:`py-1.5 px-4 rounded-lg text-xs font-semibold border cursor-pointer transition-colors
              ${i===t?"bg-accent-blue/20 border-accent-blue text-accent-blue":"bg-bg-secondary border-border text-text-secondary hover:border-accent-blue/50"}`,children:t==="all"?"Todas":t},t))}),e.jsx("div",{className:"flex flex-col gap-3",children:z.map(t=>{const s=c[t.estado]||c.Activa;return e.jsxs("div",{onClick:()=>d(t),className:"bg-bg-card rounded-xl p-5 border border-border transition-all hover:border-accent-red/30 cursor-pointer group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center bg-accent-red/15 text-accent-red group-hover:bg-accent-red/25 transition-colors",children:e.jsx(N,{size:16})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs text-text-muted",children:t.id}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-bold ${s.bg} ${s.text}`,children:t.estado}),e.jsx("span",{className:`text-[11px] font-bold ${t.prioridad==="Crítica"?"text-accent-red":"text-accent-yellow"}`,children:t.prioridad})]}),e.jsx("p",{className:"text-sm font-semibold mt-0.5",children:t.tipo})]})]}),e.jsx("span",{className:"text-[11px] text-text-muted",children:t.fecha})]}),e.jsx("p",{className:"text-xs text-text-secondary mb-3",children:t.descripcion}),e.jsxs("div",{className:"flex items-center gap-6 text-[11px] text-text-muted",children:[e.jsxs("span",{children:["Zona: ",e.jsx("span",{className:"text-text-secondary font-medium",children:t.zona})]}),e.jsxs("span",{children:["Nodo: ",e.jsx("span",{className:"text-text-secondary font-medium font-mono",children:t.nodo})]}),e.jsxs("span",{children:["Afectados: ",e.jsx("span",{className:"text-accent-red font-bold",children:t.clientesAfectados})]}),e.jsxs("span",{children:["Técnico: ",e.jsx("span",{className:"text-text-secondary",children:t.tecnicoAsignado})]}),e.jsx(q,{count:t.adjuntos?.length})]})]},t.id)})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>l(!1),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-[500px] border border-border",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Reportar Avería"}),e.jsxs("form",{onSubmit:S,className:"flex flex-col gap-3",children:[e.jsxs("select",{name:"tipo",required:!0,className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg p-2.5 text-sm outline-none focus:border-accent-blue",children:[e.jsx("option",{value:"Corte de fibra",children:"Corte de fibra"}),e.jsx("option",{value:"Caída de nodo",children:"Caída de nodo"}),e.jsx("option",{value:"Interferencia",children:"Interferencia"}),e.jsx("option",{value:"Falla eléctrica",children:"Falla eléctrica"}),e.jsx("option",{value:"Daño de equipo",children:"Daño de equipo"}),e.jsx("option",{value:"Otra",children:"Otra"})]}),e.jsx("input",{name:"zona",placeholder:"Zona afectada (ej: PLANICIE 1)",required:!0,className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg p-2.5 text-sm outline-none focus:border-accent-blue"}),e.jsx("input",{name:"nodo",placeholder:"Nodo/Torre afectado (ej: PLA1/ND2)",required:!0,className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg p-2.5 text-sm outline-none focus:border-accent-blue"}),e.jsx("input",{name:"afectados",type:"number",placeholder:"Clientes afectados (estimado)",required:!0,className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg p-2.5 text-sm outline-none focus:border-accent-blue"}),e.jsxs("select",{name:"prioridad",required:!0,className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg p-2.5 text-sm outline-none focus:border-accent-blue",children:[e.jsx("option",{value:"Crítica",children:"Crítica"}),e.jsx("option",{value:"Alta",children:"Alta"}),e.jsx("option",{value:"Media",children:"Media"})]}),e.jsx("input",{name:"reportado",placeholder:"Reportado por",required:!0,className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg p-2.5 text-sm outline-none focus:border-accent-blue"}),e.jsx("input",{name:"tecnico",placeholder:"Técnico asignado",required:!0,className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg p-2.5 text-sm outline-none focus:border-accent-blue"}),e.jsx("textarea",{name:"descripcion",placeholder:"Descripción de la avería...",className:"bg-bg-secondary border border-border text-text-primary p-3 rounded-lg text-sm min-h-[80px] resize-y outline-none focus:border-accent-blue w-full",required:!0}),e.jsx(y,{value:f,onChange:j,max:5}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer text-sm hover:text-text-primary transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 py-2.5 rounded-lg bg-accent-red border-none text-white cursor-pointer text-sm font-semibold hover:opacity-90 transition-opacity",children:"Reportar"})]})]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 backdrop-blur-sm",onClick:()=>d(null),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-[600px] border border-border max-h-[85vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start justify-between mb-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-sm text-text-muted",children:r.id}),e.jsxs("h3",{className:"text-lg font-bold mt-1 text-accent-red flex items-center gap-2",children:[e.jsx(N,{size:20})," ",r.tipo]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-lg text-xs font-bold ${c[r.estado]?.bg||""} ${c[r.estado]?.text||""}`,children:r.estado}),e.jsx("button",{onClick:()=>d(null),className:"p-1.5 rounded-lg bg-bg-secondary border border-border text-text-muted cursor-pointer hover:text-text-primary transition-colors",children:e.jsx(P,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1 flex items-center gap-1",children:[e.jsx(O,{size:10})," Zona / Nodo"]}),e.jsxs("p",{className:"text-sm font-medium",children:[r.zona," ",e.jsx("span",{className:"text-text-muted mx-1",children:"•"})," ",r.nodo]})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1 flex items-center gap-1",children:[e.jsx(v,{size:10})," Clientes Afectados"]}),e.jsx("p",{className:"text-sm font-bold text-accent-red",children:r.clientesAfectados})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1 flex items-center gap-1",children:[e.jsx(U,{size:10})," Prioridad"]}),e.jsx("p",{className:`text-sm font-bold ${r.prioridad==="Crítica"?"text-accent-red":"text-accent-yellow"}`,children:r.prioridad})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1 flex items-center gap-1",children:[e.jsx(T,{size:10})," Fecha Reporte"]}),e.jsx("p",{className:"text-sm font-medium",children:r.fecha})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("p",{className:"text-xs text-text-muted font-bold mb-2 uppercase tracking-wide",children:"Descripción del Problema"}),e.jsx("div",{className:"bg-bg-secondary rounded-lg p-3 border border-border/50 text-sm text-text-primary leading-relaxed",children:r.descripcion}),r.adjuntos&&r.adjuntos.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx(y,{value:r.adjuntos,onChange:()=>{},readOnly:!0,max:5})})]}),r.historial&&r.historial.length>0&&e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 mb-5 border border-border/50",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-3 font-semibold flex items-center gap-1",children:[e.jsx(Z,{size:12})," Ruta de Atención"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[[...r.historial].reverse().map((t,s,b)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"group relative flex items-center gap-2 bg-bg-card border border-border/60 rounded-full px-3 py-1.5 cursor-help transition-colors hover:border-accent-blue/50 hover:bg-bg-secondary",title:t.motivo||"Sin motivo registrado",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${c[t.estadoNuevo]?.dot||"bg-gray-400"}`}),e.jsx("span",{className:"text-xs font-medium text-text-primary",children:t.estadoNuevo})]}),e.jsx("span",{className:"text-border mx-1",children:"|"}),e.jsx("span",{className:"text-[10px] text-text-muted font-mono leading-none",children:new Date(t.fecha).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),t.motivo&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-[200px] hidden group-hover:block z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-[10px] p-2 rounded shadow-xl border border-white/10 relative",children:[t.motivo,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-[1px] border-4 border-transparent border-t-gray-900"})]})})]}),s<b.length-1&&e.jsx("div",{className:"mx-1 text-text-muted/40",children:e.jsx(w,{size:14,strokeWidth:1.5})})]},s)),e.jsx("div",{className:"mx-1 text-text-muted/40",children:e.jsx(w,{size:14,strokeWidth:1.5})}),e.jsx("div",{className:"px-2 py-1 rounded bg-accent-blue/10 border border-accent-blue/30 text-[10px] font-bold text-accent-blue uppercase tracking-wider",children:"Actual"})]})]}),e.jsxs("div",{className:"border-t border-border mt-5 pt-4",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide font-semibold mb-2",children:"Acciones"}),e.jsxs("div",{className:"flex gap-2",children:[r.estado==="Activa"&&e.jsx("button",{onClick:()=>n(r.id,"En reparación"),className:"flex-1 py-2.5 rounded-lg bg-accent-yellow/20 text-accent-yellow border-none text-xs font-bold cursor-pointer hover:bg-accent-yellow/30 transition-colors",children:"Iniciar Reparación"}),r.estado==="En reparación"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(r.id,"Resuelta"),className:"flex-1 py-2.5 rounded-lg bg-accent-green/20 text-accent-green border-none text-xs font-bold cursor-pointer hover:bg-accent-green/30 transition-colors",children:"Marcar Resuelta"}),e.jsx("button",{onClick:()=>n(r.id,"Coordinando"),className:"flex-1 py-2.5 rounded-lg bg-accent-blue/20 text-accent-blue border-none text-xs font-bold cursor-pointer hover:bg-accent-blue/30 transition-colors",children:"Coordinando / Reprogramar"})]}),r.estado==="Coordinando"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(r.id,"En reparación"),className:"flex-1 py-2.5 rounded-lg bg-accent-yellow/20 text-accent-yellow border-none text-xs font-bold cursor-pointer hover:bg-accent-yellow/30 transition-colors",children:"Retomar Reparación"}),e.jsx("button",{onClick:()=>n(r.id,"Resuelta"),className:"flex-1 py-2.5 rounded-lg bg-accent-green/20 text-accent-green border-none text-xs font-bold cursor-pointer hover:bg-accent-green/30 transition-colors",children:"Marcar Resuelta"})]}),r.estado==="Resuelta"&&e.jsx("button",{onClick:()=>n(r.id,"Activa"),className:"flex-1 py-2.5 rounded-lg bg-accent-red/20 text-accent-red border-none text-xs font-bold cursor-pointer hover:bg-accent-red/30 transition-colors",children:"Reabrir Avería"}),e.jsx("button",{onClick:()=>d(null),className:"py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-secondary font-medium text-xs cursor-pointer hover:bg-bg-card-hover transition-colors",children:"Cerrar"})]})]})]})}),e.jsx(D,{open:k,onClose:()=>{m(!1),u(null)},onConfirm:E,title:"Resolver Avería",entityId:p,entityLabel:"Avería",newStatus:"Resuelta",accentColor:"accent-green"})]})}export{re as default};
