import{c as C,a as p,r as D,j as e,T as w,U as z}from"./index-z5gwiLCk.js";import{utils as u,writeFile as S}from"./xlsx-CNerDvZX.js";import{K as c}from"./KPICard-Dq9txBsB.js";import{C as x}from"./Card-BvlEidcN.js";import{B as M}from"./Badge-CF9LDqhb.js";import{D as R}from"./dollar-sign-CWnvPrQF.js";import{D as E}from"./download-DKlEkoFw.js";const I=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],P=C("trending-up",I);function A(){const n=p(o=>o.clients),g=p(o=>o.tickets),f=p(o=>o.averias),a=D.useMemo(()=>{const o=n.filter(s=>(s.deuda_monto||0)>0),r=o.reduce((s,l)=>s+(l.deuda_monto||0),0),i=n.reduce((s,l)=>s+(l.precio||0),0),m=n.filter(s=>s.estado_servicio==="Cortado").length,d=n.filter(s=>s.estado_cuenta==="SUSPENDIDO").length,t={};o.forEach(s=>{t[s.zona]||(t[s.zona]={clientes:0,monto:0}),t[s.zona].clientes++,t[s.zona].monto+=s.deuda_monto});const v=Object.entries(t).sort((s,l)=>l[1].monto-s[1].monto),b=n.filter(s=>s.tecnologia==="Radio Enlace"),h=n.filter(s=>s.tecnologia==="Fibra Óptica"),N=b.reduce((s,l)=>s+(l.precio||0),0),y=h.reduce((s,l)=>s+(l.precio||0),0),_=[...o].sort((s,l)=>l.deuda_monto-s.deuda_monto).slice(0,10);return{conDeuda:o.length,totalDeuda:r,ingresoMensual:i,cortados:m,suspendidos:d,zonas:v,ingresoRadio:N,ingresoFibra:y,radioCount:b.length,fibraCount:h.length,morosos:_}},[n]),j=o=>{let r,i;o==="cobranza"?(r=n.filter(t=>t.deuda_monto>0).map(t=>({ID:t.id,Nombre:t.nombre,Móvil:t.movil_1,Plan:t.plan,"Meses Deuda":t.deuda_meses,"Monto Deuda":t.deuda_monto,"Último Pago":t.ultimo_pago,Estado:t.estado_cuenta,Zona:t.zona})),i="Reporte_Cobranza.xlsx"):o==="clientes"?(r=n.map(t=>({ID:t.id,Nombre:t.nombre,DNI:t.dni,Móvil:t.movil_1,Plan:t.plan,Precio:t.precio,Tecnología:t.tecnologia,Estado:t.estado_cuenta,Conexión:t.status,Zona:t.zona,Nodo:t.nodo_router,Deuda:t.deuda_monto})),i="Reporte_Clientes_Completo.xlsx"):(r=n.filter(t=>t.estado_cuenta==="SUSPENDIDO"||t.estado_servicio==="Cortado").map(t=>({ID:t.id,Nombre:t.nombre,Móvil:t.movil_1,"Estado Cuenta":t.estado_cuenta,"Estado Servicio":t.estado_servicio,Deuda:t.deuda_monto,Zona:t.zona})),i="Reporte_Suspendidos_Cortados.xlsx");const m=u.json_to_sheet(r),d=u.book_new();u.book_append_sheet(d,m,"Reporte"),S(d,i)};return e.jsxs("div",{className:"animate-fade p-4 sm:p-6 sm:px-8 h-full overflow-y-auto",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-[26px] font-bold tracking-tight",children:"Reportes & Cobranza"}),e.jsx("p",{className:"text-text-secondary text-sm mt-1",children:"Análisis financiero y operativo"})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(c,{title:"Ingreso Mensual",value:`S/. ${a.ingresoMensual.toLocaleString()}`,subtitle:"Facturación estimada",icon:e.jsx(R,{size:20}),color:"#10b981"}),e.jsx(c,{title:"Deuda Total",value:`S/. ${a.totalDeuda.toLocaleString()}`,subtitle:`${a.conDeuda} clientes morosos`,icon:e.jsx(w,{size:20}),color:"#ef4444"}),e.jsx(c,{title:"Cortados",value:a.cortados,subtitle:"Por deuda",icon:e.jsx(z,{size:20}),color:"#f59e0b"}),e.jsx(c,{title:"Tickets Abiertos",value:g.filter(o=>o.estado==="Abierto").length,subtitle:`${f.filter(o=>o.estado!=="Resuelta").length} averías activas`,icon:e.jsx(P,{size:20}),color:"#8b5cf6"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx(x,{title:"Ingreso por Tecnología",subtitle:"Distribución por tipo de conexión",children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2 text-sm",children:[e.jsxs("span",{className:"text-accent-blue font-bold",children:["Radio Enlace (",a.radioCount,")"]}),e.jsxs("span",{className:"font-mono text-text-primary",children:["S/. ",a.ingresoRadio.toLocaleString()]})]}),e.jsx("div",{className:"h-2.5 bg-bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent-blue rounded-full transition-all duration-500",style:{width:`${a.ingresoMensual?a.ingresoRadio/a.ingresoMensual*100:0}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2 text-sm",children:[e.jsxs("span",{className:"text-accent-purple font-bold",children:["Fibra Óptica (",a.fibraCount,")"]}),e.jsxs("span",{className:"font-mono text-text-primary",children:["S/. ",a.ingresoFibra.toLocaleString()]})]}),e.jsx("div",{className:"h-2.5 bg-bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent-purple rounded-full transition-all duration-500",style:{width:`${a.ingresoMensual?a.ingresoFibra/a.ingresoMensual*100:0}%`}})})]})]})}),e.jsx(x,{title:"Deuda por Zona",subtitle:"Zonas con mayor morosidad",children:e.jsx("div",{className:"flex flex-col gap-1 overflow-y-auto max-h-[160px] pr-2 custom-scrollbar",children:a.zonas.map(([o,r])=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border/50 last:border-0",children:[e.jsx("span",{className:"text-sm font-medium text-text-primary",children:o}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(M,{variant:"default",size:"sm",className:"bg-bg-secondary",children:[r.clientes," cl."]}),e.jsxs("span",{className:"font-mono text-red-500 font-bold text-sm",children:["S/. ",r.monto.toFixed(2)]})]})]},o))})})]}),e.jsx(x,{title:"Top 10 Clientes con Mayor Deuda",subtitle:"Seguimiento de cobranza crítica",className:"mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-[13px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-[11px] text-text-muted uppercase tracking-wider",children:[e.jsx("th",{className:"py-3 px-3 font-semibold",children:"ID"}),e.jsx("th",{className:"py-3 px-3 font-semibold",children:"Nombre"}),e.jsx("th",{className:"py-3 px-3 font-semibold",children:"Móvil"}),e.jsx("th",{className:"py-3 px-3 font-semibold",children:"Plan"}),e.jsx("th",{className:"py-3 px-3 font-semibold text-center",children:"Meses"}),e.jsx("th",{className:"py-3 px-3 font-semibold text-right",children:"Monto"}),e.jsx("th",{className:"py-3 px-3 font-semibold",children:"Último Pago"})]})}),e.jsx("tbody",{className:"divide-y divide-border/50",children:a.morosos.map(o=>e.jsxs("tr",{className:"hover:bg-bg-card-hover transition-colors",children:[e.jsx("td",{className:"py-3 px-3 font-mono text-text-muted text-[11px]",children:o.id}),e.jsx("td",{className:"py-3 px-3 font-medium text-text-primary",children:o.nombre}),e.jsx("td",{className:"py-3 px-3 font-mono text-xs text-text-secondary",children:o.movil_1}),e.jsx("td",{className:"py-3 px-3 text-[11px] text-text-secondary max-w-[200px] truncate",children:o.plan}),e.jsx("td",{className:"py-3 px-3 text-center font-mono font-bold text-text-primary",children:o.deuda_meses}),e.jsxs("td",{className:"py-3 px-3 text-right font-mono text-red-500 font-bold",children:["S/. ",o.deuda_monto.toFixed(2)]}),e.jsx("td",{className:"py-3 px-3 text-text-muted text-xs italic",children:o.ultimo_pago||"—"})]},o.id))})]})})}),e.jsx(x,{title:"Exportar Reportes",subtitle:"Descarga de datos en formato Excel",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[{type:"cobranza",label:"Reporte de Cobranza",desc:"Clientes con deuda pendiente",bgColor:"bg-red-500/10",textColor:"text-red-500"},{type:"clientes",label:"Reporte Completo",desc:"Base de datos completa",bgColor:"bg-blue-500/10",textColor:"text-blue-500"},{type:"cortados",label:"Suspendidos / Cortados",desc:"Clientes sin servicio activo",bgColor:"bg-yellow-500/10",textColor:"text-yellow-500"}].map(o=>e.jsxs("button",{onClick:()=>j(o.type),className:"flex items-center gap-4 p-4 rounded-2xl bg-bg-secondary/50 border border-border text-left cursor-pointer transition-all hover:border-accent-blue/50 hover:bg-bg-secondary group",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${o.bgColor} group-hover:scale-110 transition-transform`,children:e.jsx(E,{size:20,className:o.textColor})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-text-primary group-hover:text-accent-blue transition-colors",children:o.label}),e.jsx("p",{className:"text-[11px] text-text-muted leading-tight mt-0.5",children:o.desc})]})]},o.type))})})]})}export{A as default};
