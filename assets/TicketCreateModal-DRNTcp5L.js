import{c as V,a as l,r,j as e,X as G}from"./index-Bp4pvzRI.js";import{A as H}from"./Adjuntos-BsqOXZqV.js";import{M as X}from"./map-pin-DfKocrwN.js";import{S as $}from"./search-Bb9dCE3k.js";const J=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],K=V("external-link",J);function Y({onClose:g,onSuccess:_,initialData:s=null}){const m=l(t=>t.clients),S=l(t=>t.categorias),d=l(t=>t.subcategorias),f=l(t=>t.tecnicos),E=l(t=>t.addTicket),P=l(t=>t.updateTicket),k=l(t=>t.getSLABySubcategoria),[u,b]=r.useState(""),[o,j]=r.useState(null),[q,v]=r.useState(!1),[a,w]=r.useState(""),[n,N]=r.useState(""),[C,T]=r.useState(""),[p,I]=r.useState(""),[A,M]=r.useState([]);r.useEffect(()=>{if(s){const t=m.find(c=>c.id===s.clienteId);j(t||{id:s.clienteId,nombre:s.clienteNombre}),b(s.clienteNombre),w(s.categoriaId||""),N(s.subcategoriaId||""),T(s.tecnicoId||""),I(s.descripcion||""),M(s.adjuntos||[])}},[s,m]);const L=r.useMemo(()=>{if(u.length<2)return[];const t=u.toLowerCase();return m.filter(c=>c.nombre.toLowerCase().includes(t)||c.id.toLowerCase().includes(t)||c.movil_1&&c.movil_1.includes(t)).slice(0,10)},[m,u]),B=r.useMemo(()=>a?d.filter(t=>t.categoriaId===a):[],[d,a]),i=r.useMemo(()=>n?k(n):null,[n,k]),y=r.useMemo(()=>{if(!n)return"";const t=d.find(c=>c.id===n);return t?t.tipoAtencion:""},[n,d]),F=r.useMemo(()=>f.filter(t=>t.estado==="Activo"),[f]),R=()=>{if(!o||!a||!n||!p.trim())return;const t=d.find(x=>x.id===n),c=S.find(x=>x.id===a),h=f.find(x=>x.id===C),z={clienteId:o.id,clienteNombre:o.nombre,tipo:y||"Soporte",prioridad:i?i.prioridad:"Media",estado:s?.estado||"Abierto",asignado:h?h.nombre:"Sin asignar",tecnicoId:h?h.id:null,descripcion:p,categoriaId:a,categoriaNombre:c?c.nombre:"",subcategoriaId:n,subcategoriaNombre:t?t.nombre:"",tipoAtencion:y,slaTiempoLimite:i?i.tiempoLimite:null,slaImpacto:i?i.impacto:null,adjuntos:A};s?.id?P(s.id,z):E(z),_()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",onClick:g,children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-[560px] border border-border max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("h3",{className:"text-lg font-bold",children:s?"Editar Ticket":"Nuevo Ticket"}),e.jsx("button",{onClick:g,className:"text-text-muted hover:text-text-primary",children:e.jsx(G,{size:20})})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary font-medium mb-1.5 block",children:"Cliente *"}),o?e.jsxs("div",{className:"flex items-center justify-between bg-bg-secondary rounded-lg p-3 border border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:o.nombre}),e.jsxs("p",{className:"text-[11px] text-text-muted font-mono",children:["ID: ",o.id,o.movil_1&&e.jsxs("span",{className:"ml-2 text-text-secondary",children:["ðŸ“± ",o.movil_1]})]}),o.direccion&&e.jsxs("p",{className:"text-[10px] text-text-muted mt-0.5 flex items-center gap-1",children:[e.jsx(X,{size:10})," ",o.direccion]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:()=>{j(null),b("")},className:"text-xs text-accent-red hover:underline border-none bg-transparent cursor-pointer",children:"Cambiar"}),e.jsxs("button",{type:"button",onClick:()=>window.open(`/?page=clientes&search=${o.id}`,"_blank"),className:"text-xs text-accent-blue hover:underline flex items-center gap-1 border-none bg-transparent cursor-pointer",children:[e.jsx(K,{size:12})," Ver Perfil"]})]})]}):e.jsxs("div",{className:"relative",children:[e.jsx($,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{placeholder:"Buscar cliente por nombre, ID o celular...",value:u,onChange:t=>{b(t.target.value),v(!0)},onFocus:()=>v(!0),className:"w-full pl-9",autoFocus:!0}),q&&L.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-bg-card border border-border rounded-lg shadow-xl z-10 max-h-[200px] overflow-y-auto",children:L.map(t=>e.jsxs("div",{onClick:()=>{j(t),b(""),v(!1)},className:"px-3 py-2.5 cursor-pointer hover:bg-bg-card-hover border-b border-border/50 last:border-0",children:[e.jsx("p",{className:"text-sm font-medium",children:t.nombre}),e.jsxs("p",{className:"text-[11px] text-text-muted font-mono",children:["ID: ",t.id]})]},t.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary font-medium mb-1.5 block",children:"CategorÃ­a *"}),e.jsxs("select",{value:a,onChange:t=>{w(t.target.value),N("")},className:"w-full",children:[e.jsx("option",{value:"",children:"Seleccionar categorÃ­a..."}),S.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary font-medium mb-1.5 block",children:"SubcategorÃ­a *"}),e.jsxs("select",{value:n,onChange:t=>N(t.target.value),className:"w-full",disabled:!a,children:[e.jsx("option",{value:"",children:a?"Seleccionar subcategorÃ­a...":"Primero seleccione una categorÃ­a"}),B.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),n&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 border border-border/50",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Prioridad (SLA)"}),i?e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-xs",children:i.prioridad}),e.jsxs("p",{className:"text-[10px] text-text-muted mt-1",children:["Tiempo: ",i.tiempoLimite]})]}):e.jsx("span",{className:"text-xs text-text-muted",children:"Media"})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 border border-border/50",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Tipo AtenciÃ³n"}),e.jsx("span",{className:"text-sm font-medium",children:y||"No definido"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary font-medium mb-1.5 block",children:"TÃ©cnico Asignado"}),e.jsxs("select",{value:C,onChange:t=>T(t.target.value),className:"w-full",children:[e.jsx("option",{value:"",children:"Sin asignar"}),F.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary font-medium mb-1.5 block",children:"DescripciÃ³n *"}),e.jsx("textarea",{value:p,onChange:t=>I(t.target.value),placeholder:"Describa el problema...",className:"bg-bg-secondary border border-border text-text-primary p-3 rounded-lg text-sm min-h-[100px] resize-y outline-none focus:border-accent-blue w-full"})]}),e.jsx(H,{value:A,onChange:M,max:5}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:g,className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer text-sm hover:bg-bg-card-hover transition-colors",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:R,disabled:!o||!a||!n||!p.trim(),className:"flex-1 py-2.5 rounded-lg bg-accent-blue border-none text-white cursor-pointer text-sm font-semibold hover:opacity-90 transition-opacity disabled:opacity-40 disabled:cursor-not-allowed",children:s?"Guardar Cambios":"Crear Ticket"})]})]})]})})}export{Y as T};
