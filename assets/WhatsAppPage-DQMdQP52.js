import{c as Q,C as ht,a as p,r as l,j as e,x as ce,i as jt,m as Ee,X as T,U as ft}from"./index-Cv24CwsR.js";import{K as J}from"./KPICard-DpNuLiqB.js";import{C as P,d as Ie}from"./CopyButton-BLj0ojLp.js";import{P as vt}from"./phone-B66RfLH5.js";import{S as de}from"./search-Cwsi32eX.js";import{P as Me}from"./plus-BKUvgC9B.js";import{E as Nt}from"./eye-BgJBHVk7.js";import{P as xe}from"./pen-line-BaKgXB22.js";import{S as me,I as yt}from"./sparkles-BNS2NQjb.js";import{D as Pe}from"./download-sb10k0H3.js";import{F as wt}from"./funnel-CaJNaaA_.js";import{C as Ct}from"./chevron-right-DmXAAVHy.js";import{S as kt}from"./square-4fuoUJK8.js";import{U as $e}from"./upload-C6Gn-Zq7.js";import{C as St}from"./check-C-NCJrVP.js";const zt=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Y=Q("mic",zt);const At=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],_t=Q("play",At);const Tt=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],$=Q("send",Tt);const Et=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Z=Q("star",Et);function Ge(){return ht.GEMINI_API_KEY}const De=["gemini-2.5-flash","gemini-1.5-flash","gemini-1.5-pro"],It={formal:{label:"Formal",emoji:"ðŸ‘”",desc:"Tono profesional y corporativo"},amigable:{label:"Amigable",emoji:"ðŸ˜Š",desc:"Tono cercano y cÃ¡lido"},urgente:{label:"Urgente",emoji:"âš¡",desc:"Tono directo y con sentido de urgencia"},persuasivo:{label:"Persuasivo",emoji:"ðŸŽ¯",desc:"Tono convincente para cobranza"}};async function Mt(m,o,N=""){if(!m)throw new Error("No hay texto para reescribir");const g=Ge();if(!g)throw new Error("API Key de Gemini no configurada. Por favor configÃºrala en ConfiguraciÃ³n.");const y=`ActÃºa como un asistente experto de soporte tÃ©cnico y cobranzas para un ISP (Proveedor de Internet).
Tu tarea es reescribir el siguiente mensaje usando un tono: ${o.toUpperCase()}.

${N?`Contexto del Cliente: ${N}.`:""}
Mensaje original: "${m}"

Reglas:
1. MantÃ©n las variables importantes (montos, fechas) si existen en el original.
2. SÃ© conciso, profesional y usa buena ortografÃ­a.
3. IMPORTANTE: Solo devuelve el texto del mensaje reescrito, sin comillas, sin introducciones ni explicaciones.`;for(const w of De)try{const h=`https://generativelanguage.googleapis.com/v1beta/models/${w}:generateContent?key=${g}`,u=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:y}]}]})});if(u.status===404)continue;if(!u.ok){const k=await u.json().catch(()=>({}));throw new Error(k.error?.message||`Error ${u.status}`)}const z=await u.json();if(z.candidates?.[0]?.content)return z.candidates[0].content.parts[0].text}catch(h){console.warn(`Modelo ${w} fallÃ³:`,h)}throw new Error("No se pudo conectar con la IA. Verifica tu API Key y conexiÃ³n.")}async function Fe(m){if(!m)throw new Error("No hay prompt para generar");const o=Ge();if(!o)throw new Error("API Key de Gemini no configurada. Por favor configÃºrala en ConfiguraciÃ³n.");for(const N of De)try{const g=`https://generativelanguage.googleapis.com/v1beta/models/${N}:generateContent?key=${o}`,y=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:m}]}]})});if(y.status===404)continue;if(!y.ok){const h=await y.json().catch(()=>({}));throw new Error(h.error?.message||`Error ${y.status}`)}const w=await y.json();if(w.candidates?.[0]?.content)return w.candidates[0].content.parts[0].text}catch(g){console.warn(`Modelo ${N} fallÃ³:`,g)}throw new Error("No se pudo conectar con la IA. Verifica tu API Key y conexiÃ³n.")}function X(m,o){const N=new Date,g=N.getHours(),y=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],w=g>=19||g<5?"Buenas noches":g>=12?"Buenas tardes":"Buenos dÃ­as";let h=m.replace(/{Saludo}/g,w).replace(/{Mes}/g,y[N.getMonth()]).replace(/{Anio}/g,String(N.getFullYear()));if(!o)return h.replace(/{Nombre}/g,"").replace(/{([^{}]+)}/g,"");const u=(o.nombre||"").toLowerCase().replace(/\b\w/g,k=>k.toUpperCase());h=h.replace(/{Nombre}/g,u);const z={precio:o.precio?`S/. ${o.precio.toFixed(2)}`:"",plan:o.plan||"",deuda_monto:o.deuda_monto?`S/. ${o.deuda_monto.toFixed(2)}`:"S/. 0.00",deuda_meses:o.deuda_meses||"0",direccion:o.direccion||"",proximo_pago:o.proximo_pago||"",zona:o.zona||"",movil_1:o.movil_1||"",estado_cuenta:o.estado_cuenta||"",tecnologia:o.tecnologia||"",ip:o.ip||""};return h.replace(/{([^{}]+)}/g,(k,S)=>{const F=S.toLowerCase().replace(/\s+/g,"_");return z[F]!==void 0?z[F]:o[S]||k})}const Le=["Cobranza","General","Soporte","PromociÃ³n"],Pt=[{key:"{Saludo}",desc:"Buenos dÃ­as/tardes/noches"},{key:"{Nombre}",desc:"Nombre del cliente"},{key:"{precio}",desc:"Precio del plan"},{key:"{plan}",desc:"Plan contratado"},{key:"{deuda_monto}",desc:"Monto de deuda"},{key:"{deuda_meses}",desc:"Meses de deuda"},{key:"{direccion}",desc:"DirecciÃ³n del cliente"},{key:"{proximo_pago}",desc:"Fecha prÃ³ximo pago"},{key:"{zona}",desc:"Zona del cliente"},{key:"{Mes}",desc:"Mes actual"},{key:"{Anio}",desc:"AÃ±o actual"}];function Yt(){const m=p(t=>t.clients),o=p(t=>t.templates),N=p(t=>t.addTemplate),g=p(t=>t.updateTemplate),y=p(t=>t.deleteTemplate),w=p(t=>t.incrementTemplateUse),h=p(t=>t.addWhatsappLog),u=p(t=>t.whatsappLogs),z=p(t=>t.campaignActive),k=p(t=>t.setCampaign),S=p(t=>t.whatsappCategories),F=p(t=>t.addCategory),Ue=p(t=>t.deleteCategory),ue=p(t=>t.updateCategory),be=l.useMemo(()=>["Todas",...S?.length>0?S:Le],[S]),[L,ee]=l.useState("plantillas"),[R,Oe]=l.useState(""),[B,Re]=l.useState("Todas"),[Be,E]=l.useState(!1),[K,pe]=l.useState(null),[Ke,te]=l.useState(!1),[I,se]=l.useState(""),[Ve,G]=l.useState(null),[D,ge]=l.useState(""),[c,M]=l.useState(null),[i,j]=l.useState({titulo:"",categoria:"Cobranza",mensaje:"",favorito:!1,imagenes:[],audios:[]}),[he,je]=l.useState(!1),[We,fe]=l.useState(!1),[b,ve]=l.useState(null),[x,qe]=l.useState(null),[C,V]=l.useState(""),[W,Ne]=l.useState(""),[ae,He]=l.useState(""),[ye,we]=l.useState(!1),[v,Ce]=l.useState([]),[A,Je]=l.useState(null),[f,re]=l.useState(0),[U,Ye]=l.useState("all"),[O,ke]=l.useState({}),[q,Ze]=l.useState(""),Se=l.useMemo(()=>{let t=[...o];if(B!=="Todas"&&(t=t.filter(s=>s.categoria===B)),R){const s=R.toLowerCase();t=t.filter(a=>a.titulo.toLowerCase().includes(s)||a.mensaje.toLowerCase().includes(s))}return t.sort((s,a)=>s.favorito!==a.favorito?s.favorito?-1:1:(a.uso||0)-(s.uso||0)),t},[o,B,R]),ze=l.useMemo(()=>{if(!W)return[];const t=W.toLowerCase();return m.filter(s=>s.nombre.toLowerCase().includes(t)||s.movil_1?.includes(t)||s.id.includes(t)).slice(0,10)},[m,W]),H=l.useMemo(()=>({totalTemplates:o.length,totalSent:u.length,todaySent:u.filter(t=>new Date(t.fecha).toDateString()===new Date().toDateString()).length,favorites:o.filter(t=>t.favorito).length}),[o,u]),Xe=()=>{pe(null),j({titulo:"",categoria:"Cobranza",mensaje:"",favorito:!1,imagenes:[],audios:[]}),E(!0)},Ae=t=>{pe(t),j({titulo:t.titulo,categoria:t.categoria,mensaje:t.mensaje,favorito:t.favorito,imagenes:t.imagenes||[],audios:t.audios||[]}),E(!0)},Qe=()=>{!i.titulo||!i.mensaje||(K?g(K.id,i):N(i),E(!1))},et=t=>{confirm("Â¿Eliminar esta plantilla?")&&y(t)},oe=t=>{qe(t),V(X(t.mensaje,b))},tt=t=>{ve(t),Ne(""),x&&V(X(x.mensaje,t))},st=()=>{const t=b?.movil_1||ae;if(!t)return;const s=t.replace(/\D/g,""),r=`https://wa.me/${s.startsWith("51")&&s.length>=11?s:`51${s}`}?text=${encodeURIComponent(C)}`;window.open(r,"_blank"),x&&w(x.id),h({clienteId:b?.id||"manual",clienteNombre:b?.nombre||`Manual (${s})`,plantilla:x?.titulo||"Manual",mensaje:C,telefono:s})},at=async t=>{if(C){we(!0);try{const s=b?`Cliente: ${b.nombre}, Deuda: S/. ${b.deuda_monto||0}, Estado: ${b.estado_cuenta}`:"",a=await Mt(C,t,s);V(a)}catch(s){alert("Error IA: "+s.message)}we(!1)}},ne=[{key:"zona",label:"Zona"},{key:"nodo",label:"Nodo",getter:t=>t.nodo||t.nodo_router},{key:"tecnologia",label:"TecnologÃ­a"},{key:"plan",label:"Plan"},{key:"estado_cuenta",label:"Estado Cuenta"},{key:"estado_servicio",label:"Estado Servicio"},{key:"status",label:"ConexiÃ³n"}],rt=l.useMemo(()=>{const t={};return ne.forEach(s=>{const a=s.getter||(r=>r[s.key]);t[s.key]=[...new Set(m.map(a).filter(Boolean))].sort()}),t},[m]),_e=(t,s,a)=>{let r=[...m];if(t==="deudores"?r=r.filter(n=>n.deuda_monto>0):t==="cortados"?r=r.filter(n=>n.estado_servicio==="Cortado"||n.estado_cuenta==="SUSPENDIDO"):t==="activos"&&(r=r.filter(n=>n.status==="ONLINE"||n.estado_cuenta==="ACTIVO")),ne.forEach(n=>{const d=s[n.key];if(d){const _=n.getter||(ie=>ie[n.key]);r=r.filter(ie=>_(ie)===d)}}),a){const n=a.toLowerCase();r=r.filter(d=>(d.nombre||"").toLowerCase().includes(n)||(d.id||"").toLowerCase().includes(n)||(d.dni||"").toLowerCase().includes(n)||(d.direccion||"").toLowerCase().includes(n)||(d.movil_1||"").includes(n)||(d.zona||"").toLowerCase().includes(n)||(d.nodo||d.nodo_router||"").toLowerCase().includes(n)||(d.plan||"").toLowerCase().includes(n)||(d.tecnologia||"").toLowerCase().includes(n))}return r.filter(n=>n.movil_1)},le=l.useMemo(()=>_e(U,O,q).length,[m,U,O,q]),ot=()=>{const t=_e(U,O,q);if(t.length===0)return alert("No hay clientes con nÃºmero de telÃ©fono para esta selecciÃ³n");Ce(t),re(0),k({campaignActive:!0})},nt=()=>{const t=v[f];if(!t||!A)return;const s=X(A.mensaje,t),a=(t.movil_1||"").replace(/\D/g,""),n=`https://wa.me/${a.startsWith("51")&&a.length>=11?a:`51${a}`}?text=${encodeURIComponent(s)}`;window.open(n,"_blank"),w(A.id),h({clienteId:t.id,clienteNombre:t.nombre,plantilla:A.titulo,mensaje:s,telefono:a}),f+1<v.length?re(f+1):(k({campaignActive:!1}),alert("CampaÃ±a finalizada"))},lt=()=>{k({campaignActive:!1}),Ce([]),re(0)},it=t=>{j(s=>({...s,mensaje:s.mensaje+t}))},ct=t=>{const s=Array.from(t.target.files),a=5-(i.imagenes?.length||0);a<=0||(s.slice(0,a).forEach(r=>{if(r.size>2*1024*1024){alert(`${r.name} excede 2MB`);return}const n=new FileReader;n.onload=d=>{j(_=>({..._,imagenes:[..._.imagenes||[],{id:`img-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,nombre:r.name,base64:d.target.result,size:r.size}]}))},n.readAsDataURL(r)}),t.target.value="")},dt=t=>{const s=Array.from(t.target.files),a=2-(i.audios?.length||0);a<=0||(s.slice(0,a).forEach(r=>{if(r.size>5*1024*1024){alert(`${r.name} excede 5MB`);return}const n=new FileReader;n.onload=d=>{j(_=>({..._,audios:[..._.audios||[],{id:`aud-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,nombre:r.name,base64:d.target.result,size:r.size,guion:""}]}))},n.readAsDataURL(r)}),t.target.value="")},xt=t=>j(s=>({...s,imagenes:s.imagenes.filter(a=>a.id!==t)})),mt=t=>j(s=>({...s,audios:s.audios.filter(a=>a.id!==t)})),Te=(t,s)=>j(a=>({...a,audios:a.audios.map(r=>r.id===t?{...r,guion:s}:r)})),ut=async()=>{if(!(!i.titulo||!i.categoria)){je(!0);try{const t=await Fe(`Genera un mensaje de WhatsApp profesional para un ISP (proveedor de internet).
TÃ­tulo de la plantilla: "${i.titulo}"
CategorÃ­a: "${i.categoria}"

Variables disponibles que puedes usar: {Saludo}, {Nombre}, {precio}, {plan}, {deuda_monto}, {deuda_meses}, {direccion}, {proximo_pago}, {zona}, {Mes}, {Anio}

Reglas:
1. Usa las variables relevantes segÃºn la categorÃ­a (ej: para Cobranza usa {deuda_monto}, {deuda_meses}).
2. Empieza con {Saludo} {Nombre}.
3. SÃ© conciso, mÃ¡ximo 3-4 lÃ­neas.
4. Solo devuelve el texto del mensaje, sin comillas ni explicaciones.`);j(s=>({...s,mensaje:t}))}catch(t){alert("Error IA: "+t.message)}je(!1)}},bt=async t=>{if(i.mensaje){fe(!0);try{const s=await Fe(`Convierte el siguiente mensaje de WhatsApp en un guion de voz para que un operador de call center lo lea por telÃ©fono. El guion debe sonar natural al hablarlo, sin emojis, sin formato de texto.

Mensaje original: "${i.mensaje}"

Reglas:
1. Reemplaza variables como {Nombre} con "el nombre del cliente", {deuda_monto} con "el monto adeudado", etc.
2. Hazlo conversacional y amable.
3. Incluye una apertura y cierre apropiados para llamada telefÃ³nica.
4. Solo devuelve el guion, sin comillas ni explicaciones.`);Te(t,s)}catch(s){alert("Error IA: "+s.message)}fe(!1)}},pt=t=>{const s={Cobranza:["{Saludo}","{Nombre}","{deuda_monto}","{deuda_meses}","{proximo_pago}"],General:["{Saludo}","{Nombre}","{plan}","{Mes}"],Soporte:["{Saludo}","{Nombre}","{plan}","{direccion}","{zona}"],PromociÃ³n:["{Saludo}","{Nombre}","{precio}","{plan}","{Mes}","{Anio}"]};return s[t]||s.General},gt=[{id:"plantillas",label:"Plantillas",icon:e.jsx(ce,{size:16})},{id:"enviar",label:"Enviar Mensaje",icon:e.jsx($,{size:16})},{id:"campana",label:"CampaÃ±a",icon:e.jsx(ft,{size:16})},{id:"historial",label:"Historial",icon:e.jsx(Ie,{size:16})}];return e.jsxs("div",{className:"animate-fade p-4 sm:p-6 sm:px-8 h-full overflow-y-auto",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-[26px] font-bold tracking-tight",children:"WhatsApp & Plantillas"}),e.jsx("p",{className:"text-text-secondary text-sm mt-1",children:"MensajerÃ­a masiva, plantillas y campaÃ±as"})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(J,{title:"Plantillas",value:H.totalTemplates,icon:e.jsx(ce,{size:20}),color:"#3b82f6"}),e.jsx(J,{title:"Mensajes Enviados",value:H.totalSent,icon:e.jsx($,{size:20}),color:"#10b981"}),e.jsx(J,{title:"Enviados Hoy",value:H.todaySent,icon:e.jsx(vt,{size:20}),color:"#8b5cf6"}),e.jsx(J,{title:"Favoritas",value:H.favorites,icon:e.jsx(Z,{size:20}),color:"#f59e0b"})]}),e.jsx("div",{className:"flex gap-1 mb-6 bg-bg-secondary p-1 rounded-xl w-fit",children:gt.map(t=>e.jsxs("button",{onClick:()=>ee(t.id),className:`flex items-center gap-1.5 py-2 px-4 rounded-lg text-xs font-semibold cursor-pointer border-none transition-all
              ${L===t.id?"bg-bg-card text-text-primary shadow-sm":"bg-transparent text-text-muted hover:text-text-secondary"}`,children:[t.icon," ",t.label]},t.id))}),L==="plantillas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(de,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{value:R,onChange:t=>Oe(t.target.value),placeholder:"Buscar plantillas...",className:"w-full pl-9 pr-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm"})]}),e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[be.map(t=>e.jsx("button",{onClick:()=>Re(t),className:`py-1.5 px-3 rounded-lg text-[11px] font-semibold cursor-pointer border-none transition-all
                    ${B===t?"bg-accent-blue text-white":"bg-bg-secondary text-text-muted hover:text-text-secondary"}`,children:t},t)),e.jsx("button",{onClick:()=>te(!0),className:"p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-blue",title:"Gestionar categorÃ­as",children:e.jsx(jt,{size:12})})]}),e.jsxs("button",{onClick:Xe,className:"py-2 px-4 rounded-lg bg-accent-green border-none text-white text-xs font-semibold cursor-pointer flex items-center gap-1.5",children:[e.jsx(Me,{size:14})," Nueva"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[Se.map(t=>e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-semibold truncate",children:t.titulo}),e.jsx("span",{className:"text-[10px] text-text-muted bg-bg-secondary py-0.5 px-2 rounded mt-1 inline-block",children:t.categoria})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.favorito&&e.jsx(Z,{size:14,className:"text-accent-yellow fill-accent-yellow"}),e.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[t.uso||0,"x"]})]})]}),e.jsx("p",{className:"text-[12px] text-text-secondary flex-1 mb-3 line-clamp-3",children:t.mensaje}),(t.imagenes?.length>0||t.audios?.length>0)&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.imagenes?.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[t.imagenes.slice(0,3).map(s=>e.jsx("a",{href:s.base64,target:"_blank",rel:"noopener noreferrer",onClick:a=>a.stopPropagation(),children:e.jsx("img",{src:s.base64,alt:s.nombre,className:"w-8 h-8 rounded object-cover border border-border hover:ring-2 hover:ring-accent-blue"})},s.id)),t.imagenes.length>3&&e.jsxs("span",{className:"text-[9px] text-text-muted bg-bg-secondary rounded px-1 py-0.5",children:["+",t.imagenes.length-3]})]}),t.audios?.length>0&&e.jsxs("span",{className:"text-[10px] text-text-muted flex items-center gap-0.5 bg-bg-secondary py-0.5 px-1.5 rounded",children:[e.jsx(Y,{size:10})," ",t.audios.length," audio"]})]}),e.jsxs("div",{className:"flex gap-1 pt-2 border-t border-border",children:[e.jsxs("button",{onClick:()=>{ee("enviar"),oe(t)},className:"flex-1 py-1.5 rounded-lg bg-accent-green/10 text-accent-green text-[11px] font-semibold cursor-pointer border-none",children:[e.jsx($,{size:12,className:"inline mr-1"})," Usar"]}),e.jsx("button",{onClick:()=>M(t),title:"Ver detalle",className:"p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-blue",children:e.jsx(Nt,{size:12})}),e.jsx(P,{getTextFn:()=>t.mensaje,title:"Copiar mensaje"}),t.audios?.some(s=>s.guion)&&e.jsx(P,{getTextFn:()=>t.audios.find(s=>s.guion)?.guion||"",title:"Copiar guion de voz"}),e.jsx("button",{onClick:()=>Ae(t),className:"p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-blue",children:e.jsx(xe,{size:12})}),e.jsx("button",{onClick:()=>g(t.id,{favorito:!t.favorito}),className:"p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-yellow",children:e.jsx(Z,{size:12,className:t.favorito?"fill-accent-yellow text-accent-yellow":""})}),e.jsx("button",{onClick:()=>et(t.id),className:"p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-red",children:e.jsx(Ee,{size:12})})]})]},t.id)),Se.length===0&&e.jsxs("div",{className:"col-span-3 text-center py-10 text-text-muted",children:[e.jsx(ce,{size:40,className:"mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No hay plantillas"})]})]})]}),L==="enviar"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Seleccionar Cliente"}),b?e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-accent-blue/5 border border-accent-blue/20",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:b.nombre}),e.jsxs("p",{className:"text-[11px] text-text-muted font-mono",children:[b.movil_1," Â· ",b.id]})]}),e.jsx("button",{onClick:()=>ve(null),className:"p-1 rounded-lg bg-bg-secondary border-none cursor-pointer text-text-muted hover:text-accent-red",children:e.jsx(T,{size:14})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(de,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{value:W,onChange:t=>Ne(t.target.value),placeholder:"Buscar por nombre, mÃ³vil o ID...",className:"w-full pl-9 pr-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm"}),ze.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-bg-card border border-border rounded-xl shadow-lg z-10 max-h-[200px] overflow-y-auto",children:ze.map(t=>e.jsxs("button",{onClick:()=>tt(t),className:"w-full text-left p-3 text-sm cursor-pointer bg-transparent border-none hover:bg-bg-secondary transition-colors flex justify-between",children:[e.jsx("span",{className:"font-medium",children:t.nombre}),e.jsx("span",{className:"text-[11px] text-text-muted font-mono",children:t.movil_1})]},t.id))})]}),!b&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-[11px] text-text-muted mb-1.5",children:"O envÃ­o manual:"}),e.jsx("input",{value:ae,onChange:t=>He(t.target.value),placeholder:"NÃºmero de telÃ©fono (9 dÃ­gitos)",className:"w-full px-4 py-2 rounded-xl bg-bg-secondary border border-border text-sm font-mono"})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Seleccionar Plantilla"}),e.jsx("div",{className:"flex flex-col gap-1.5 max-h-[250px] overflow-y-auto",children:o.map(t=>e.jsxs("button",{onClick:()=>oe(t),className:`text-left p-3 rounded-xl text-xs cursor-pointer border transition-all
                      ${x?.id===t.id?"border-accent-blue bg-accent-blue/5":"border-border bg-bg-secondary hover:border-border"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:t.titulo}),e.jsx("span",{className:"text-[10px] text-text-muted",children:t.categoria})]}),e.jsx("p",{className:"text-[11px] text-text-muted mt-1 truncate",children:t.mensaje})]},t.id))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Vista Previa del Mensaje"}),e.jsx("textarea",{value:C,onChange:t=>V(t.target.value),rows:8,className:"w-full p-4 rounded-xl bg-bg-secondary border border-border text-sm resize-none font-mono",placeholder:"Selecciona una plantilla o escribe un mensaje..."}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("p",{className:"text-[11px] text-text-muted mb-2 flex items-center gap-1",children:[e.jsx(me,{size:12})," Reescribir con IA (Gemini)"]}),e.jsx("div",{className:"flex gap-1.5",children:Object.entries(It).map(([t,s])=>e.jsx("button",{onClick:()=>at(t),disabled:ye||!C,className:"py-1.5 px-3 rounded-lg bg-bg-secondary border border-border text-[11px] font-semibold cursor-pointer hover:border-accent-purple disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:ye?"...":`${s.emoji} ${s.label}`},t))})]})]}),x&&(x.imagenes?.length>0||x.audios?.length>0)&&e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-4 mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(yt,{size:14})," Adjuntos de la Plantilla"]}),x.imagenes?.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-[11px] text-text-muted mb-2",children:["ImÃ¡genes (",x.imagenes.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:x.imagenes.map(t=>e.jsxs("div",{className:"relative group rounded-lg overflow-hidden border border-border",children:[e.jsx("a",{href:t.base64,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:t.base64,alt:t.nombre,className:"w-full h-24 object-cover"})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 p-1.5 flex items-center justify-between opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("span",{className:"text-[9px] text-white truncate flex-1",children:t.nombre}),e.jsx("a",{href:t.base64,download:t.nombre,onClick:s=>s.stopPropagation(),className:"p-1 rounded bg-white/20 text-white hover:bg-white/40 shrink-0",children:e.jsx(Pe,{size:10})})]})]},t.id))})]}),x.audios?.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[11px] text-text-muted mb-2",children:["Audios (",x.audios.length,")"]}),x.audios.map(t=>e.jsxs("div",{className:"bg-bg-secondary rounded-xl p-3 mb-2 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{size:12,className:"text-accent-purple"}),e.jsx("span",{className:"text-xs font-medium truncate",children:t.nombre})]}),e.jsx("audio",{controls:!0,src:t.base64,className:"w-full h-8 mb-2"}),t.guion&&e.jsxs("div",{className:"bg-bg-card rounded-lg p-2.5 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-text-muted font-semibold",children:"Guion de voz"}),e.jsx(P,{getTextFn:()=>t.guion,title:"Copiar guion"})]}),e.jsx("p",{className:"text-xs text-text-secondary whitespace-pre-wrap",children:t.guion})]})]},t.id))]})]}),e.jsxs("button",{onClick:st,disabled:!C||!b?.movil_1&&!ae,className:"w-full py-3 rounded-xl bg-accent-green border-none text-white text-sm font-bold cursor-pointer flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-40 disabled:cursor-not-allowed transition-opacity",children:[e.jsx($,{size:18}),"Enviar por WhatsApp"]}),e.jsxs("button",{onClick:()=>{C&&navigator.clipboard.writeText(C)},disabled:!C,className:"w-full mt-2 py-2.5 rounded-xl bg-bg-secondary border border-border text-text-secondary text-xs font-semibold cursor-pointer flex items-center justify-center gap-2 hover:border-accent-blue disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Ie,{size:14}),"Copiar texto al portapapeles"]})]})]}),L==="campana"&&e.jsx("div",{children:z?e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-accent-blue/30 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-green animate-pulse"}),"CampaÃ±a en Curso"]}),e.jsxs("span",{className:"text-xs text-text-muted font-mono",children:[f+1," / ",v.length]})]}),e.jsx("div",{className:"w-full h-2 bg-bg-secondary rounded-full mb-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent-blue rounded-full transition-all",style:{width:`${(f+1)/v.length*100}%`}})}),v[f]&&e.jsxs("div",{className:"bg-bg-secondary rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:v[f].nombre}),e.jsxs("p",{className:"text-[11px] text-text-muted font-mono",children:[v[f].movil_1," Â· ",v[f].zona]})]}),e.jsx("span",{className:`py-1 px-2.5 rounded-lg text-[10px] font-bold
                      ${v[f].deuda_monto>0?"bg-accent-red/15 text-accent-red":"bg-accent-green/15 text-accent-green"}`,children:v[f].deuda_monto>0?`Deuda: S/. ${v[f].deuda_monto}`:"Al dÃ­a"})]}),e.jsx("div",{className:"bg-bg-card rounded-lg p-3 text-xs text-text-secondary font-mono",children:X(A.mensaje,v[f])})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:nt,className:"flex-1 py-2.5 rounded-xl bg-accent-green border-none text-white text-sm font-bold cursor-pointer flex items-center justify-center gap-2",children:[e.jsx($,{size:16})," Enviar y Siguiente",e.jsx(Ct,{size:16})]}),e.jsxs("button",{onClick:lt,className:"py-2.5 px-6 rounded-xl bg-accent-red/10 border border-accent-red/30 text-accent-red text-sm font-semibold cursor-pointer flex items-center gap-2",children:[e.jsx(kt,{size:14})," Detener"]})]})]}):e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-6",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",children:"Configurar CampaÃ±a Masiva"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-2 block",children:"Estado de Clientes"}),e.jsx("div",{className:"flex flex-col gap-2 mb-4",children:[{value:"all",label:"Todos los clientes"},{value:"deudores",label:"Clientes con deuda"},{value:"cortados",label:"Cortados / Suspendidos"},{value:"activos",label:"Clientes activos"}].map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-2.5 rounded-xl border cursor-pointer transition-all
                          ${U===t.value?"border-accent-blue bg-accent-blue/5":"border-border bg-bg-secondary"}`,children:[e.jsx("input",{type:"radio",name:"campFilter",value:t.value,checked:U===t.value,onChange:()=>Ye(t.value),className:"accent-accent-blue"}),e.jsx("span",{className:"text-xs font-medium flex-1",children:t.label})]},t.value))}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"text-xs text-text-muted mb-1.5 block flex items-center gap-1",children:[e.jsx(de,{size:12})," Buscar cliente"]}),e.jsx("input",{value:q,onChange:t=>Ze(t.target.value),placeholder:"Nombre, DNI, direcciÃ³n, nodo, zona...",className:"w-full px-3 py-2 rounded-lg bg-bg-secondary border border-border text-xs"})]}),e.jsxs("label",{className:"text-xs text-text-muted mb-2 block flex items-center gap-1",children:[e.jsx(wt,{size:12})," Filtros por Columna"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ne.map(t=>e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-muted mb-1 block",children:t.label}),e.jsxs("select",{value:O[t.key]||"",onChange:s=>ke(a=>({...a,[t.key]:s.target.value})),className:"w-full px-2 py-1.5 rounded-lg bg-bg-secondary border border-border text-xs",children:[e.jsx("option",{value:"",children:"Todos"}),(rt[t.key]||[]).map(s=>e.jsx("option",{value:s,children:s},s))]})]},t.key))}),Object.values(O).some(t=>t)&&e.jsx("button",{onClick:()=>ke({}),className:"mt-2 text-[10px] text-accent-red cursor-pointer bg-transparent border-none hover:underline",children:"Limpiar filtros"}),e.jsxs("div",{className:"mt-3 p-2.5 rounded-xl bg-accent-blue/5 border border-accent-blue/20 text-center",children:[e.jsx("span",{className:"text-sm font-bold text-accent-blue",children:le}),e.jsx("span",{className:"text-xs text-text-muted ml-1.5",children:"clientes coinciden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-2 block",children:"Plantilla para la campaÃ±a"}),e.jsx("div",{className:"flex flex-col gap-1.5 max-h-[300px] overflow-y-auto",children:o.map(t=>e.jsxs("button",{onClick:()=>Je(t),className:`text-left p-3 rounded-xl text-xs cursor-pointer border transition-all
                          ${A?.id===t.id?"border-accent-green bg-accent-green/5":"border-border bg-bg-secondary"}`,children:[e.jsx("span",{className:"font-semibold",children:t.titulo}),e.jsx("p",{className:"text-[11px] text-text-muted truncate mt-0.5",children:t.mensaje})]},t.id))})]})]}),e.jsxs("button",{onClick:ot,disabled:!A||le===0,className:"mt-6 w-full py-3 rounded-xl bg-accent-blue border-none text-white text-sm font-bold cursor-pointer flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-40 disabled:cursor-not-allowed transition-opacity",children:[e.jsx(_t,{size:18}),"Iniciar CampaÃ±a (",le," clientes)"]})]})}),L==="historial"&&e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"py-4 px-6 border-b border-border",children:e.jsxs("h3",{className:"text-sm font-semibold",children:["Historial de EnvÃ­os (",u.length,")"]})}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-[13px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-[11px] text-text-muted uppercase bg-bg-secondary sticky top-0",children:[e.jsx("th",{className:"py-3 px-4",children:"Fecha"}),e.jsx("th",{className:"py-3 px-4",children:"Cliente"}),e.jsx("th",{className:"py-3 px-4",children:"Plantilla"}),e.jsx("th",{className:"py-3 px-4",children:"TelÃ©fono"}),e.jsx("th",{className:"py-3 px-4",children:"Mensaje"})]})}),e.jsxs("tbody",{children:[[...u].sort((t,s)=>new Date(s.fecha)-new Date(t.fecha)).map(t=>e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("td",{className:"py-3 px-4 text-text-muted text-xs",children:new Date(t.fecha).toLocaleString("es-PE",{dateStyle:"short",timeStyle:"short"})}),e.jsx("td",{className:"py-3 px-4 font-medium",children:t.clienteNombre}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-[11px] bg-accent-blue/10 text-accent-blue py-0.5 px-2 rounded",children:t.plantilla})}),e.jsx("td",{className:"py-3 px-4 font-mono text-xs",children:t.telefono}),e.jsx("td",{className:"py-3 px-4 text-text-secondary text-xs truncate max-w-[250px]",children:t.mensaje})]},t.id)),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-10 text-center text-text-muted",children:"No hay envÃ­os registrados"})})]})]})})]}),Be&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>E(!1),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border w-full max-w-[650px] max-h-[85vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-5 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-bold",children:K?"Editar Plantilla":"Nueva Plantilla"}),e.jsx("button",{onClick:()=>E(!1),className:"p-1 rounded-lg bg-bg-secondary border-none cursor-pointer text-text-muted hover:text-text-primary",children:e.jsx(T,{size:16})})]}),e.jsxs("div",{className:"p-5 flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"TÃ­tulo"}),e.jsx("input",{value:i.titulo,onChange:t=>j(s=>({...s,titulo:t.target.value})),className:"w-full px-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm",placeholder:"Ej: Cobro Mensual"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"CategorÃ­a"}),e.jsx("select",{value:i.categoria,onChange:t=>j(s=>({...s,categoria:t.target.value})),className:"w-full px-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm",children:be.filter(t=>t!=="Todas").map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block",children:"Mensaje"}),e.jsx("textarea",{value:i.mensaje,onChange:t=>j(s=>({...s,mensaje:t.target.value})),rows:5,className:"w-full px-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm resize-none font-mono",placeholder:"Escribe el mensaje con variables..."}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:ut,disabled:he||!i.titulo,className:"py-1.5 px-3 rounded-lg bg-accent-purple/10 text-accent-purple text-[11px] font-semibold border-none cursor-pointer flex items-center gap-1 hover:bg-accent-purple/20 disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(me,{size:12})," ",he?"Generando...":"Generar con IA"]}),e.jsx("span",{className:"text-[10px] text-text-muted",children:"Usa tÃ­tulo y categorÃ­a para generar"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-text-muted mb-1.5 block",children:["Insertar Variable",e.jsxs("span",{className:"text-[10px] text-accent-purple ml-2",children:["* Sugeridas para ",i.categoria]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Pt.map(t=>{const s=pt(i.categoria).includes(t.key);return e.jsxs("button",{onClick:()=>it(t.key),title:t.desc,className:`py-1 px-2 rounded-lg text-[10px] font-mono font-semibold cursor-pointer border-none transition-colors
                          ${s?"bg-accent-purple/15 text-accent-purple hover:bg-accent-purple/25 ring-1 ring-accent-purple/30":"bg-accent-blue/10 text-accent-blue hover:bg-accent-blue/20"}`,children:[t.key," ",s?"*":""]},t.key)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-text-muted mb-1.5 block",children:["ImÃ¡genes (",i.imagenes?.length||0,"/5)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[(i.imagenes||[]).map(t=>e.jsxs("div",{className:"relative w-20 h-20 rounded-lg overflow-hidden border border-border group",children:[e.jsx("img",{src:t.base64,alt:t.nombre,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>xt(t.id),className:"absolute top-0.5 right-0.5 p-0.5 rounded-full bg-black/60 text-white border-none cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(T,{size:10})}),e.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 truncate",children:t.nombre})]},t.id)),(i.imagenes?.length||0)<5&&e.jsxs("label",{className:"w-20 h-20 rounded-lg border-2 border-dashed border-border flex flex-col items-center justify-center cursor-pointer hover:border-accent-blue hover:bg-accent-blue/5 transition-colors",children:[e.jsx($e,{size:16,className:"text-text-muted mb-1"}),e.jsx("span",{className:"text-[9px] text-text-muted",children:"Agregar"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:ct})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-text-muted mb-1.5 block",children:["Audios / Guiones (",i.audios?.length||0,"/2)"]}),(i.audios||[]).map(t=>e.jsxs("div",{className:"bg-bg-secondary rounded-xl p-3 mb-2 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Y,{size:14,className:"text-accent-purple shrink-0"}),e.jsx("span",{className:"text-xs font-medium truncate",children:t.nombre}),e.jsxs("span",{className:"text-[10px] text-text-muted shrink-0",children:["(",(t.size/1024).toFixed(0)," KB)"]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{onClick:()=>bt(t.id),disabled:We||!i.mensaje,title:"Generar guion con IA",className:"p-1.5 rounded-lg bg-accent-purple/10 text-accent-purple border-none cursor-pointer hover:bg-accent-purple/20 disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(me,{size:12})}),e.jsx("button",{onClick:()=>mt(t.id),className:"p-1.5 rounded-lg bg-accent-red/10 text-accent-red border-none cursor-pointer hover:bg-accent-red/20",children:e.jsx(T,{size:12})})]})]}),e.jsx("audio",{controls:!0,src:t.base64,className:"w-full h-8 mb-2"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"text-[10px] text-text-muted",children:"Guion de voz"}),t.guion&&e.jsx(P,{getTextFn:()=>t.guion,title:"Copiar guion"})]}),e.jsx("textarea",{value:t.guion||"",onChange:s=>Te(t.id,s.target.value),rows:3,placeholder:"Escribe o genera con IA el guion que el operador leerÃ¡...",className:"w-full px-3 py-2 rounded-lg bg-bg-card border border-border text-xs resize-none"})]})]},t.id)),(i.audios?.length||0)<2&&e.jsxs("label",{className:"flex items-center gap-2 p-3 rounded-xl border-2 border-dashed border-border cursor-pointer hover:border-accent-purple hover:bg-accent-purple/5 transition-colors",children:[e.jsx($e,{size:14,className:"text-text-muted"}),e.jsx("span",{className:"text-xs text-text-muted",children:"Agregar audio"}),e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:dt})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.favorito,onChange:t=>j(s=>({...s,favorito:t.target.checked})),className:"accent-accent-yellow"}),e.jsx("span",{className:"text-xs font-medium",children:"Marcar como favorita"})]})]}),e.jsxs("div",{className:"p-5 border-t border-border flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>E(!1),className:"py-2 px-5 rounded-lg bg-bg-secondary border border-border text-text-secondary text-sm cursor-pointer",children:"Cancelar"}),e.jsx("button",{onClick:Qe,disabled:!i.titulo||!i.mensaje,className:"py-2 px-5 rounded-lg bg-accent-blue border-none text-white text-sm font-semibold cursor-pointer disabled:opacity-40",children:K?"Guardar Cambios":"Crear Plantilla"})]})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>M(null),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border w-full max-w-[650px] max-h-[85vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-5 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-sm font-bold",children:c.titulo}),e.jsx("span",{className:"text-[10px] bg-accent-blue/10 text-accent-blue py-0.5 px-2 rounded font-semibold",children:c.categoria}),c.favorito&&e.jsx(Z,{size:14,className:"text-accent-yellow fill-accent-yellow"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{getTextFn:()=>c.mensaje,title:"Copiar mensaje",size:"md"}),e.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[c.uso||0," usos"]}),e.jsx("button",{onClick:()=>M(null),className:"p-1 rounded-lg bg-bg-secondary border-none cursor-pointer text-text-muted hover:text-text-primary",children:e.jsx(T,{size:16})})]})]}),e.jsxs("div",{className:"p-5 flex flex-col gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block font-semibold",children:"Mensaje"}),e.jsx("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border text-sm font-mono whitespace-pre-wrap",children:c.mensaje})]}),c.imagenes?.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-text-muted mb-2 block font-semibold",children:["ImÃ¡genes (",c.imagenes.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:c.imagenes.map(t=>e.jsxs("div",{className:"relative group rounded-xl overflow-hidden border border-border",children:[e.jsx("a",{href:t.base64,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:t.base64,alt:t.nombre,className:"w-full h-32 object-cover hover:opacity-90 transition-opacity"})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 p-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-white truncate flex-1",children:t.nombre}),e.jsx("a",{href:t.base64,download:t.nombre,onClick:s=>s.stopPropagation(),className:"p-1 rounded bg-white/20 text-white hover:bg-white/40 shrink-0 ml-1",children:e.jsx(Pe,{size:12})})]})]},t.id))})]}),c.audios?.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-text-muted mb-2 block font-semibold",children:["Audios / Guiones (",c.audios.length,")"]}),c.audios.map(t=>e.jsxs("div",{className:"bg-bg-secondary rounded-xl p-4 mb-3 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{size:14,className:"text-accent-purple"}),e.jsx("span",{className:"text-xs font-semibold",children:t.nombre}),e.jsxs("span",{className:"text-[10px] text-text-muted",children:["(",(t.size/1024).toFixed(0)," KB)"]})]}),e.jsx("audio",{controls:!0,src:t.base64,className:"w-full h-9 mb-3"}),t.guion&&e.jsxs("div",{className:"bg-bg-card rounded-lg p-3 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-[11px] text-text-muted font-semibold",children:"Guion de Voz"}),e.jsx(P,{getTextFn:()=>t.guion,title:"Copiar guion"})]}),e.jsx("p",{className:"text-xs text-text-secondary whitespace-pre-wrap leading-relaxed",children:t.guion})]})]},t.id))]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[e.jsxs("span",{children:["ID: ",c.id]}),e.jsx("span",{children:"Â·"}),e.jsxs("span",{children:[c.uso||0," usos"]}),c.imagenes?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Â·"}),e.jsxs("span",{children:[c.imagenes.length," imÃ¡genes"]})]}),c.audios?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Â·"}),e.jsxs("span",{children:[c.audios.length," audios"]})]})]})]}),e.jsxs("div",{className:"p-5 border-t border-border flex gap-2",children:[e.jsxs("button",{onClick:()=>{ee("enviar"),oe(c),M(null)},className:"flex-1 py-2.5 rounded-xl bg-accent-green border-none text-white text-xs font-bold cursor-pointer flex items-center justify-center gap-1.5",children:[e.jsx($,{size:14})," Usar Plantilla"]}),e.jsxs("button",{onClick:()=>{Ae(c),M(null)},className:"py-2.5 px-5 rounded-xl bg-bg-secondary border border-border text-text-secondary text-xs font-semibold cursor-pointer flex items-center gap-1.5",children:[e.jsx(xe,{size:14})," Editar"]}),e.jsx("button",{onClick:()=>M(null),className:"py-2.5 px-5 rounded-xl bg-bg-secondary border border-border text-text-secondary text-xs cursor-pointer",children:"Cerrar"})]})]})}),Ke&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>te(!1),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border w-full max-w-[400px] max-h-[70vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-5 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Gestionar CategorÃ­as"}),e.jsx("button",{onClick:()=>te(!1),className:"p-1 rounded-lg bg-bg-secondary border-none cursor-pointer text-text-muted hover:text-text-primary",children:e.jsx(T,{size:16})})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{value:I,onChange:t=>se(t.target.value),placeholder:"Nueva categorÃ­a...",className:"flex-1 px-3 py-2 rounded-lg bg-bg-secondary border border-border text-sm",onKeyDown:t=>{t.key==="Enter"&&I.trim()&&(F(I.trim()),se(""))}}),e.jsx("button",{onClick:()=>{I.trim()&&(F(I.trim()),se(""))},disabled:!I.trim(),className:"py-2 px-4 rounded-lg bg-accent-blue border-none text-white text-xs font-semibold cursor-pointer disabled:opacity-40",children:e.jsx(Me,{size:14})})]}),e.jsx("div",{className:"flex flex-col gap-1.5",children:(S?.length>0?S:Le).map(t=>e.jsx("div",{className:"flex items-center gap-2 p-2.5 rounded-xl bg-bg-secondary border border-border",children:Ve===t?e.jsxs(e.Fragment,{children:[e.jsx("input",{value:D,onChange:s=>ge(s.target.value),className:"flex-1 px-2 py-1 rounded-lg bg-bg-card border border-border text-sm",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&D.trim()&&(ue(t,D.trim()),G(null)),s.key==="Escape"&&G(null)}}),e.jsx("button",{onClick:()=>{D.trim()&&(ue(t,D.trim()),G(null))},className:"p-1.5 rounded-lg bg-accent-green/10 text-accent-green border-none cursor-pointer",children:e.jsx(St,{size:12})}),e.jsx("button",{onClick:()=>G(null),className:"p-1.5 rounded-lg bg-bg-card text-text-muted border-none cursor-pointer",children:e.jsx(T,{size:12})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 text-sm font-medium",children:t}),e.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[o.filter(s=>s.categoria===t).length," tpl"]}),e.jsx("button",{onClick:()=>{G(t),ge(t)},className:"p-1.5 rounded-lg bg-bg-card text-text-muted border-none cursor-pointer hover:text-accent-blue",children:e.jsx(xe,{size:12})}),e.jsx("button",{onClick:()=>{const s=o.filter(a=>a.categoria===t).length;if(s>0){alert(`No se puede eliminar "${t}" porque tiene ${s} plantilla(s) asociadas.`);return}confirm(`Â¿Eliminar la categorÃ­a "${t}"?`)&&Ue(t)},className:"p-1.5 rounded-lg bg-bg-card text-text-muted border-none cursor-pointer hover:text-accent-red",children:e.jsx(Ee,{size:12})})]})},t))})]})]})})]})}export{Yt as default};
