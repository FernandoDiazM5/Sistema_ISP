import{c as C,u as S,a as y,r as n,C as z,j as e,W as I}from"./index-BUoWx0aW.js";import{E as L,l as U}from"./authAPI-C_SarL_y.js";import{M as G}from"./mail-ZbR2yNq9.js";import{E as P}from"./eye-DUeRYCt1.js";const _=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],B=C("lock",_);function V(){const{login:x}=S(),g=y(t=>t.loadCurrentUserByEmail),w=y(t=>t.getUserByUid),[i,f]=n.useState("email"),[u,j]=n.useState(""),[m,v]=n.useState(""),[p,N]=n.useState(!1),[h,s]=n.useState(""),[c,r]=n.useState(!1),b=n.useRef(!1),d=n.useRef(null),E=async t=>{try{r(!0),s("");const a=JSON.parse(atob(t.credential.split(".")[1])),o=a.email,l=await g(o);if(!l){s("No tienes autorización para acceder a este sistema. Contacta al administrador."),r(!1);return}if(!l.activo){s("Tu cuenta ha sido desactivada. Contacta al administrador."),r(!1);return}x({email:l.email,nombre:l.nombre,foto:l.foto||a.picture,rol:l.rol,uid:l.uid,permisos:l.permisos}),r(!1)}catch(a){s("Error al procesar el inicio de sesión. Intenta nuevamente."),console.error("Error en login:",a),r(!1)}};n.useEffect(()=>{const t=z.GOOGLE_CLIENT_ID;if(!(!t||b.current||!window.google))try{window.google.accounts.id.initialize({client_id:t,callback:E,ux_mode:"popup"}),b.current=!0}catch(a){console.error("Error al inicializar Google:",a)}},[x,g]),n.useEffect(()=>{i!=="google"||!b.current||!window.google||!d.current||(d.current.innerHTML="",window.google.accounts.id.renderButton(d.current,{type:"standard",theme:"filled_black",size:"large",text:"continue_with",shape:"pill",width:360,locale:"es"}))},[i]);const k=async t=>{if(t.preventDefault(),!u||!m){s("Por favor completa todos los campos");return}try{r(!0),s("");const a=await U(u,m);if(!a.success){s(a.error),r(!1);return}const o=await w(a.uid);if(!o){s("Usuario no encontrado en el sistema. Contacta al administrador."),r(!1);return}if(!o.activo){s("Tu cuenta ha sido desactivada. Contacta al administrador."),r(!1);return}x({email:o.email,nombre:o.nombre,foto:o.foto,rol:o.rol,uid:o.uid,permisos:o.permisos}),r(!1)}catch(a){console.error("Error en login:",a),s("Error al iniciar sesión. Intenta nuevamente."),r(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",style:{background:"radial-gradient(ellipse at 20% 50%, #0f172a 0%, #0a0e1a 50%, #050709 100%)"},children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:"linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px)",backgroundSize:"60px 60px"}}),e.jsx("div",{className:"absolute top-[20%] left-[15%] w-[300px] h-[300px] rounded-full",style:{background:"radial-gradient(circle, rgba(59,130,246,0.08) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute bottom-[20%] right-[15%] w-[400px] h-[400px] rounded-full",style:{background:"radial-gradient(circle, rgba(139,92,246,0.06) 0%, transparent 70%)"}}),e.jsxs("div",{className:"animate-fade w-full max-w-[420px] mx-4 p-6 sm:p-10 rounded-[20px] relative z-10",style:{background:"linear-gradient(145deg, rgba(26,32,53,0.9) 0%, rgba(17,24,39,0.95) 100%)",border:"1px solid rgba(59,130,246,0.15)",boxShadow:"0 25px 80px rgba(0,0,0,0.5), 0 0 60px rgba(59,130,246,0.05)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center text-white",style:{background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",boxShadow:"0 8px 32px rgba(59,130,246,0.3)"},children:e.jsx(I,{size:28})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight mb-1",children:"ISP Sistema de Gestión"}),e.jsx("p",{className:"text-text-secondary text-sm",children:"Radio Enlace · Fibra Óptica · IPTV"})]}),e.jsxs("div",{className:"flex gap-2 mb-6 p-1 bg-bg-secondary rounded-xl",children:[e.jsx("button",{onClick:()=>f("email"),className:`flex-1 py-2 px-4 rounded-lg text-xs font-semibold transition-all border-none cursor-pointer ${i==="email"?"bg-accent-blue text-white shadow-sm":"bg-transparent text-text-secondary hover:text-text-primary"}`,children:"Email y Contraseña"}),e.jsx("button",{onClick:()=>f("google"),className:`flex-1 py-2 px-4 rounded-lg text-xs font-semibold transition-all border-none cursor-pointer ${i==="google"?"bg-accent-blue text-white shadow-sm":"bg-transparent text-text-secondary hover:text-text-primary"}`,children:"Google OAuth"})]}),i==="email"&&e.jsxs("form",{onSubmit:k,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-1.5",children:"Correo Electrónico"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"email",value:u,onChange:t=>j(t.target.value),placeholder:"tu-email@ejemplo.com",className:"w-full py-2.5 pl-10 pr-4 bg-bg-secondary border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted transition-colors",disabled:c})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-1.5",children:"Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:p?"text":"password",value:m,onChange:t=>v(t.target.value),placeholder:"••••••••",className:"w-full py-2.5 pl-10 pr-10 bg-bg-secondary border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted transition-colors",disabled:c}),e.jsx("button",{type:"button",onClick:()=>N(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors bg-transparent border-none cursor-pointer p-0",children:p?e.jsx(L,{size:16}):e.jsx(P,{size:16})})]})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 px-5 rounded-xl text-white border-none text-sm font-semibold cursor-pointer transition-opacity hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed mt-2",style:{background:"linear-gradient(135deg, #3b82f6, #6366f1)"},children:c?"Verificando...":"Iniciar Sesión"})]}),i==="google"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-xs text-text-secondary text-center mb-2",children:"Inicia sesión con tu cuenta de Google autorizada"}),c?e.jsx("div",{className:"w-full py-3 text-center text-sm text-text-secondary",children:"Verificando..."}):e.jsx("div",{ref:d,className:"flex justify-center"})]}),h&&e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-accent-red/10 border border-accent-red/20",children:e.jsx("p",{className:"text-xs text-accent-red text-center leading-relaxed",children:h})}),e.jsx("p",{className:"mt-6 text-[11px] text-text-muted text-center",children:"Solo usuarios autorizados pueden acceder"})]})]})}export{V as default};
