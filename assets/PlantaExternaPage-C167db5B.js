import{a as j,r,j as e,v as g,T as me,W as _,X as R,f as pe}from"./index-CE-Gmpg_.js";import{a as ue,A as Z}from"./Adjuntos-DbgbGwAD.js";import{R as be}from"./ResolutionModal-C6kAN5h8.js";import{P as he}from"./plus-s4tdDMXz.js";import{C as je}from"./clock-DuAs5F5M.js";import{C as W}from"./circle-check-DQSjTMQg.js";import{S as Y}from"./search-Bst3wRDz.js";import{M as V}from"./map-pin-4WZjVaub.js";import"./upload-CEaKoOJe.js";import"./eye-D7BEYtG0.js";import"./download-Cw6w29OZ.js";import"./chevron-right-BXu6dud9.js";const f={Pendiente:{bg:"bg-accent-yellow/20",text:"text-accent-yellow",dot:"bg-accent-yellow"},"En progreso":{bg:"bg-accent-blue/20",text:"text-accent-blue",dot:"bg-accent-blue"},Reprogramada:{bg:"bg-cyan-500/20",text:"text-cyan-400",dot:"bg-cyan-400"},Completada:{bg:"bg-accent-green/20",text:"text-accent-green",dot:"bg-accent-green"},Cancelada:{bg:"bg-text-muted/20",text:"text-text-muted",dot:"bg-text-muted"}},X={Crítica:"text-accent-red font-bold",Alta:"text-accent-red",Media:"text-accent-yellow",Baja:"text-accent-green"},ge=["Tendido de fibra","Reparación de poste","AP Saturado","Corte de fibra","Atenuación excesiva","Mantenimiento NAP","Extensión de red"],fe=["Tendido de fibra","Corte de fibra","Atenuación excesiva","Mantenimiento NAP","Extensión de red"],Ne=["AP Saturado"];function C(n){return fe.includes(n)?"fibra":Ne.includes(n)?"radio":"otro"}function Te(){const n=j(t=>t.derivaciones),G=j(t=>t.addDerivacion),A=j(t=>t.updateDerivacion),L=j(t=>t.tecnicos),E=j(t=>t.instalaciones),H=j(t=>t.updateTicket),[y,J]=r.useState(""),[w,K]=r.useState("all"),[k,Q]=r.useState("all"),[I,U]=r.useState("all"),[S,ee]=r.useState("all"),[te,N]=r.useState(!1),[a,d]=r.useState(null);r.useEffect(()=>{if(a){const t=n.find(s=>s.id===a.id);t&&t!==a&&d(t)}},[n,a]);const[b,m]=r.useState(""),[se,x]=r.useState(!1),[O,p]=r.useState(""),[D,u]=r.useState(!1),[l,z]=r.useState({metricaAntes:"",metricaDespues:"",observaciones:""}),[$,v]=r.useState([]),[ae,T]=r.useState(!1),[h,M]=r.useState(null),re=r.useMemo(()=>{const t=new Set(n.map(s=>s.zona));return Array.from(t).sort()},[n]),P=r.useMemo(()=>({total:n.length,enProgreso:n.filter(t=>t.estado==="En progreso").length,completadas:n.filter(t=>t.estado==="Completada").length,pendientes:n.filter(t=>t.estado==="Pendiente").length}),[n]),q=r.useMemo(()=>{if(!b||b.length<2)return[];const t=b.toLowerCase();return E.filter(s=>s.id.toLowerCase().includes(t)||s.clienteNombre&&s.clienteNombre.toLowerCase().includes(t)||s.prospectoNombre&&s.prospectoNombre.toLowerCase().includes(t)||s.zona&&s.zona.toLowerCase().includes(t)).slice(0,8)},[E,b]),B=r.useMemo(()=>n.filter(t=>{const s=y.toLowerCase(),o=!y||t.id.toLowerCase().includes(s)||t.tipo&&t.tipo.toLowerCase().includes(s)||t.zona&&t.zona.toLowerCase().includes(s)||t.direccion&&t.direccion.toLowerCase().includes(s)||t.clienteNombre&&t.clienteNombre.toLowerCase().includes(s)||t.tecnicoNombre&&t.tecnicoNombre.toLowerCase().includes(s)||t.material&&t.material.toLowerCase().includes(s);let c=!0;w==="radio"?c=C(t.tipo)==="radio":w==="fibra"&&(c=C(t.tipo)==="fibra"||C(t.tipo)==="otro");const F=k==="all"||t.zona===k,de=I==="all"||t.estado===I,xe=S==="all"||t.prioridad===S;return o&&c&&F&&de&&xe}),[n,y,w,k,I,S]),ne=t=>{t.preventDefault();const s=new FormData(t.target),o=s.get("tecnicoId"),c=L.find(F=>F.id===o);G({tipo:s.get("tipo"),zona:s.get("zona"),direccion:s.get("direccion"),tecnicoId:o,tecnicoNombre:c?c.nombre:"",estado:"Pendiente",prioridad:s.get("prioridad"),descripcion:s.get("descripcion"),instalacionId:s.get("instalacionId")||null,clienteRelacionado:s.get("instalacionId")||null,metraje:parseInt(s.get("metraje"))||0,material:s.get("material"),adjuntos:$}),N(!1),m(""),x(!1),p(""),v([])},i=(t,s)=>{if(s==="Completada")M({derivacionId:t,nuevoEstado:s}),T(!0);else{const o={estado:s,_historyComment:`Cambio de estado manual a ${s}`};A(t,o),a&&a.id===t&&d({...a,estado:s})}},oe=t=>{if(!h)return;A(h.derivacionId,{estado:h.nuevoEstado,fechaCompletado:new Date().toISOString().split("T")[0],...t,_historyComment:t.solucion||"Derivación completada"});const s=n.find(o=>o.id===h.derivacionId);s?.ticketId&&H(s.ticketId,{estado:"Resuelto",_historyComment:`Resuelto desde Planta Externa (${s.id})`}),s&&a&&d({...s,estado:"Completada",...t}),T(!1),M(null),u(!1)},ce=()=>{a&&(A(a.id,{estado:"Completada",fechaCompletado:new Date().toISOString().split("T")[0],metricaAntes:l.metricaAntes,metricaDespues:l.metricaDespues,observacionesCierre:l.observaciones}),d({...a,estado:"Completada",fechaCompletado:new Date().toISOString().split("T")[0],metricaAntes:l.metricaAntes,metricaDespues:l.metricaDespues,observacionesCierre:l.observaciones}),u(!1),z({metricaAntes:"",metricaDespues:"",observaciones:""}))},le=t=>t&&E.find(s=>s.id===t)||null,ie=t=>{const s=C(t);return s==="radio"?e.jsx(_,{size:16}):s==="fibra"?e.jsx(g,{size:16}):e.jsx(pe,{size:16})};return e.jsxs("div",{className:"animate-fade p-4 sm:p-6 sm:px-8 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-[26px] font-bold tracking-tight",children:"Planta Externa"}),e.jsx("p",{className:"text-text-secondary text-sm mt-1",children:"Derivaciones de infraestructura y trabajos de campo"})]}),e.jsxs("button",{onClick:()=>N(!0),className:"w-full sm:w-auto justify-center py-2.5 px-4 rounded-xl bg-accent-purple border-none text-white text-sm font-semibold cursor-pointer flex items-center gap-2 hover:opacity-90",children:[e.jsx(he,{size:16})," Nueva Derivación"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-purple/15 text-accent-purple",children:e.jsx(g,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:P.total}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"Total Derivaciones"})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-blue/15 text-accent-blue",children:e.jsx(je,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:P.enProgreso}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"En Progreso"})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-green/15 text-accent-green",children:e.jsx(W,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:P.completadas}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"Completadas"})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center bg-accent-yellow/15 text-accent-yellow",children:e.jsx(me,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:P.pendientes}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase",children:"Pendientes"})]})]})]}),e.jsx("div",{className:"flex gap-2 mb-4",children:[{key:"all",label:"Todas",icon:e.jsx(g,{size:14})},{key:"radio",label:"Radio Enlace",icon:e.jsx(_,{size:14})},{key:"fibra",label:"Fibra Óptica",icon:e.jsx(g,{size:14})}].map(t=>e.jsxs("button",{onClick:()=>K(t.key),className:`py-1.5 px-4 rounded-lg text-xs font-semibold border cursor-pointer transition-colors flex items-center gap-1.5
              ${w===t.key?"bg-accent-purple/20 border-accent-purple text-accent-purple":"bg-bg-secondary border-border text-text-secondary hover:border-accent-purple/50"}`,children:[t.icon," ",t.label]},t.key))}),e.jsxs("div",{className:"flex gap-3 mb-5",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{placeholder:"Buscar por ID, tipo, zona, dirección, técnico, material...",value:y,onChange:t=>J(t.target.value),className:"w-full pl-9"})]}),e.jsxs("select",{value:k,onChange:t=>Q(t.target.value),className:"min-w-[140px]",children:[e.jsx("option",{value:"all",children:"Todas las zonas"}),re.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:I,onChange:t=>U(t.target.value),className:"min-w-[140px]",children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"Pendiente",children:"Pendiente"}),e.jsx("option",{value:"En progreso",children:"En progreso"}),e.jsx("option",{value:"Completada",children:"Completada"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"})]}),e.jsxs("select",{value:S,onChange:t=>ee(t.target.value),className:"min-w-[120px]",children:[e.jsx("option",{value:"all",children:"Prioridad"}),e.jsx("option",{value:"Crítica",children:"Crítica"}),e.jsx("option",{value:"Alta",children:"Alta"}),e.jsx("option",{value:"Media",children:"Media"}),e.jsx("option",{value:"Baja",children:"Baja"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[B.length===0&&e.jsxs("div",{className:"bg-bg-card rounded-xl p-8 border border-border text-center",children:[e.jsx(g,{size:32,className:"mx-auto text-text-muted mb-3"}),e.jsx("p",{className:"text-text-secondary text-sm",children:"No se encontraron derivaciones con los filtros seleccionados."})]}),B.map(t=>{const s=f[t.estado]||f.Pendiente,o=C(t.tipo);return e.jsxs("div",{onClick:()=>d(t),className:"bg-bg-card rounded-xl p-5 border border-border cursor-pointer transition-all hover:border-accent-purple/40 hover:bg-bg-card-hover",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${o==="radio"?"bg-accent-blue/15 text-accent-blue":o==="fibra"?"bg-accent-purple/15 text-accent-purple":"bg-accent-yellow/15 text-accent-yellow"}`,children:ie(t.tipo)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-mono text-xs text-text-muted",children:t.id}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-bold ${s.bg} ${s.text}`,children:t.estado}),e.jsx("span",{className:`text-[11px] font-semibold ${X[t.prioridad]}`,children:t.prioridad}),e.jsx("span",{className:"text-[11px] text-text-muted bg-bg-secondary px-2 py-0.5 rounded",children:o==="radio"?"Radio Enlace":o==="fibra"?"Fibra Óptica":"Infraestructura"})]}),e.jsx("p",{className:"text-sm font-semibold mt-0.5",children:t.tipo})]})]}),e.jsx("span",{className:"text-[11px] text-text-muted",children:t.fecha})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-secondary mb-2",children:[e.jsx(V,{size:12,className:"text-text-muted"}),e.jsxs("span",{children:[t.zona,t.direccion?` - ${t.direccion}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-[11px] text-text-muted flex-wrap",children:[e.jsxs("span",{children:["Técnico: ",e.jsx("span",{className:"text-text-secondary font-medium",children:t.tecnicoNombre})]}),t.metraje>0&&e.jsxs("span",{children:["Metraje: ",e.jsxs("span",{className:"text-text-secondary font-medium",children:[t.metraje,"m"]})]}),t.material&&e.jsxs("span",{children:["Material: ",e.jsx("span",{className:"text-text-secondary font-medium",children:t.material})]}),t.instalacionId&&e.jsxs("span",{children:["Instalación: ",e.jsx("span",{className:"text-accent-cyan font-medium",children:t.instalacionId})]}),e.jsx(ue,{count:t.adjuntos?.length})]}),t.estado!=="Completada"&&t.estado!=="Cancelada"&&e.jsxs("div",{className:"flex gap-2 mt-3",children:[t.estado==="Pendiente"&&e.jsx("button",{onClick:c=>{c.stopPropagation(),i(t.id,"En progreso")},className:"py-1.5 px-3 rounded-lg bg-accent-blue/20 text-accent-blue border-none text-[11px] font-semibold cursor-pointer hover:bg-accent-blue/30",children:"Iniciar trabajo"}),t.estado==="En progreso"&&e.jsx("button",{onClick:c=>{c.stopPropagation(),i(t.id,"Completada")},className:"py-1.5 px-3 rounded-lg bg-accent-green/20 text-accent-green border-none text-[11px] font-semibold cursor-pointer hover:bg-accent-green/30",children:"Marcar completada"})]})]},t.id)})]}),te&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>{N(!1),m(""),x(!1),p(""),v([])},children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-full max-w-[540px] border border-border max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Nueva Derivación"}),e.jsx("button",{onClick:()=>{N(!1),m(""),x(!1),p(""),v([])},className:"text-text-muted hover:text-text-primary cursor-pointer bg-transparent border-none",children:e.jsx(R,{size:20})})]}),e.jsxs("form",{onSubmit:ne,className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Tipo de trabajo"}),e.jsxs("select",{name:"tipo",required:!0,className:"w-full",children:[e.jsx("option",{value:"",children:"Seleccionar tipo..."}),ge.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Zona"}),e.jsx("input",{name:"zona",placeholder:"Ej: PLANICIE 1",required:!0,className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Prioridad"}),e.jsxs("select",{name:"prioridad",required:!0,className:"w-full",children:[e.jsx("option",{value:"Media",children:"Media"}),e.jsx("option",{value:"Baja",children:"Baja"}),e.jsx("option",{value:"Alta",children:"Alta"}),e.jsx("option",{value:"Crítica",children:"Crítica"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Dirección"}),e.jsx("input",{name:"direccion",placeholder:"Dirección o ubicación del trabajo",required:!0,className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Técnico asignado"}),e.jsxs("select",{name:"tecnicoId",required:!0,className:"w-full",children:[e.jsx("option",{value:"",children:"Seleccionar técnico..."}),L.filter(t=>t.estado==="Activo").map(t=>e.jsxs("option",{value:t.id,children:[t.nombre," — ",t.especialidad," (",t.zona,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Instalacion relacionada (opcional)"}),e.jsx("input",{type:"hidden",name:"instalacionId",value:O}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",placeholder:"Buscar instalacion por ID, cliente o zona...",value:b,onChange:t=>{m(t.target.value),x(!0),t.target.value||p("")},onFocus:()=>{b.length>=2&&x(!0)},className:"w-full pl-9 bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue"}),O&&e.jsx("button",{type:"button",onClick:()=>{p(""),m(""),x(!1)},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary cursor-pointer bg-transparent border-none p-0",children:e.jsx(R,{size:14})}),se&&q.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-bg-card border border-border rounded-lg shadow-xl z-50 max-h-[200px] overflow-y-auto",children:q.map(t=>e.jsxs("button",{type:"button",onClick:()=>{p(t.id),m(`${t.id} — ${t.clienteNombre||t.prospectoNombre||""} (${t.zona||""})`),x(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-bg-secondary cursor-pointer border-none bg-transparent text-text-primary transition-colors flex items-center justify-between",children:[e.jsxs("span",{className:"truncate",children:[t.id," — ",t.clienteNombre||t.prospectoNombre||"Sin cliente"]}),e.jsx("span",{className:"text-[10px] text-text-muted font-mono ml-2",children:t.zona||""})]},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Metraje estimado (m)"}),e.jsx("input",{name:"metraje",type:"number",placeholder:"0",min:"0",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Material requerido"}),e.jsx("input",{name:"material",placeholder:"Ej: Fibra monomodo 12 hilos",className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Adjuntos del problema (opcional)"}),e.jsx(Z,{value:$,onChange:v,max:5,compact:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Descripción"}),e.jsx("textarea",{name:"descripcion",placeholder:"Describe el trabajo a realizar...",required:!0,className:"bg-bg-secondary border border-border text-text-primary p-3 rounded-lg text-sm min-h-[80px] resize-y outline-none focus:border-accent-blue w-full font-[inherit]"})]}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>{N(!1),m(""),x(!1),p(""),v([])},className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer text-sm",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 py-2.5 rounded-lg bg-accent-purple border-none text-white cursor-pointer text-sm font-semibold hover:opacity-90",children:"Crear Derivación"})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>{d(null),u(!1)},children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-full max-w-[600px] border border-border max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-start mb-5",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-mono text-sm text-text-muted",children:a.id}),e.jsx("span",{className:`px-2.5 py-0.5 rounded text-[11px] font-bold ${(f[a.estado]||f.Pendiente).bg} ${(f[a.estado]||f.Pendiente).text}`,children:a.estado})]}),e.jsx("h3",{className:"text-lg font-bold",children:a.tipo})]}),e.jsx("button",{onClick:()=>{d(null),u(!1)},className:"text-text-muted hover:text-text-primary cursor-pointer bg-transparent border-none",children:e.jsx(R,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Zona"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(V,{size:12})," ",a.zona]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Prioridad"}),e.jsx("span",{className:`font-semibold ${X[a.prioridad]}`,children:a.prioridad})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Dirección"}),e.jsx("span",{className:"font-medium",children:a.direccion})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Técnico asignado"}),e.jsx("span",{className:"font-medium",children:a.tecnicoNombre})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Fecha de creación"}),e.jsx("span",{className:"font-medium",children:a.fecha})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Fecha completado"}),e.jsx("span",{className:"font-medium",children:a.fechaCompletado||"—"})]}),a.metraje>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Metraje estimado"}),e.jsxs("span",{className:"font-medium",children:[a.metraje," metros"]})]}),a.material&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-text-muted block mb-0.5",children:"Material requerido"}),e.jsx("span",{className:"font-medium",children:a.material})]})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Descripción"}),e.jsx("p",{className:"text-sm",children:a.descripcion})]}),a.adjuntos&&a.adjuntos.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide font-semibold mb-2",children:"Adjuntos / Evidencia"}),e.jsx(Z,{value:a.adjuntos,onChange:()=>{},readOnly:!0,max:5})]}),a.instalacionId&&(()=>{const t=le(a.instalacionId);return t?e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 mb-4 border border-border",children:[e.jsxs("p",{className:"text-xs text-text-muted mb-2 flex items-center gap-1.5",children:[e.jsx(g,{size:12})," Instalación relacionada"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"ID:"})," ",e.jsx("span",{className:"font-mono text-accent-cyan",children:t.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Cliente:"})," ",e.jsx("span",{className:"font-medium",children:t.clienteNombre})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Tipo:"})," ",e.jsx("span",{className:"font-medium",children:t.tipo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Tecnología:"})," ",e.jsx("span",{className:"font-medium",children:t.tecnologia})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Plan:"})," ",e.jsx("span",{className:"font-medium",children:t.plan})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Estado:"})," ",e.jsx("span",{className:"font-medium",children:t.estado})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-text-muted",children:"Dirección:"})," ",e.jsx("span",{className:"font-medium",children:t.direccion})]}),t.observaciones&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-text-muted",children:"Observaciones:"})," ",e.jsx("span",{className:"text-text-secondary",children:t.observaciones})]})]})]}):null})(),a.estado==="Completada"&&a.metricaAntes&&e.jsxs("div",{className:"bg-accent-green/10 rounded-lg p-3 mb-4 border border-accent-green/20",children:[e.jsxs("p",{className:"text-xs text-accent-green font-semibold mb-2 flex items-center gap-1.5",children:[e.jsx(W,{size:12})," Métricas de cierre"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Métrica antes:"})," ",e.jsx("span",{className:"font-medium",children:a.metricaAntes})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"Métrica después:"})," ",e.jsx("span",{className:"font-medium text-accent-green",children:a.metricaDespues})]}),a.observacionesCierre&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-text-muted",children:"Observaciones:"})," ",e.jsx("span",{className:"text-text-secondary",children:a.observacionesCierre})]})]})]}),D&&a.estado!=="Completada"&&a.estado!=="Cancelada"&&e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-4 mb-4 border border-accent-green/30",children:[e.jsx("p",{className:"text-xs text-accent-green font-semibold mb-3",children:"Formulario de cierre"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Métrica antes"}),e.jsx("input",{placeholder:"Ej: -18dBm, 25Mbps",value:l.metricaAntes,onChange:t=>z(s=>({...s,metricaAntes:t.target.value})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Métrica después"}),e.jsx("input",{placeholder:"Ej: -14dBm, 95Mbps",value:l.metricaDespues,onChange:t=>z(s=>({...s,metricaDespues:t.target.value})),className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted block mb-1",children:"Observaciones de cierre"}),e.jsx("textarea",{placeholder:"Descripción del trabajo realizado, observaciones...",value:l.observaciones,onChange:t=>z(s=>({...s,observaciones:t.target.value})),className:"bg-bg-secondary border border-border text-text-primary p-3 rounded-lg text-sm min-h-[60px] resize-y outline-none focus:border-accent-green w-full font-[inherit]"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 py-2 rounded-lg bg-bg-card border border-border text-text-secondary text-xs cursor-pointer",children:"Cancelar"}),e.jsx("button",{onClick:ce,className:"flex-1 py-2 rounded-lg bg-accent-green border-none text-white text-xs font-semibold cursor-pointer hover:opacity-90",children:"Completar con métricas"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[a.estado==="Pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(a.id,"En progreso"),className:"flex-1 py-2.5 rounded-lg bg-accent-blue/20 text-accent-blue border-none text-xs font-semibold cursor-pointer hover:bg-accent-blue/30",children:"Pasar a En progreso"}),e.jsx("button",{onClick:()=>i(a.id,"Cancelada"),className:"py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-muted text-xs cursor-pointer hover:text-text-secondary",children:"Cancelar"})]}),a.estado==="En progreso"&&e.jsxs(e.Fragment,{children:[!D&&e.jsx("button",{onClick:()=>u(!0),className:"flex-1 py-2.5 rounded-lg bg-accent-green/20 text-accent-green border-none text-xs font-semibold cursor-pointer hover:bg-accent-green/30",children:"Completar con métricas"}),!D&&e.jsx("button",{onClick:()=>i(a.id,"Completada"),className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary text-xs cursor-pointer hover:border-accent-green/50",children:"Marcar Completada"}),!D&&e.jsx("button",{onClick:()=>i(a.id,"Reprogramada"),className:"py-2.5 px-4 rounded-lg bg-cyan-500/20 text-cyan-400 border-none text-xs font-semibold cursor-pointer hover:bg-cyan-500/30",children:"Reprogramar"}),e.jsx("button",{onClick:()=>i(a.id,"Cancelada"),className:"py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-muted text-xs cursor-pointer hover:text-text-secondary",children:"Cancelar"})]}),a.estado==="Reprogramada"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(a.id,"En progreso"),className:"flex-1 py-2.5 rounded-lg bg-accent-blue/20 text-accent-blue border-none text-xs font-semibold cursor-pointer hover:bg-accent-blue/30",children:"Retomar En Progreso"}),e.jsx("button",{onClick:()=>i(a.id,"Cancelada"),className:"py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-muted text-xs cursor-pointer hover:text-text-secondary",children:"Cancelar"})]}),(a.estado==="Completada"||a.estado==="Cancelada")&&e.jsx("button",{onClick:()=>{d(null),u(!1)},className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary text-xs cursor-pointer",children:"Cerrar"})]})]})}),e.jsx(be,{open:ae,onClose:()=>{T(!1),M(null)},onConfirm:oe,title:"Completar Trabajo de Planta Externa",entityId:h?n.find(t=>t.id===h.derivacionId)?.id:"",entityLabel:"Derivacion",newStatus:"Completada",accentColor:"accent-purple"})]})}export{Te as default};
