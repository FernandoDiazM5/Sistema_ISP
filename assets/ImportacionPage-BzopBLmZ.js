import{c as B,r as f,j as e,g as le,B as ce,U as ie,h as H,W as V,i as q,a as x,T as de,R as J,t as xe,k as me}from"./index-DIKRPrqK.js";import{read as pe,utils as y,writeFile as A}from"./xlsx-CNerDvZX.js";import{F as T,D as F}from"./file-spreadsheet-CBgyFvL7.js";import{K as E}from"./KPICard-Bl-5sFMW.js";import{L as he}from"./loader-circle-b-03_wZ1.js";import{H as be}from"./history-DuzK2eqj.js";import{P as ue}from"./pen-line-DoB9Rc1E.js";import{C as ge}from"./clock-BjgmMrVS.js";import{D as $}from"./download-BTQhoAFW.js";import{U as fe}from"./upload-DU81spUc.js";import{T as je}from"./trash-2-iPzHOsuE.js";import{P as Ne}from"./plus-kuQV4eW5.js";const ye=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],U=B("archive",ye);const ve=[["path",{d:"M10.94 5.274A7 7 0 0 1 15.71 10h1.79a4.5 4.5 0 0 1 4.222 6.057",key:"1uxyv8"}],["path",{d:"M18.796 18.81A4.5 4.5 0 0 1 17.5 19H9A7 7 0 0 1 5.79 5.78",key:"99tcn7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Se=B("cloud-off",ve);function we({onDataLoaded:o,loading:r}){const n=f.useRef(null),m=l=>{if(!l)return;const p=new FileReader;p.onload=N=>{const v=pe(N.target.result,{type:"array",cellText:!1,cellDates:!1,raw:!1}),I=v.Sheets[v.SheetNames[0]],g=y.sheet_to_json(I,{range:1,defval:"",raw:!1});o(g,l.name)},p.readAsArrayBuffer(l)},a=l=>{l.preventDefault(),l.stopPropagation();const p=l.dataTransfer.files[0];p&&(p.name.endsWith(".xlsx")||p.name.endsWith(".xls"))&&m(p)},d=l=>{l.preventDefault(),l.stopPropagation()};return e.jsxs("div",{onDrop:a,onDragOver:d,onClick:()=>n.current?.click(),className:"bg-bg-card rounded-2xl p-10 border-2 border-dashed border-border text-center cursor-pointer transition-colors hover:border-accent-blue/50 group",children:[e.jsx("input",{ref:n,type:"file",accept:".xlsx,.xls",className:"hidden",onChange:l=>m(l.target.files[0])}),e.jsx("div",{className:"mb-6 text-accent-blue group-hover:scale-110 transition-transform inline-block",children:e.jsx(le,{size:48,strokeWidth:1.5})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r?"Procesando archivo...":"Arrastra tu archivo Excel aquí"}),e.jsx("p",{className:"text-text-muted text-[13px] mb-6 max-w-[400px] mx-auto",children:"El sistema aplicará automáticamente las 9 reglas de limpieza: separación de nombres, corrección de móviles, detección de tecnología, parseo de deuda y más."}),e.jsxs("div",{className:"inline-flex items-center gap-2 py-2.5 px-5 rounded-xl bg-accent-blue text-white text-sm font-semibold",children:[e.jsx(T,{size:16}),"Seleccionar archivo Excel"]}),e.jsx("p",{className:"mt-4 text-[11px] text-text-muted",children:'Soporta .xlsx, .xls — Formato estándar "Lista de Usuarios" del ISP externo'})]})}function Ce({stats:o,changes:r,onConfirm:n,onCancel:m}){return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsx(E,{title:"Registros Leídos",value:o.total,icon:e.jsx(ce,{size:20}),color:"#6b7280"}),e.jsx(E,{title:"Nuevos Clientes",value:o.new,icon:e.jsx(ie,{size:20}),color:"#10b981"}),e.jsx(E,{title:"Modificados",value:o.modified,icon:e.jsx(H,{size:20}),color:"#f59e0b"}),e.jsx(E,{title:"Sin Cambios",value:o.unchanged,icon:e.jsx(V,{size:20}),color:"#3b82f6"})]}),e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border overflow-hidden",children:[e.jsxs("div",{className:"py-4 px-6 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Detalle de Cambios Detectados"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:"py-2 px-4 rounded-lg bg-bg-secondary border border-border text-text-secondary text-xs font-semibold cursor-pointer hover:border-accent-red transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:n,className:"py-2 px-4 rounded-lg bg-accent-green border-none text-white text-xs font-semibold cursor-pointer flex items-center gap-1.5 hover:opacity-90 transition-opacity",children:[e.jsx(q,{size:14}),"Confirmar Importación"]})]})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:e.jsxs("table",{className:"w-full border-collapse text-[13px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-bg-secondary text-left sticky top-0",children:[e.jsx("th",{className:"py-3 px-6 w-20 text-[11px] text-text-secondary uppercase",children:"Tipo"}),e.jsx("th",{className:"py-3 px-6 text-[11px] text-text-secondary uppercase",children:"Cliente"}),e.jsx("th",{className:"py-3 px-6 text-[11px] text-text-secondary uppercase",children:"Detalle del Cambio"})]})}),e.jsxs("tbody",{children:[r.map((a,d)=>e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:`py-1 px-2 rounded text-[11px] font-bold
                      ${a.type==="NEW"?"bg-accent-green/20 text-accent-green":"bg-accent-yellow/20 text-accent-yellow"}`,children:a.type==="NEW"?"NUEVO":"MODIF"})}),e.jsxs("td",{className:"py-3 px-6",children:[e.jsx("div",{className:"font-medium",children:a.type==="NEW"?a.data.nombre:a.nombre}),e.jsxs("div",{className:"text-[11px] text-text-muted",children:["ID: ",a.type==="NEW"?a.data.id:a.id]})]}),e.jsx("td",{className:"py-3 px-6",children:a.type==="NEW"?e.jsx("span",{className:"text-text-muted",children:"Registro completo nuevo"}):e.jsx("div",{className:"flex flex-col gap-1",children:a.diffs.map((l,p)=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-text-secondary",children:[l.field,":"]})," ",e.jsx("span",{className:"line-through text-text-muted",children:l.old})," ","→ ",e.jsx("span",{className:"text-text-primary font-medium",children:l.new})]},p))})})]},d)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"py-6 text-center text-text-muted",children:"No se detectaron cambios significativos entre la data actual y el archivo importado."})})]})]})})]})]})}function De({current:o,total:r,stage:n}){const m=r>0?Math.round(o/r*100):0,a={reading:"Leyendo archivo Excel...",transforming:"Aplicando reglas ETL...",comparing:"Comparando con datos actuales...",done:"Procesamiento completado"};return e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(he,{size:20,className:"text-accent-blue animate-spin"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:a[n]||"Procesando..."}),e.jsxs("p",{className:"text-[11px] text-text-muted",children:[o," de ",r," registros"]})]}),e.jsxs("span",{className:"ml-auto text-lg font-bold text-accent-blue font-mono",children:[m,"%"]})]}),e.jsx("div",{className:"w-full h-2.5 bg-bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-accent-blue to-accent-purple rounded-full transition-all duration-300",style:{width:`${m}%`}})})]})}function ke(){const o=x(r=>r.importHistory);return o.length===0?null:e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-5 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{size:18,className:"text-accent-blue"}),e.jsx("h3",{className:"text-sm font-semibold",children:"Historial de Importaciones"}),e.jsxs("span",{className:"ml-auto text-[11px] text-text-muted",children:[o.length," registros"]})]}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-[12px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-[10px] text-text-muted uppercase border-b border-border",children:[e.jsx("th",{className:"py-2 px-3",children:"ID"}),e.jsx("th",{className:"py-2 px-3",children:"Fecha"}),e.jsx("th",{className:"py-2 px-3",children:"Archivo"}),e.jsx("th",{className:"py-2 px-3 text-center",children:"Total"}),e.jsx("th",{className:"py-2 px-3 text-center",children:"Nuevos"}),e.jsx("th",{className:"py-2 px-3 text-center",children:"Modif."}),e.jsx("th",{className:"py-2 px-3 text-center",children:"Sin cambios"}),e.jsx("th",{className:"py-2 px-3",children:"Modo"})]})}),e.jsx("tbody",{children:o.map(r=>e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("td",{className:"py-2 px-3 font-mono text-text-muted",children:r.id}),e.jsx("td",{className:"py-2 px-3 text-text-secondary",children:new Date(r.fecha).toLocaleString("es-PE",{dateStyle:"short",timeStyle:"short"})}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(T,{size:12,className:"text-accent-green"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:r.fileName})]})}),e.jsx("td",{className:"py-2 px-3 text-center font-mono",children:r.total}),e.jsx("td",{className:"py-2 px-3 text-center font-mono text-accent-green",children:r.new}),e.jsx("td",{className:"py-2 px-3 text-center font-mono text-accent-yellow",children:r.modified}),e.jsx("td",{className:"py-2 px-3 text-center font-mono text-text-muted",children:r.unchanged}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:"py-0.5 px-2 rounded text-[10px] font-semibold bg-accent-blue/15 text-accent-blue",children:r.mode||"Completa"})})]},r.id))})]})})]})}const W=[{key:"separateNameStatus",label:"Separar Nombre y Estado",desc:"Extrae el estado (ACTIVO/SUSPENDIDO) del campo Nombre"},{key:"classifyEmail",label:"Clasificar Email",desc:"Detecta si el campo Correo contiene email real o notas técnicas"},{key:"splitMobile",label:"Separar Móviles",desc:"Divide números múltiples en móvil principal y secundario"},{key:"parseDebt",label:"Parsear Deuda",desc:'Extrae meses y monto de deuda del campo "Deuda actual"'},{key:"parsePrices",label:"Parsear Precios",desc:'Convierte "S/. 65.00" → número 65'},{key:"inferTechnology",label:"Inferir Tecnología",desc:"Detecta Radio Enlace vs Fibra Óptica desde el nodo/router"},{key:"separateTV",label:"Separar TV Cable",desc:"Extrae servicio de TV Cable y cantidad de decos del plan"},{key:"normalizeCortePorDeuda",label:"Normalizar Corte",desc:'Detecta "Cortado por deuda" desde la combinación de campos'},{key:"formatDNI",label:"Formatear DNI",desc:"Limpia y normaliza el campo Cédula/DNI"}];function Ee(){const o=x(a=>a.cleaningOptions),r=x(a=>a.setCleaningOptions),n=a=>{r({...o,[a]:!o[a]})},m=Object.values(o).filter(Boolean).length;return e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-5 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:18,className:"text-accent-purple"}),e.jsx("h3",{className:"text-sm font-semibold",children:"Reglas de Limpieza ETL"})]}),e.jsxs("span",{className:"text-[11px] text-text-muted bg-bg-secondary py-1 px-2.5 rounded-lg",children:[m,"/",W.length," activas"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:W.map(a=>e.jsxs("label",{className:`flex items-start gap-2.5 p-3 rounded-xl border cursor-pointer transition-all
              ${o[a.key]?"border-accent-purple/30 bg-accent-purple/5":"border-border bg-bg-secondary hover:border-border"}`,children:[e.jsx("input",{type:"checkbox",checked:o[a.key],onChange:()=>n(a.key),className:"mt-0.5 accent-accent-purple"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold",children:a.label}),e.jsx("p",{className:"text-[10px] text-text-muted mt-0.5",children:a.desc})]})]},a.key))})]})}function Ie({items:o,onFix:r}){return!o||o.length===0?null:e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-accent-yellow/30 p-5 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(de,{size:18,className:"text-accent-yellow"}),e.jsx("h3",{className:"text-sm font-semibold",children:"Revisión Manual Requerida"}),e.jsxs("span",{className:"ml-auto text-[11px] text-accent-yellow font-semibold bg-accent-yellow/10 py-1 px-2.5 rounded-lg",children:[o.length," registros"]})]}),e.jsx("p",{className:"text-[11px] text-text-muted mb-3",children:"Estos registros tienen datos que no pudieron ser procesados automáticamente por las reglas ETL."}),e.jsx("div",{className:"max-h-[250px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-[12px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-[10px] text-text-muted uppercase border-b border-border sticky top-0 bg-bg-card",children:[e.jsx("th",{className:"py-2 px-3",children:"ID"}),e.jsx("th",{className:"py-2 px-3",children:"Nombre"}),e.jsx("th",{className:"py-2 px-3",children:"Problema"}),e.jsx("th",{className:"py-2 px-3",children:"Campo"}),e.jsx("th",{className:"py-2 px-3",children:"Valor Original"}),e.jsx("th",{className:"py-2 px-3 text-center",children:"Acción"})]})}),e.jsx("tbody",{children:o.map((n,m)=>e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("td",{className:"py-2 px-3 font-mono text-text-muted text-[11px]",children:n.id}),e.jsx("td",{className:"py-2 px-3 font-medium",children:n.nombre}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:`py-0.5 px-2 rounded text-[10px] font-semibold
                    ${n.tipo==="movil"?"bg-accent-red/15 text-accent-red":n.tipo==="tecnologia"?"bg-accent-yellow/15 text-accent-yellow":"bg-accent-blue/15 text-accent-blue"}`,children:n.tipo==="movil"?"Móvil inválido":n.tipo==="tecnologia"?"Tecnología no detectada":n.tipo==="deuda"?"Deuda no parseable":n.tipo})}),e.jsx("td",{className:"py-2 px-3 text-text-secondary",children:n.campo}),e.jsx("td",{className:"py-2 px-3 font-mono text-[11px] text-accent-red",children:n.valorOriginal}),e.jsx("td",{className:"py-2 px-3 text-center",children:r&&e.jsx("button",{onClick:()=>r(n),className:"p-1 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer hover:border-accent-blue hover:text-accent-blue transition-colors",children:e.jsx(ue,{size:12})})})]},m))})]})})]})}function ze(){const o=x(d=>d.lastImport),r=x(d=>d.dataSource),n=x(d=>d.clients),a=(()=>{if(!o)return{icon:e.jsx(Se,{size:16}),label:"Sin sincronizar",color:"text-text-muted",bg:"bg-bg-secondary",detail:"No se ha realizado ninguna importación"};const d=new Date(o.date),l=(Date.now()-d.getTime())/(1e3*60*60);return l<1?{icon:e.jsx(q,{size:16}),label:"Sincronizado",color:"text-accent-green",bg:"bg-accent-green/10",detail:`Hace ${Math.round(l*60)} minutos`}:l<24?{icon:e.jsx(ge,{size:16}),label:"Actualizado hoy",color:"text-accent-blue",bg:"bg-accent-blue/10",detail:d.toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit"})}:{icon:e.jsx(J,{size:16}),label:"Desactualizado",color:"text-accent-yellow",bg:"bg-accent-yellow/10",detail:d.toLocaleDateString("es-PE")}})();return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl ${a.bg} border border-border mb-6`,children:[e.jsx("div",{className:a.color,children:a.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-xs font-semibold ${a.color}`,children:a.label}),e.jsx("p",{className:"text-[10px] text-text-muted",children:a.detail})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-[10px] text-text-muted",children:["Fuente: ",e.jsx("span",{className:"font-semibold text-text-secondary",children:r==="excel"?"Excel":"Demo"})]}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:[n.length," clientes cargados"]})]}),o&&e.jsxs("div",{className:"text-right border-l border-border pl-3",children:[e.jsxs("p",{className:"text-[10px] text-text-muted",children:["Último: ",e.jsx("span",{className:"font-mono",children:o.fileName})]}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:[e.jsxs("span",{className:"text-accent-green",children:[o.new," nuevos"]})," · ",e.jsxs("span",{className:"text-accent-yellow",children:[o.modified," modif."]})]})]})]})}function Be(){const o=x(s=>s.clients),r=x(s=>s.importClients),n=x(s=>s.setLastImport),m=x(s=>s.addImportRecord),a=x(s=>s.cleaningOptions),d=x(s=>s.restoreSystem),l=x(s=>s.factoryReset),[p,N]=f.useState("upload"),[v,I]=f.useState(""),[g,G]=f.useState({new:0,modified:0,unchanged:0,total:0}),[R,K]=f.useState([]),[D,Y]=f.useState([]),[O,Z]=f.useState([]),[z,S]=f.useState({current:0,total:0,stage:"reading"}),[j,Q]=f.useState("inteligente"),[_,X]=f.useState(!1),M=f.useRef(null),ee=(s,h)=>{I(h),N("processing"),S({current:0,total:s.length,stage:"reading"}),setTimeout(()=>{S(c=>({...c,stage:"transforming"}));const i=[],t=s.map((c,C)=>{C%50===0&&S(k=>({...k,current:C,stage:"transforming"}));const u=xe(c);if(a.splitMobile){const k=u.movil_1?.replace(/\D/g,"")||"";k.length>0&&k.length<9&&i.push({id:u.id,nombre:u.nombre,tipo:"movil",campo:"Móvil",valorOriginal:u.movil_1})}return a.inferTechnology&&u.tecnologia==="No determinada"&&i.push({id:u.id,nombre:u.nombre,tipo:"tecnologia",campo:"Tecnología",valorOriginal:u.nodo_router||"—"}),u});S({current:s.length,total:s.length,stage:"comparing"}),Z(i);const b=[],w=[];let P=0;const ne=new Map(o.map(c=>[c.id,c]));t.forEach(c=>{const C=ne.get(c.id);if(!C)b.push(c);else if(j!=="nuevos"){const u=me(C,c);u.length>0?w.push({id:c.id,nombre:c.nombre,diffs:u,newData:c}):P++}else P++}),G({new:b.length,modified:w.length,unchanged:P,total:t.length}),K([...b.map(c=>({type:"NEW",data:c})),...w.map(c=>({type:"MOD",...c}))]),Y(t),S({current:s.length,total:s.length,stage:"done"}),setTimeout(()=>N("preview"),500)},100)},te=()=>{let s;if(j==="completa")s=D;else if(j==="nuevos"){const i=new Set(R.filter(t=>t.type==="NEW").map(t=>t.data.id));s=[...o,...D.filter(t=>i.has(t.id))]}else{const i=new Map(D.map(t=>[t.id,t]));s=o.map(t=>i.get(t.id)||t),D.forEach(t=>{o.find(b=>b.id===t.id)||s.push(t)})}r(s);const h={date:new Date().toISOString(),fileName:v,total:g.total,new:g.new,modified:g.modified,unchanged:g.unchanged};n(h),m({...h,mode:j}),N("finished")},L=()=>{const s=o.map(t=>({Id:t.id,Nombre:`${t.nombre}  ${t.estado_cuenta}`,Mac:t.mac,Ip:t.ip,"IP Receptor":t.ip_receptor,"Ultimo pago":t.ultimo_pago,"Tipo estrato":t.tipo_estrato,"Dirección Principal":t.direccion,"Dirección Servicio":t.direccion_servicio,"Dia pago":t.dia_pago,"Deuda actual":t.deuda_monto>0?`${t.deuda_meses} S/. ${t.deuda_monto.toFixed(2)}`:"",Correo:t.email||t.notas_tecnicas,Plan:t.plan,"Proximo pago":t.proximo_pago,Movil:t.movil_2?`${t.movil_1}${t.movil_2}`:t.movil_1,Saldo:t.saldo,Router:t.nodo_router,Instalado:t.fecha_instalacion,Cedula:t.dni,"User PPP/Hotspot":t.user_ppp,Codigo:t.codigo,"Total cobrar":`S/. ${t.precio.toFixed(2)}`,Zona:t.zona,Status:t.status})),h=y.json_to_sheet(s),i=y.book_new();y.book_append_sheet(i,h,"Sheet1"),A(i,"Lista_de_Usuarios_Actualizada.xlsx")},se=()=>{const s=x.getState(),h=y.book_new();[{name:"Clientes",data:s.clients},{name:"Tickets",data:s.tickets},{name:"Averias",data:s.averias},{name:"Visitas",data:s.visitas},{name:"Tecnicos",data:s.tecnicos},{name:"Equipos",data:s.equipos},{name:"Instalaciones",data:s.instalaciones},{name:"PostVenta",data:s.postVenta},{name:"SoporteRemoto",data:s.sesionesRemoto},{name:"Derivaciones",data:s.derivaciones},{name:"HistorialImport",data:s.importHistory},{name:"LogsWhatsApp",data:s.whatsappLogs},{name:"Plantillas",data:s.templates}].forEach(({name:t,data:b})=>{if(b&&Array.isArray(b)&&b.length>0){const w=y.json_to_sheet(b);y.book_append_sheet(h,w,t)}}),A(h,`ISP_Backup_Completo_${new Date().toISOString().slice(0,10)}.xlsx`)},ae=()=>{const h={...x.getState()},i="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(h,null,2)),t=document.createElement("a");t.setAttribute("href",i),t.setAttribute("download",`ISP_System_Backup_${new Date().toISOString().slice(0,10)}.json`),document.body.appendChild(t),t.click(),t.remove()},oe=s=>{const h=s.target.files[0];if(!h)return;const i=new FileReader;i.onload=async t=>{try{const b=JSON.parse(t.target.result);await d(b),alert("Sistema restaurado correctamente. La página se recargará para aplicar los cambios."),window.location.reload()}catch(b){alert("Error al leer el archivo de respaldo: "+b.message)}},i.readAsText(h),s.target.value=""},re=()=>{window.confirm(`⚠️ ¿Estás seguro de realizar un FACTORY RESET?

Esta acción eliminará TODOS los datos guardados en la base de datos local (IndexedDB) y recargará el sistema con los datos iniciales del archivo db.json.

Se recomienda exportar un backup antes.`)&&l()};return p==="finished"?e.jsxs("div",{className:"p-10 text-center h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-accent-green text-white flex items-center justify-center mb-6",children:e.jsx(V,{size:28})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Importación Exitosa"}),e.jsxs("p",{className:"text-text-secondary mb-2",children:["Se procesaron ",e.jsx("span",{className:"text-text-primary font-semibold",children:g.total})," registros del archivo ",e.jsx("span",{className:"font-mono text-xs text-accent-blue",children:v})]}),e.jsxs("p",{className:"text-text-muted text-sm mb-2",children:[g.new," nuevos · ",g.modified," modificados · ",g.unchanged," sin cambios"]}),e.jsxs("p",{className:"text-[11px] text-text-muted mb-6",children:["Modo: ",e.jsx("span",{className:"font-semibold",children:j==="completa"?"Reemplazo completo":j==="nuevos"?"Solo nuevos":"Sincronización inteligente"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>N("upload"),className:"py-2.5 px-6 rounded-lg bg-bg-secondary border border-border text-text-primary cursor-pointer text-sm",children:"Nueva importación"}),e.jsxs("button",{onClick:L,className:"py-2.5 px-6 rounded-lg bg-accent-blue border-none text-white cursor-pointer text-sm font-semibold flex items-center gap-2",children:[e.jsx($,{size:16}),"Exportar Excel"]})]})]}):e.jsxs("div",{className:"animate-fade p-6 px-8 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-[26px] font-bold",children:"Importar Datos"}),e.jsx("p",{className:"text-text-secondary text-sm",children:"Sincronización desde Excel fuente (ISP Externo)"})]}),e.jsx("div",{className:"flex items-center gap-2",children:o.length>0&&e.jsxs("button",{onClick:L,className:"py-2 px-4 rounded-lg bg-bg-card border border-border text-text-secondary text-xs font-semibold cursor-pointer flex items-center gap-1.5 hover:border-accent-blue transition-colors",children:[e.jsx($,{size:14}),"Exportar datos"]})})]}),e.jsx(ze,{}),p==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-5 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(U,{size:18,className:"text-accent-green"}),e.jsx("h3",{className:"text-sm font-semibold",children:"Copia de Seguridad (Backup)"})]}),e.jsx("p",{className:"text-[11px] text-text-muted mb-4",children:"Descarga una copia completa de toda la información del sistema (Clientes, Tickets, Visitas, etc.) para evitar pérdida de datos."}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:se,className:"flex items-center gap-2 py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-primary text-xs font-semibold cursor-pointer hover:border-accent-green transition-colors",children:[e.jsx(T,{size:16,className:"text-accent-green"}),"Exportar Todo (Excel)"]}),e.jsxs("button",{onClick:ae,className:"flex items-center gap-2 py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-primary text-xs font-semibold cursor-pointer hover:border-accent-blue transition-colors",children:[e.jsx(U,{size:16,className:"text-accent-blue"}),"Exportar General"]}),e.jsx("input",{type:"file",ref:M,accept:".json",onChange:oe,className:"hidden"}),e.jsxs("button",{onClick:()=>M.current?.click(),className:"flex items-center gap-2 py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-primary text-xs font-semibold cursor-pointer hover:border-accent-purple transition-colors",children:[e.jsx(fe,{size:16,className:"text-accent-purple"}),"Importar General"]}),e.jsxs("button",{onClick:re,className:"flex items-center gap-2 py-2.5 px-4 rounded-lg bg-accent-red/10 border border-accent-red/30 text-accent-red text-xs font-semibold cursor-pointer hover:bg-accent-red/20 transition-colors ml-auto",children:[e.jsx(je,{size:16}),"Factory Reset"]})]})]}),e.jsxs("div",{className:"bg-bg-card rounded-2xl border border-border p-5 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(F,{size:18,className:"text-accent-blue"}),e.jsx("h3",{className:"text-sm font-semibold",children:"Modo de Importación"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"inteligente",label:"Inteligente",desc:"Compara e integra nuevos y modificados sin perder datos existentes",icon:e.jsx(J,{size:16})},{value:"completa",label:"Reemplazo Completo",desc:"Reemplaza toda la base de datos con el archivo importado",icon:e.jsx(F,{size:16})},{value:"nuevos",label:"Solo Nuevos",desc:"Agrega únicamente registros que no existen en el sistema",icon:e.jsx(Ne,{size:16})}].map(s=>e.jsxs("label",{className:`flex items-start gap-3 p-4 rounded-xl border cursor-pointer transition-all
                    ${j===s.value?"border-accent-blue bg-accent-blue/5":"border-border bg-bg-secondary hover:border-border"}`,children:[e.jsx("input",{type:"radio",name:"importMode",value:s.value,checked:j===s.value,onChange:()=>Q(s.value),className:"mt-1 accent-accent-blue"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-accent-blue",children:s.icon}),e.jsx("p",{className:"text-sm font-semibold",children:s.label})]}),e.jsx("p",{className:"text-[11px] text-text-muted mt-1",children:s.desc})]})]},s.value))})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>X(!_),className:"text-xs text-accent-purple font-semibold cursor-pointer bg-transparent border-none flex items-center gap-1 hover:opacity-80",children:[e.jsx("span",{children:_?"▾":"▸"}),"Configurar reglas de limpieza ETL (",Object.values(a).filter(Boolean).length,"/9 activas)"]})}),_&&e.jsx(Ee,{}),e.jsx(we,{onDataLoaded:ee,loading:!1}),e.jsx("div",{className:"mt-6",children:e.jsx(ke,{})})]}),p==="processing"&&e.jsx(De,{current:z.current,total:z.total,stage:z.stage}),p==="preview"&&e.jsxs(e.Fragment,{children:[O.length>0&&e.jsx(Ie,{items:O}),e.jsx(Ce,{stats:g,changes:R,onConfirm:te,onCancel:()=>N("upload")})]})]})}export{Be as default};
