import{c as Qe,n as Du,a as de,_ as ku,r as Me,j as m,u as Ou,C as xs,h as ju,U as Mu,W as Lu,o as Ve,i as Ut,D as Fu,T as tc,g as qo,R as Uu,F as Bu}from"./index-DIKRPrqK.js";import{C as zu}from"./Card-D5MAPnej.js";import{B as qu}from"./Button-BDJi8lNV.js";import{S as nc,M as $o}from"./shield-YiQZRT0z.js";import{C as $u}from"./circle-alert-D-lkZdSC.js";import{P as Gu}from"./plus-kuQV4eW5.js";import{T as rc}from"./trash-2-iPzHOsuE.js";import{D as mr,F as Hu}from"./file-spreadsheet-CBgyFvL7.js";import{S as Go}from"./sparkles-V2u05z37.js";import{S as Ho}from"./save-DXxuBT6P.js";import{H as Ku}from"./history-DuzK2eqj.js";import{L as As}from"./loader-circle-b-03_wZ1.js";import{C as Wu}from"./clock-BjgmMrVS.js";const Qu=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],sc=Qe("cloud-download",Qu);const Ju=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Yu=Qe("file-braces",Ju);const Xu=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5",key:"14wa3c"}],["path",{d:"M12 7.5V9",key:"1oy5b0"}],["path",{d:"M7.5 12H9",key:"eltsq1"}],["path",{d:"M16.5 12H15",key:"vk5kw4"}],["path",{d:"M12 16.5V15",key:"k7eayi"}],["path",{d:"m8 8 1.88 1.88",key:"nxy4qf"}],["path",{d:"M14.12 9.88 16 8",key:"1lst6k"}],["path",{d:"m8 16 1.88-1.88",key:"h2eex1"}],["path",{d:"M14.12 14.12 16 16",key:"uqkrx3"}]],Zu=Qe("flower",Xu);const eh=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],th=Qe("globe",eh);const nh=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],rh=Qe("leaf",nh);const sh=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],ih=Qe("moon",sh);const oh=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ah=Qe("smartphone",oh);const ch=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],lh=Qe("sun",ch);const uh=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],hh=Qe("wind",uh),dh=()=>{};var Ko={};const ic=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},fh=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},oc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,g=o>>2,v=(o&3)<<4|u>>4;let T=(u&15)<<2|d>>6,S=d&63;h||(S=64,a||(T=64)),r.push(t[g],t[v],t[T],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ic(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):fh(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const v=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||v==null)throw new mh;const T=o<<2|u>>4;if(r.push(T),d!==64){const S=u<<4&240|d>>2;if(r.push(S),v!==64){const D=d<<6&192|v;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class mh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ph=function(n){const e=ic(n);return oc.encodeByteArray(e,!0)},br=function(n){return ph(n).replace(/\./g,"")},gh=function(n){try{return oc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function _h(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const yh=()=>_h().__FIREBASE_DEFAULTS__,Eh=()=>{if(typeof process>"u"||typeof Ko>"u")return;const n=Ko.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},vh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&gh(n[1]);return e&&JSON.parse(e)},ai=()=>{try{return dh()||yh()||Eh()||vh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},bh=n=>ai()?.emulatorHosts?.[n],Th=n=>{const e=bh(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},ac=()=>ai()?.config;class Ih{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function ci(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function wh(n){return(await fetch(n,{credentials:"include"})).ok}function xh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[br(JSON.stringify(t)),br(JSON.stringify(a)),""].join(".")}const Rn={};function Ah(){const n={prod:[],emulator:[]};for(const e of Object.keys(Rn))Rn[e]?n.emulator.push(e):n.prod.push(e);return n}function Sh(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Wo=!1;function Rh(n,e){if(typeof window>"u"||typeof document>"u"||!ci(window.location.host)||Rn[n]===e||Rn[n]||Wo)return;Rn[n]=e;function t(T){return`__firebase__banner__${T}`}const r="__firebase__banner",o=Ah().prod.length>0;function a(){const T=document.getElementById(r);T&&T.remove()}function u(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function h(T,S){T.setAttribute("width","24"),T.setAttribute("id",S),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function d(){const T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{Wo=!0,a()},T}function g(T,S){T.setAttribute("id",S),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function v(){const T=Sh(r),S=t("text"),D=document.getElementById(S)||document.createElement("span"),P=t("learnmore"),V=document.getElementById(P)||document.createElement("a"),M=t("preprendIcon"),B=document.getElementById(M)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){const q=T.element;u(q),g(V,P);const W=d();h(B,M),q.append(B,D,V,W),document.body.appendChild(q)}o?(D.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}function Ch(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ph(){const n=ai()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Vh(){return!Ph()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Nh(){try{return typeof indexedDB=="object"}catch{return!1}}function Dh(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const kh="FirebaseError";class Jt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=kh,Object.setPrototypeOf(this,Jt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cc.prototype.create)}}class cc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Oh(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Jt(s,u,r)}}function Oh(n,e){return n.replace(jh,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const jh=/\{\$([^}]+)}/g;function Tr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(Qo(o)&&Qo(a)){if(!Tr(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Qo(n){return n!==null&&typeof n=="object"}function $e(n){return n&&n._delegate?n._delegate:n}class Dn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const It="[DEFAULT]";class Mh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Ih;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Fh(e))try{this.getOrInitializeService({instanceIdentifier:It})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=It){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=It){return this.instances.has(e)}getOptions(e=It){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Lh(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=It){return this.component?this.component.multipleInstances?e:It:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Lh(n){return n===It?void 0:n}function Fh(n){return n.instantiationMode==="EAGER"}class Uh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Mh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var K;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(K||(K={}));const Bh={debug:K.DEBUG,verbose:K.VERBOSE,info:K.INFO,warn:K.WARN,error:K.ERROR,silent:K.SILENT},zh=K.INFO,qh={[K.DEBUG]:"log",[K.VERBOSE]:"log",[K.INFO]:"info",[K.WARN]:"warn",[K.ERROR]:"error"},$h=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=qh[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class lc{constructor(e){this.name=e,this._logLevel=zh,this._logHandler=$h,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in K))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Bh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,K.DEBUG,...e),this._logHandler(this,K.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,K.VERBOSE,...e),this._logHandler(this,K.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,K.INFO,...e),this._logHandler(this,K.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,K.WARN,...e),this._logHandler(this,K.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,K.ERROR,...e),this._logHandler(this,K.ERROR,...e)}}const Gh=(n,e)=>e.some(t=>n instanceof t);let Jo,Yo;function Hh(){return Jo||(Jo=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kh(){return Yo||(Yo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const uc=new WeakMap,Fs=new WeakMap,hc=new WeakMap,Ss=new WeakMap,li=new WeakMap;function Wh(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(st(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&uc.set(t,n)}).catch(()=>{}),li.set(e,n),e}function Qh(n){if(Fs.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Fs.set(n,e)}let Us={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Fs.get(n);if(e==="objectStoreNames")return n.objectStoreNames||hc.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return st(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Jh(n){Us=n(Us)}function Yh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Rs(this),e,...t);return hc.set(r,e.sort?e.sort():[e]),st(r)}:Kh().includes(n)?function(...e){return n.apply(Rs(this),e),st(uc.get(this))}:function(...e){return st(n.apply(Rs(this),e))}}function Xh(n){return typeof n=="function"?Yh(n):(n instanceof IDBTransaction&&Qh(n),Gh(n,Hh())?new Proxy(n,Us):n)}function st(n){if(n instanceof IDBRequest)return Wh(n);if(Ss.has(n))return Ss.get(n);const e=Xh(n);return e!==n&&(Ss.set(n,e),li.set(e,n)),e}const Rs=n=>li.get(n);function Zh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),u=st(a);return r&&a.addEventListener("upgradeneeded",h=>{r(st(a.result),h.oldVersion,h.newVersion,st(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const ed=["get","getKey","getAll","getAllKeys","count"],td=["put","add","delete","clear"],Cs=new Map;function Xo(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Cs.get(e))return Cs.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=td.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ed.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),s&&h.done]))[0]};return Cs.set(e,o),o}Jh(n=>({...n,get:(e,t,r)=>Xo(e,t)||n.get(e,t,r),has:(e,t)=>!!Xo(e,t)||n.has(e,t)}));class nd{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(rd(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function rd(n){return n.getComponent()?.type==="VERSION"}const Bs="@firebase/app",Zo="0.14.8";const Ge=new lc("@firebase/app"),sd="@firebase/app-compat",id="@firebase/analytics-compat",od="@firebase/analytics",ad="@firebase/app-check-compat",cd="@firebase/app-check",ld="@firebase/auth",ud="@firebase/auth-compat",hd="@firebase/database",dd="@firebase/data-connect",fd="@firebase/database-compat",md="@firebase/functions",pd="@firebase/functions-compat",gd="@firebase/installations",_d="@firebase/installations-compat",yd="@firebase/messaging",Ed="@firebase/messaging-compat",vd="@firebase/performance",bd="@firebase/performance-compat",Td="@firebase/remote-config",Id="@firebase/remote-config-compat",wd="@firebase/storage",xd="@firebase/storage-compat",Ad="@firebase/firestore",Sd="@firebase/ai",Rd="@firebase/firestore-compat",Cd="firebase",Pd="12.9.0";const zs="[DEFAULT]",Vd={[Bs]:"fire-core",[sd]:"fire-core-compat",[od]:"fire-analytics",[id]:"fire-analytics-compat",[cd]:"fire-app-check",[ad]:"fire-app-check-compat",[ld]:"fire-auth",[ud]:"fire-auth-compat",[hd]:"fire-rtdb",[dd]:"fire-data-connect",[fd]:"fire-rtdb-compat",[md]:"fire-fn",[pd]:"fire-fn-compat",[gd]:"fire-iid",[_d]:"fire-iid-compat",[yd]:"fire-fcm",[Ed]:"fire-fcm-compat",[vd]:"fire-perf",[bd]:"fire-perf-compat",[Td]:"fire-rc",[Id]:"fire-rc-compat",[wd]:"fire-gcs",[xd]:"fire-gcs-compat",[Ad]:"fire-fst",[Rd]:"fire-fst-compat",[Sd]:"fire-vertex","fire-js":"fire-js",[Cd]:"fire-js-all"};const Ir=new Map,Nd=new Map,qs=new Map;function ea(n,e){try{n.container.addComponent(e)}catch(t){Ge.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function wr(n){const e=n.name;if(qs.has(e))return Ge.debug(`There were multiple attempts to register component ${e}.`),!1;qs.set(e,n);for(const t of Ir.values())ea(t,n);for(const t of Nd.values())ea(t,n);return!0}function Dd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function kd(n){return n==null?!1:n.settings!==void 0}const Od={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},it=new cc("app","Firebase",Od);class jd{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Dn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw it.create("app-deleted",{appName:this._name})}}const Md=Pd;function dc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:zs,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw it.create("bad-app-name",{appName:String(s)});if(t||(t=ac()),!t)throw it.create("no-options");const o=Ir.get(s);if(o){if(Tr(t,o.options)&&Tr(r,o.config))return o;throw it.create("duplicate-app",{appName:s})}const a=new Uh(s);for(const h of qs.values())a.addComponent(h);const u=new jd(t,r,a);return Ir.set(s,u),u}function Ld(n=zs){const e=Ir.get(n);if(!e&&n===zs&&ac())return dc();if(!e)throw it.create("no-app",{appName:n});return e}function Bt(n,e,t){let r=Vd[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ge.warn(a.join(" "));return}wr(new Dn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Fd="firebase-heartbeat-database",Ud=1,kn="firebase-heartbeat-store";let Ps=null;function fc(){return Ps||(Ps=Zh(Fd,Ud,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(kn)}catch(t){console.warn(t)}}}}).catch(n=>{throw it.create("idb-open",{originalErrorMessage:n.message})})),Ps}async function Bd(n){try{const t=(await fc()).transaction(kn),r=await t.objectStore(kn).get(mc(n));return await t.done,r}catch(e){if(e instanceof Jt)Ge.warn(e.message);else{const t=it.create("idb-get",{originalErrorMessage:e?.message});Ge.warn(t.message)}}}async function ta(n,e){try{const r=(await fc()).transaction(kn,"readwrite");await r.objectStore(kn).put(e,mc(n)),await r.done}catch(t){if(t instanceof Jt)Ge.warn(t.message);else{const r=it.create("idb-set",{originalErrorMessage:t?.message});Ge.warn(r.message)}}}function mc(n){return`${n.name}!${n.options.appId}`}const zd=1024,qd=30;class $d{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Hd(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=na();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>qd){const s=Kd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ge.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=na(),{heartbeatsToSend:t,unsentEntries:r}=Gd(this._heartbeatsCache.heartbeats),s=br(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Ge.warn(e),""}}}function na(){return new Date().toISOString().substring(0,10)}function Gd(n,e=zd){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),ra(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),ra(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Hd{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Nh()?Dh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Bd(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ta(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ta(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function ra(n){return br(JSON.stringify({version:2,heartbeats:n})).length}function Kd(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Wd(n){wr(new Dn("platform-logger",e=>new nd(e),"PRIVATE")),wr(new Dn("heartbeat",e=>new $d(e),"PRIVATE")),Bt(Bs,Zo,n),Bt(Bs,Zo,"esm2020"),Bt("fire-js","")}Wd("");var Qd="firebase",Jd="12.9.0";Bt(Qd,Jd,"app");var sa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ot,pc;(function(){var n;function e(I,_){function E(){}E.prototype=_.prototype,I.F=_.prototype,I.prototype=new E,I.prototype.constructor=I,I.D=function(w,b,y){for(var p=Array(arguments.length-2),me=2;me<arguments.length;me++)p[me-2]=arguments[me];return _.prototype[b].apply(w,p)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,_,E){E||(E=0);const w=Array(16);if(typeof _=="string")for(var b=0;b<16;++b)w[b]=_.charCodeAt(E++)|_.charCodeAt(E++)<<8|_.charCodeAt(E++)<<16|_.charCodeAt(E++)<<24;else for(b=0;b<16;++b)w[b]=_[E++]|_[E++]<<8|_[E++]<<16|_[E++]<<24;_=I.g[0],E=I.g[1],b=I.g[2];let y=I.g[3],p;p=_+(y^E&(b^y))+w[0]+3614090360&4294967295,_=E+(p<<7&4294967295|p>>>25),p=y+(b^_&(E^b))+w[1]+3905402710&4294967295,y=_+(p<<12&4294967295|p>>>20),p=b+(E^y&(_^E))+w[2]+606105819&4294967295,b=y+(p<<17&4294967295|p>>>15),p=E+(_^b&(y^_))+w[3]+3250441966&4294967295,E=b+(p<<22&4294967295|p>>>10),p=_+(y^E&(b^y))+w[4]+4118548399&4294967295,_=E+(p<<7&4294967295|p>>>25),p=y+(b^_&(E^b))+w[5]+1200080426&4294967295,y=_+(p<<12&4294967295|p>>>20),p=b+(E^y&(_^E))+w[6]+2821735955&4294967295,b=y+(p<<17&4294967295|p>>>15),p=E+(_^b&(y^_))+w[7]+4249261313&4294967295,E=b+(p<<22&4294967295|p>>>10),p=_+(y^E&(b^y))+w[8]+1770035416&4294967295,_=E+(p<<7&4294967295|p>>>25),p=y+(b^_&(E^b))+w[9]+2336552879&4294967295,y=_+(p<<12&4294967295|p>>>20),p=b+(E^y&(_^E))+w[10]+4294925233&4294967295,b=y+(p<<17&4294967295|p>>>15),p=E+(_^b&(y^_))+w[11]+2304563134&4294967295,E=b+(p<<22&4294967295|p>>>10),p=_+(y^E&(b^y))+w[12]+1804603682&4294967295,_=E+(p<<7&4294967295|p>>>25),p=y+(b^_&(E^b))+w[13]+4254626195&4294967295,y=_+(p<<12&4294967295|p>>>20),p=b+(E^y&(_^E))+w[14]+2792965006&4294967295,b=y+(p<<17&4294967295|p>>>15),p=E+(_^b&(y^_))+w[15]+1236535329&4294967295,E=b+(p<<22&4294967295|p>>>10),p=_+(b^y&(E^b))+w[1]+4129170786&4294967295,_=E+(p<<5&4294967295|p>>>27),p=y+(E^b&(_^E))+w[6]+3225465664&4294967295,y=_+(p<<9&4294967295|p>>>23),p=b+(_^E&(y^_))+w[11]+643717713&4294967295,b=y+(p<<14&4294967295|p>>>18),p=E+(y^_&(b^y))+w[0]+3921069994&4294967295,E=b+(p<<20&4294967295|p>>>12),p=_+(b^y&(E^b))+w[5]+3593408605&4294967295,_=E+(p<<5&4294967295|p>>>27),p=y+(E^b&(_^E))+w[10]+38016083&4294967295,y=_+(p<<9&4294967295|p>>>23),p=b+(_^E&(y^_))+w[15]+3634488961&4294967295,b=y+(p<<14&4294967295|p>>>18),p=E+(y^_&(b^y))+w[4]+3889429448&4294967295,E=b+(p<<20&4294967295|p>>>12),p=_+(b^y&(E^b))+w[9]+568446438&4294967295,_=E+(p<<5&4294967295|p>>>27),p=y+(E^b&(_^E))+w[14]+3275163606&4294967295,y=_+(p<<9&4294967295|p>>>23),p=b+(_^E&(y^_))+w[3]+4107603335&4294967295,b=y+(p<<14&4294967295|p>>>18),p=E+(y^_&(b^y))+w[8]+1163531501&4294967295,E=b+(p<<20&4294967295|p>>>12),p=_+(b^y&(E^b))+w[13]+2850285829&4294967295,_=E+(p<<5&4294967295|p>>>27),p=y+(E^b&(_^E))+w[2]+4243563512&4294967295,y=_+(p<<9&4294967295|p>>>23),p=b+(_^E&(y^_))+w[7]+1735328473&4294967295,b=y+(p<<14&4294967295|p>>>18),p=E+(y^_&(b^y))+w[12]+2368359562&4294967295,E=b+(p<<20&4294967295|p>>>12),p=_+(E^b^y)+w[5]+4294588738&4294967295,_=E+(p<<4&4294967295|p>>>28),p=y+(_^E^b)+w[8]+2272392833&4294967295,y=_+(p<<11&4294967295|p>>>21),p=b+(y^_^E)+w[11]+1839030562&4294967295,b=y+(p<<16&4294967295|p>>>16),p=E+(b^y^_)+w[14]+4259657740&4294967295,E=b+(p<<23&4294967295|p>>>9),p=_+(E^b^y)+w[1]+2763975236&4294967295,_=E+(p<<4&4294967295|p>>>28),p=y+(_^E^b)+w[4]+1272893353&4294967295,y=_+(p<<11&4294967295|p>>>21),p=b+(y^_^E)+w[7]+4139469664&4294967295,b=y+(p<<16&4294967295|p>>>16),p=E+(b^y^_)+w[10]+3200236656&4294967295,E=b+(p<<23&4294967295|p>>>9),p=_+(E^b^y)+w[13]+681279174&4294967295,_=E+(p<<4&4294967295|p>>>28),p=y+(_^E^b)+w[0]+3936430074&4294967295,y=_+(p<<11&4294967295|p>>>21),p=b+(y^_^E)+w[3]+3572445317&4294967295,b=y+(p<<16&4294967295|p>>>16),p=E+(b^y^_)+w[6]+76029189&4294967295,E=b+(p<<23&4294967295|p>>>9),p=_+(E^b^y)+w[9]+3654602809&4294967295,_=E+(p<<4&4294967295|p>>>28),p=y+(_^E^b)+w[12]+3873151461&4294967295,y=_+(p<<11&4294967295|p>>>21),p=b+(y^_^E)+w[15]+530742520&4294967295,b=y+(p<<16&4294967295|p>>>16),p=E+(b^y^_)+w[2]+3299628645&4294967295,E=b+(p<<23&4294967295|p>>>9),p=_+(b^(E|~y))+w[0]+4096336452&4294967295,_=E+(p<<6&4294967295|p>>>26),p=y+(E^(_|~b))+w[7]+1126891415&4294967295,y=_+(p<<10&4294967295|p>>>22),p=b+(_^(y|~E))+w[14]+2878612391&4294967295,b=y+(p<<15&4294967295|p>>>17),p=E+(y^(b|~_))+w[5]+4237533241&4294967295,E=b+(p<<21&4294967295|p>>>11),p=_+(b^(E|~y))+w[12]+1700485571&4294967295,_=E+(p<<6&4294967295|p>>>26),p=y+(E^(_|~b))+w[3]+2399980690&4294967295,y=_+(p<<10&4294967295|p>>>22),p=b+(_^(y|~E))+w[10]+4293915773&4294967295,b=y+(p<<15&4294967295|p>>>17),p=E+(y^(b|~_))+w[1]+2240044497&4294967295,E=b+(p<<21&4294967295|p>>>11),p=_+(b^(E|~y))+w[8]+1873313359&4294967295,_=E+(p<<6&4294967295|p>>>26),p=y+(E^(_|~b))+w[15]+4264355552&4294967295,y=_+(p<<10&4294967295|p>>>22),p=b+(_^(y|~E))+w[6]+2734768916&4294967295,b=y+(p<<15&4294967295|p>>>17),p=E+(y^(b|~_))+w[13]+1309151649&4294967295,E=b+(p<<21&4294967295|p>>>11),p=_+(b^(E|~y))+w[4]+4149444226&4294967295,_=E+(p<<6&4294967295|p>>>26),p=y+(E^(_|~b))+w[11]+3174756917&4294967295,y=_+(p<<10&4294967295|p>>>22),p=b+(_^(y|~E))+w[2]+718787259&4294967295,b=y+(p<<15&4294967295|p>>>17),p=E+(y^(b|~_))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+_&4294967295,I.g[1]=I.g[1]+(b+(p<<21&4294967295|p>>>11))&4294967295,I.g[2]=I.g[2]+b&4294967295,I.g[3]=I.g[3]+y&4294967295}r.prototype.v=function(I,_){_===void 0&&(_=I.length);const E=_-this.blockSize,w=this.C;let b=this.h,y=0;for(;y<_;){if(b==0)for(;y<=E;)s(this,I,y),y+=this.blockSize;if(typeof I=="string"){for(;y<_;)if(w[b++]=I.charCodeAt(y++),b==this.blockSize){s(this,w),b=0;break}}else for(;y<_;)if(w[b++]=I[y++],b==this.blockSize){s(this,w),b=0;break}}this.h=b,this.o+=_},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var _=1;_<I.length-8;++_)I[_]=0;_=this.o*8;for(var E=I.length-8;E<I.length;++E)I[E]=_&255,_/=256;for(this.v(I),I=Array(16),_=0,E=0;E<4;++E)for(let w=0;w<32;w+=8)I[_++]=this.g[E]>>>w&255;return I};function o(I,_){var E=u;return Object.prototype.hasOwnProperty.call(E,I)?E[I]:E[I]=_(I)}function a(I,_){this.h=_;const E=[];let w=!0;for(let b=I.length-1;b>=0;b--){const y=I[b]|0;w&&y==_||(E[b]=y,w=!1)}this.g=E}var u={};function h(I){return-128<=I&&I<128?o(I,function(_){return new a([_|0],_<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return v;if(I<0)return V(d(-I));const _=[];let E=1;for(let w=0;I>=E;w++)_[w]=I/E|0,E*=4294967296;return new a(_,0)}function g(I,_){if(I.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return V(g(I.substring(1),_));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const E=d(Math.pow(_,8));let w=v;for(let y=0;y<I.length;y+=8){var b=Math.min(8,I.length-y);const p=parseInt(I.substring(y,y+b),_);b<8?(b=d(Math.pow(_,b)),w=w.j(b).add(d(p))):(w=w.j(E),w=w.add(d(p)))}return w}var v=h(0),T=h(1),S=h(16777216);n=a.prototype,n.m=function(){if(P(this))return-V(this).m();let I=0,_=1;for(let E=0;E<this.g.length;E++){const w=this.i(E);I+=(w>=0?w:4294967296+w)*_,_*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(D(this))return"0";if(P(this))return"-"+V(this).toString(I);const _=d(Math.pow(I,6));var E=this;let w="";for(;;){const b=W(E,_).g;E=M(E,b.j(_));let y=((E.g.length>0?E.g[0]:E.h)>>>0).toString(I);if(E=b,D(E))return y+w;for(;y.length<6;)y="0"+y;w=y+w}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function D(I){if(I.h!=0)return!1;for(let _=0;_<I.g.length;_++)if(I.g[_]!=0)return!1;return!0}function P(I){return I.h==-1}n.l=function(I){return I=M(this,I),P(I)?-1:D(I)?0:1};function V(I){const _=I.g.length,E=[];for(let w=0;w<_;w++)E[w]=~I.g[w];return new a(E,~I.h).add(T)}n.abs=function(){return P(this)?V(this):this},n.add=function(I){const _=Math.max(this.g.length,I.g.length),E=[];let w=0;for(let b=0;b<=_;b++){let y=w+(this.i(b)&65535)+(I.i(b)&65535),p=(y>>>16)+(this.i(b)>>>16)+(I.i(b)>>>16);w=p>>>16,y&=65535,p&=65535,E[b]=p<<16|y}return new a(E,E[E.length-1]&-2147483648?-1:0)};function M(I,_){return I.add(V(_))}n.j=function(I){if(D(this)||D(I))return v;if(P(this))return P(I)?V(this).j(V(I)):V(V(this).j(I));if(P(I))return V(this.j(V(I)));if(this.l(S)<0&&I.l(S)<0)return d(this.m()*I.m());const _=this.g.length+I.g.length,E=[];for(var w=0;w<2*_;w++)E[w]=0;for(w=0;w<this.g.length;w++)for(let b=0;b<I.g.length;b++){const y=this.i(w)>>>16,p=this.i(w)&65535,me=I.i(b)>>>16,gt=I.i(b)&65535;E[2*w+2*b]+=p*gt,B(E,2*w+2*b),E[2*w+2*b+1]+=y*gt,B(E,2*w+2*b+1),E[2*w+2*b+1]+=p*me,B(E,2*w+2*b+1),E[2*w+2*b+2]+=y*me,B(E,2*w+2*b+2)}for(I=0;I<_;I++)E[I]=E[2*I+1]<<16|E[2*I];for(I=_;I<2*_;I++)E[I]=0;return new a(E,0)};function B(I,_){for(;(I[_]&65535)!=I[_];)I[_+1]+=I[_]>>>16,I[_]&=65535,_++}function q(I,_){this.g=I,this.h=_}function W(I,_){if(D(_))throw Error("division by zero");if(D(I))return new q(v,v);if(P(I))return _=W(V(I),_),new q(V(_.g),V(_.h));if(P(_))return _=W(I,V(_)),new q(V(_.g),_.h);if(I.g.length>30){if(P(I)||P(_))throw Error("slowDivide_ only works with positive integers.");for(var E=T,w=_;w.l(I)<=0;)E=J(E),w=J(w);var b=se(E,1),y=se(w,1);for(w=se(w,2),E=se(E,2);!D(w);){var p=y.add(w);p.l(I)<=0&&(b=b.add(E),y=p),w=se(w,1),E=se(E,1)}return _=M(I,b.j(_)),new q(b,_)}for(b=v;I.l(_)>=0;){for(E=Math.max(1,Math.floor(I.m()/_.m())),w=Math.ceil(Math.log(E)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),y=d(E),p=y.j(_);P(p)||p.l(I)>0;)E-=w,y=d(E),p=y.j(_);D(y)&&(y=T),b=b.add(y),I=M(I,p)}return new q(b,I)}n.B=function(I){return W(this,I).h},n.and=function(I){const _=Math.max(this.g.length,I.g.length),E=[];for(let w=0;w<_;w++)E[w]=this.i(w)&I.i(w);return new a(E,this.h&I.h)},n.or=function(I){const _=Math.max(this.g.length,I.g.length),E=[];for(let w=0;w<_;w++)E[w]=this.i(w)|I.i(w);return new a(E,this.h|I.h)},n.xor=function(I){const _=Math.max(this.g.length,I.g.length),E=[];for(let w=0;w<_;w++)E[w]=this.i(w)^I.i(w);return new a(E,this.h^I.h)};function J(I){const _=I.g.length+1,E=[];for(let w=0;w<_;w++)E[w]=I.i(w)<<1|I.i(w-1)>>>31;return new a(E,I.h)}function se(I,_){const E=_>>5;_%=32;const w=I.g.length-E,b=[];for(let y=0;y<w;y++)b[y]=_>0?I.i(y+E)>>>_|I.i(y+E+1)<<32-_:I.i(y+E);return new a(b,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,pc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=g,ot=a}).apply(typeof sa<"u"?sa:typeof self<"u"?self:typeof window<"u"?window:{});var lr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var gc,In,_c,pr,$s,yc,Ec,vc;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof lr=="object"&&lr];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var x=i[f];if(!(x in l))break e;l=l[x]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&e(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function g(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function v(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,x,A){for(var N=Array(arguments.length-2),z=2;z<arguments.length;z++)N[z-2]=arguments[z];return c.prototype[x].apply(f,N)}}var T=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function S(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function D(i,c){for(let f=1;f<arguments.length;f++){const x=arguments[f];var l=typeof x;if(l=l!="object"?l:x?Array.isArray(x)?"array":l:"null",l=="array"||l=="object"&&typeof x.length=="number"){l=i.length||0;const A=x.length||0;i.length=l+A;for(let N=0;N<A;N++)i[l+N]=x[N]}else i.push(x)}}class P{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function V(i){a.setTimeout(()=>{throw i},0)}function M(){var i=I;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class B{constructor(){this.h=this.g=null}add(c,l){const f=q.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var q=new P(()=>new W,i=>i.reset());class W{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let J,se=!1,I=new B,_=()=>{const i=Promise.resolve(void 0);J=()=>{i.then(E)}};function E(){for(var i;i=M();){try{i.h.call(i.g)}catch(l){V(l)}var c=q;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}se=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function b(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}b.prototype.h=function(){this.defaultPrevented=!0};var y=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function p(i){return/^[\s\xa0]*$/.test(i)}function me(i,c){b.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}v(me,b),me.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&me.Z.h.call(this)},me.prototype.h=function(){me.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var gt="closure_listenable_"+(Math.random()*1e6|0),tu=0;function nu(i,c,l,f,x){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=x,this.key=++tu,this.da=this.fa=!1}function Wn(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Qn(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function ru(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function Bi(i){const c={};for(const l in i)c[l]=i[l];return c}const zi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function qi(i,c){let l,f;for(let x=1;x<arguments.length;x++){f=arguments[x];for(l in f)i[l]=f[l];for(let A=0;A<zi.length;A++)l=zi[A],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function Jn(i){this.src=i,this.g={},this.h=0}Jn.prototype.add=function(i,c,l,f,x){const A=i.toString();i=this.g[A],i||(i=this.g[A]=[],this.h++);const N=ns(i,c,f,x);return N>-1?(c=i[N],l||(c.fa=!1)):(c=new nu(c,this.src,A,!!f,x),c.fa=l,i.push(c)),c};function ts(i,c){const l=c.type;if(l in i.g){var f=i.g[l],x=Array.prototype.indexOf.call(f,c,void 0),A;(A=x>=0)&&Array.prototype.splice.call(f,x,1),A&&(Wn(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function ns(i,c,l,f){for(let x=0;x<i.length;++x){const A=i[x];if(!A.da&&A.listener==c&&A.capture==!!l&&A.ha==f)return x}return-1}var rs="closure_lm_"+(Math.random()*1e6|0),ss={};function $i(i,c,l,f,x){if(Array.isArray(c)){for(let A=0;A<c.length;A++)$i(i,c[A],l,f,x);return null}return l=Ki(l),i&&i[gt]?i.J(c,l,u(f)?!!f.capture:!1,x):su(i,c,l,!1,f,x)}function su(i,c,l,f,x,A){if(!c)throw Error("Invalid event type");const N=u(x)?!!x.capture:!!x;let z=os(i);if(z||(i[rs]=z=new Jn(i)),l=z.add(c,l,f,N,A),l.proxy)return l;if(f=iu(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)y||(x=N),x===void 0&&(x=!1),i.addEventListener(c.toString(),f,x);else if(i.attachEvent)i.attachEvent(Hi(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function iu(){function i(l){return c.call(i.src,i.listener,l)}const c=ou;return i}function Gi(i,c,l,f,x){if(Array.isArray(c))for(var A=0;A<c.length;A++)Gi(i,c[A],l,f,x);else f=u(f)?!!f.capture:!!f,l=Ki(l),i&&i[gt]?(i=i.i,A=String(c).toString(),A in i.g&&(c=i.g[A],l=ns(c,l,f,x),l>-1&&(Wn(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[A],i.h--)))):i&&(i=os(i))&&(c=i.g[c.toString()],i=-1,c&&(i=ns(c,l,f,x)),(l=i>-1?c[i]:null)&&is(l))}function is(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[gt])ts(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(Hi(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=os(c))?(ts(l,i),l.h==0&&(l.src=null,c[rs]=null)):Wn(i)}}}function Hi(i){return i in ss?ss[i]:ss[i]="on"+i}function ou(i,c){if(i.da)i=!0;else{c=new me(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&is(i),i=l.call(f,c)}return i}function os(i){return i=i[rs],i instanceof Jn?i:null}var as="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ki(i){return typeof i=="function"?i:(i[as]||(i[as]=function(c){return i.handleEvent(c)}),i[as])}function ye(){w.call(this),this.i=new Jn(this),this.M=this,this.G=null}v(ye,w),ye.prototype[gt]=!0,ye.prototype.removeEventListener=function(i,c,l,f){Gi(this,i,c,l,f)};function Te(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new b(c,i);else if(c instanceof b)c.target=c.target||i;else{var x=c;c=new b(f,i),qi(c,x)}x=!0;let A,N;if(l)for(N=l.length-1;N>=0;N--)A=c.g=l[N],x=Yn(A,f,!0,c)&&x;if(A=c.g=i,x=Yn(A,f,!0,c)&&x,x=Yn(A,f,!1,c)&&x,l)for(N=0;N<l.length;N++)A=c.g=l[N],x=Yn(A,f,!1,c)&&x}ye.prototype.N=function(){if(ye.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)Wn(l[f]);delete i.g[c],i.h--}}this.G=null},ye.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},ye.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function Yn(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let x=!0;for(let A=0;A<c.length;++A){const N=c[A];if(N&&!N.da&&N.capture==l){const z=N.listener,ae=N.ha||N.src;N.fa&&ts(i.i,N),x=z.call(ae,f)!==!1&&x}}return x&&!f.defaultPrevented}function au(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Wi(i){i.g=au(()=>{i.g=null,i.i&&(i.i=!1,Wi(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class cu extends w{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Wi(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nn(i){w.call(this),this.h=i,this.g={}}v(nn,w);var Qi=[];function Ji(i){Qn(i.g,function(c,l){this.g.hasOwnProperty(l)&&is(c)},i),i.g={}}nn.prototype.N=function(){nn.Z.N.call(this),Ji(this)},nn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cs=a.JSON.stringify,lu=a.JSON.parse,uu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Yi(){}function Xi(){}var rn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ls(){b.call(this,"d")}v(ls,b);function us(){b.call(this,"c")}v(us,b);var _t={},Zi=null;function Xn(){return Zi=Zi||new ye}_t.Ia="serverreachability";function eo(i){b.call(this,_t.Ia,i)}v(eo,b);function sn(i){const c=Xn();Te(c,new eo(c))}_t.STAT_EVENT="statevent";function to(i,c){b.call(this,_t.STAT_EVENT,i),this.stat=c}v(to,b);function Ie(i){const c=Xn();Te(c,new to(c,i))}_t.Ja="timingevent";function no(i,c){b.call(this,_t.Ja,i),this.size=c}v(no,b);function on(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function an(){this.g=!0}an.prototype.ua=function(){this.g=!1};function hu(i,c,l,f,x,A){i.info(function(){if(i.g)if(A){var N="",z=A.split("&");for(let Y=0;Y<z.length;Y++){var ae=z[Y].split("=");if(ae.length>1){const he=ae[0];ae=ae[1];const ke=he.split("_");N=ke.length>=2&&ke[1]=="type"?N+(he+"="+ae+"&"):N+(he+"=redacted&")}}}else N=null;else N=A;return"XMLHTTP REQ ("+f+") [attempt "+x+"]: "+c+`
`+l+`
`+N})}function du(i,c,l,f,x,A,N){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+x+"]: "+c+`
`+l+`
`+A+" "+N})}function Vt(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+mu(i,l)+(f?" "+f:"")})}function fu(i,c){i.info(function(){return"TIMEOUT: "+c})}an.prototype.info=function(){};function mu(i,c){if(!i.g)return c;if(!c)return null;try{const A=JSON.parse(c);if(A){for(i=0;i<A.length;i++)if(Array.isArray(A[i])){var l=A[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var x=f[0];if(x!="noop"&&x!="stop"&&x!="close")for(let N=1;N<f.length;N++)f[N]=""}}}}return cs(A)}catch{return c}}var Zn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ro={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},so;function hs(){}v(hs,Yi),hs.prototype.g=function(){return new XMLHttpRequest},so=new hs;function cn(i){return encodeURIComponent(String(i))}function pu(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Je(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new nn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new io}function io(){this.i=null,this.g="",this.h=!1}var oo={},ds={};function fs(i,c,l){i.M=1,i.A=tr(De(c)),i.u=l,i.R=!0,ao(i,null)}function ao(i,c){i.F=Date.now(),er(i),i.B=De(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),bo(l.i,"t",f),i.C=0,l=i.j.L,i.h=new io,i.g=Fo(i.j,l?c:null,!i.u),i.P>0&&(i.O=new cu(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var x="readystatechange";Array.isArray(x)||(x&&(Qi[0]=x.toString()),x=Qi);for(let A=0;A<x.length;A++){const N=$i(l,x[A],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=i.J?Bi(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),sn(),hu(i.i,i.v,i.B,i.l,i.S,i.u)}Je.prototype.ba=function(i){i=i.target;const c=this.O;c&&Ze(i)==3?c.j():this.Y(i)},Je.prototype.Y=function(i){try{if(i==this.g)e:{const z=Ze(this.g),ae=this.g.ya(),Y=this.g.ca();if(!(z<3)&&(z!=3||this.g&&(this.h.h||this.g.la()||Ro(this.g)))){this.K||z!=4||ae==7||(ae==8||Y<=0?sn(3):sn(2)),ms(this);var c=this.g.ca();this.X=c;var l=gu(this);if(this.o=c==200,du(this.i,this.v,this.B,this.l,this.S,z,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,x=this.g;if((f=x.g?x.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(f)){var A=f;break t}}A=null}if(i=A)Vt(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ps(this,i);else{this.o=!1,this.m=3,Ie(12),yt(this),ln(this);break e}}if(this.R){i=!0;let he;for(;!this.K&&this.C<l.length;)if(he=_u(this,l),he==ds){z==4&&(this.m=4,Ie(14),i=!1),Vt(this.i,this.l,null,"[Incomplete Response]");break}else if(he==oo){this.m=4,Ie(15),Vt(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else Vt(this.i,this.l,he,null),ps(this,he);if(co(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),z!=4||l.length!=0||this.h.h||(this.m=1,Ie(16),i=!1),this.o=this.o&&i,!i)Vt(this.i,this.l,l,"[Invalid Chunked Response]"),yt(this),ln(this);else if(l.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),Is(N),N.P=!0,Ie(11))}}else Vt(this.i,this.l,l,null),ps(this,l);z==4&&yt(this),this.o&&!this.K&&(z==4?Oo(this.j,this):(this.o=!1,er(this)))}else Vu(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,Ie(12)):(this.m=0,Ie(13)),yt(this),ln(this)}}}catch{}};function gu(i){if(!co(i))return i.g.la();const c=Ro(i.g);if(c==="")return"";let l="";const f=c.length,x=Ze(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return yt(i),ln(i),"";i.h.i=new a.TextDecoder}for(let A=0;A<f;A++)i.h.h=!0,l+=i.h.i.decode(c[A],{stream:!(x&&A==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function co(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function _u(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?ds:(l=Number(c.substring(l,f)),isNaN(l)?oo:(f+=1,f+l>c.length?ds:(c=c.slice(f,f+l),i.C=f+l,c)))}Je.prototype.cancel=function(){this.K=!0,yt(this)};function er(i){i.T=Date.now()+i.H,lo(i,i.H)}function lo(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=on(d(i.aa,i),c)}function ms(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Je.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(fu(this.i,this.B),this.M!=2&&(sn(),Ie(17)),yt(this),this.m=2,ln(this)):lo(this,this.T-i)};function ln(i){i.j.I==0||i.K||Oo(i.j,i)}function yt(i){ms(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Ji(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function ps(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||gs(l.h,i))){if(!i.L&&gs(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var x=f;if(x[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)or(l),sr(l);else break e;Ts(l),Ie(18)}}else l.xa=x[1],0<l.xa-l.K&&x[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=on(d(l.Va,l),6e3));fo(l.h)<=1&&l.ta&&(l.ta=void 0)}else vt(l,11)}else if((i.L||l.g==i)&&or(l),!p(c))for(x=l.Ba.g.parse(c),c=0;c<x.length;c++){let Y=x[c];const he=Y[0];if(!(he<=l.K))if(l.K=he,Y=Y[1],l.I==2)if(Y[0]=="c"){l.M=Y[1],l.ba=Y[2];const ke=Y[3];ke!=null&&(l.ka=ke,l.j.info("VER="+l.ka));const bt=Y[4];bt!=null&&(l.za=bt,l.j.info("SVER="+l.za));const et=Y[5];et!=null&&typeof et=="number"&&et>0&&(f=1.5*et,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const tt=i.g;if(tt){const cr=tt.g?tt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(cr){var A=f.h;A.g||cr.indexOf("spdy")==-1&&cr.indexOf("quic")==-1&&cr.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(_s(A,A.h),A.h=null))}if(f.G){const ws=tt.g?tt.g.getResponseHeader("X-HTTP-Session-Id"):null;ws&&(f.wa=ws,X(f.J,f.G,ws))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var N=i;if(f.na=Lo(f,f.L?f.ba:null,f.W),N.L){mo(f.h,N);var z=N,ae=f.O;ae&&(z.H=ae),z.D&&(ms(z),er(z)),f.g=N}else Do(f);l.i.length>0&&ir(l)}else Y[0]!="stop"&&Y[0]!="close"||vt(l,7);else l.I==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?vt(l,7):bs(l):Y[0]!="noop"&&l.l&&l.l.qa(Y),l.A=0)}}sn(4)}catch{}}var yu=class{constructor(i,c){this.g=i,this.map=c}};function uo(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ho(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function fo(i){return i.h?1:i.g?i.g.size:0}function gs(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function _s(i,c){i.g?i.g.add(c):i.h=c}function mo(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}uo.prototype.cancel=function(){if(this.i=po(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function po(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return S(i.i)}var go=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Eu(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let x,A=null;f>=0?(x=i[l].substring(0,f),A=i[l].substring(f+1)):x=i[l],c(x,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Ye(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Ye?(this.l=i.l,un(this,i.j),this.o=i.o,this.g=i.g,hn(this,i.u),this.h=i.h,ys(this,To(i.i)),this.m=i.m):i&&(c=String(i).match(go))?(this.l=!1,un(this,c[1]||"",!0),this.o=dn(c[2]||""),this.g=dn(c[3]||"",!0),hn(this,c[4]),this.h=dn(c[5]||"",!0),ys(this,c[6]||"",!0),this.m=dn(c[7]||"")):(this.l=!1,this.i=new mn(null,this.l))}Ye.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(fn(c,_o,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(fn(c,_o,!0),"@"),i.push(cn(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(fn(l,l.charAt(0)=="/"?Tu:bu,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",fn(l,wu)),i.join("")},Ye.prototype.resolve=function(i){const c=De(this);let l=!!i.j;l?un(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)hn(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var x=c.h.lastIndexOf("/");x!=-1&&(f=c.h.slice(0,x+1)+f)}if(x=f,x==".."||x==".")f="";else if(x.indexOf("./")!=-1||x.indexOf("/.")!=-1){f=x.lastIndexOf("/",0)==0,x=x.split("/");const A=[];for(let N=0;N<x.length;){const z=x[N++];z=="."?f&&N==x.length&&A.push(""):z==".."?((A.length>1||A.length==1&&A[0]!="")&&A.pop(),f&&N==x.length&&A.push("")):(A.push(z),f=!0)}f=A.join("/")}else f=x}return l?c.h=f:l=i.i.toString()!=="",l?ys(c,To(i.i)):l=!!i.m,l&&(c.m=i.m),c};function De(i){return new Ye(i)}function un(i,c,l){i.j=l?dn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function hn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function ys(i,c,l){c instanceof mn?(i.i=c,xu(i.i,i.l)):(l||(c=fn(c,Iu)),i.i=new mn(c,i.l))}function X(i,c,l){i.i.set(c,l)}function tr(i){return X(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function dn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function fn(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,vu),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function vu(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var _o=/[#\/\?@]/g,bu=/[#\?:]/g,Tu=/[#\?]/g,Iu=/[#\?@]/g,wu=/#/g;function mn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Et(i){i.g||(i.g=new Map,i.h=0,i.i&&Eu(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=mn.prototype,n.add=function(i,c){Et(this),this.i=null,i=Nt(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function yo(i,c){Et(i),c=Nt(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Eo(i,c){return Et(i),c=Nt(i,c),i.g.has(c)}n.forEach=function(i,c){Et(this),this.g.forEach(function(l,f){l.forEach(function(x){i.call(c,x,f,this)},this)},this)};function vo(i,c){Et(i);let l=[];if(typeof c=="string")Eo(i,c)&&(l=l.concat(i.g.get(Nt(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return Et(this),this.i=null,i=Nt(this,i),Eo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=vo(this,i),i.length>0?String(i[0]):c):c};function bo(i,c,l){yo(i,c),l.length>0&&(i.i=null,i.g.set(Nt(i,c),S(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const x=cn(l);l=vo(this,l);for(let A=0;A<l.length;A++){let N=x;l[A]!==""&&(N+="="+cn(l[A])),i.push(N)}}return this.i=i.join("&")};function To(i){const c=new mn;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Nt(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function xu(i,c){c&&!i.j&&(Et(i),i.i=null,i.g.forEach(function(l,f){const x=f.toLowerCase();f!=x&&(yo(this,f),bo(this,x,l))},i)),i.j=c}function Au(i,c){const l=new an;if(a.Image){const f=new Image;f.onload=g(Xe,l,"TestLoadImage: loaded",!0,c,f),f.onerror=g(Xe,l,"TestLoadImage: error",!1,c,f),f.onabort=g(Xe,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=g(Xe,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function Su(i,c){const l=new an,f=new AbortController,x=setTimeout(()=>{f.abort(),Xe(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(A=>{clearTimeout(x),A.ok?Xe(l,"TestPingServer: ok",!0,c):Xe(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(x),Xe(l,"TestPingServer: error",!1,c)})}function Xe(i,c,l,f,x){try{x&&(x.onload=null,x.onerror=null,x.onabort=null,x.ontimeout=null),f(l)}catch{}}function Ru(){this.g=new uu}function Es(i){this.i=i.Sb||null,this.h=i.ab||!1}v(Es,Yi),Es.prototype.g=function(){return new nr(this.i,this.h)};function nr(i,c){ye.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}v(nr,ye),n=nr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,gn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,pn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,gn(this)),this.g&&(this.readyState=3,gn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Io(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Io(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?pn(this):gn(this),this.readyState==3&&Io(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,pn(this))},n.Na=function(i){this.g&&(this.response=i,pn(this))},n.ga=function(){this.g&&pn(this)};function pn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,gn(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function gn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(nr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function wo(i){let c="";return Qn(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function vs(i,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=wo(l),typeof i=="string"?l!=null&&cn(l):X(i,c,l))}function ne(i){ye.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}v(ne,ye);var Cu=/^https?$/i,Pu=["POST","PUT"];n=ne.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():so.g(),this.g.onreadystatechange=T(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(A){xo(this,A);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var x in f)l.set(x,f[x]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const A of f.keys())l.set(A,f.get(A));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(A=>A.toLowerCase()=="content-type"),x=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Pu,c,void 0)>=0)||f||x||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[A,N]of l)this.g.setRequestHeader(A,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(A){xo(this,A)}};function xo(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,Ao(i),rr(i)}function Ao(i){i.A||(i.A=!0,Te(i,"complete"),Te(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Te(this,"complete"),Te(this,"abort"),rr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),rr(this,!0)),ne.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?So(this):this.Xa())},n.Xa=function(){So(this)};function So(i){if(i.h&&typeof o<"u"){if(i.v&&Ze(i)==4)setTimeout(i.Ca.bind(i),0);else if(Te(i,"readystatechange"),Ze(i)==4){i.h=!1;try{const A=i.ca();e:switch(A){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=A===0){let N=String(i.D).match(go)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),f=!Cu.test(N?N.toLowerCase():"")}l=f}if(l)Te(i,"complete"),Te(i,"success");else{i.o=6;try{var x=Ze(i)>2?i.g.statusText:""}catch{x=""}i.l=x+" ["+i.ca()+"]",Ao(i)}}finally{rr(i)}}}}function rr(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||Te(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ze(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Ze(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),lu(c)}};function Ro(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Vu(i){const c={};i=(i.g&&Ze(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(p(i[f]))continue;var l=pu(i[f]);const x=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const A=c[x]||[];c[x]=A,A.push(l)}ru(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function _n(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function Co(i){this.za=0,this.i=[],this.j=new an,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=_n("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=_n("baseRetryDelayMs",5e3,i),this.Za=_n("retryDelaySeedMs",1e4,i),this.Ta=_n("forwardChannelMaxRetries",2,i),this.va=_n("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new uo(i&&i.concurrentRequestLimit),this.Ba=new Ru,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Co.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){Ie(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=Lo(this,null,this.W),ir(this)};function bs(i){if(Po(i),i.I==3){var c=i.V++,l=De(i.J);if(X(l,"SID",i.M),X(l,"RID",c),X(l,"TYPE","terminate"),yn(i,l),c=new Je(i,i.j,c),c.M=2,c.A=tr(De(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=Fo(c.j,null),c.g.ea(c.A)),c.F=Date.now(),er(c)}Mo(i)}function sr(i){i.g&&(Is(i),i.g.cancel(),i.g=null)}function Po(i){sr(i),i.v&&(a.clearTimeout(i.v),i.v=null),or(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function ir(i){if(!ho(i.h)&&!i.m){i.m=!0;var c=i.Ea;J||_(),se||(J(),se=!0),I.add(c,i),i.D=0}}function Nu(i,c){return fo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=on(d(i.Ea,i,c),jo(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const x=new Je(this,this.j,i);let A=this.o;if(this.U&&(A?(A=Bi(A),qi(A,this.U)):A=this.U),this.u!==null||this.R||(x.J=A,A=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=No(this,x,c),l=De(this.J),X(l,"RID",i),X(l,"CVER",22),this.G&&X(l,"X-HTTP-Session-Id",this.G),yn(this,l),A&&(this.R?c="headers="+cn(wo(A))+"&"+c:this.u&&vs(l,this.u,A)),_s(this.h,x),this.Ra&&X(l,"TYPE","init"),this.S?(X(l,"$req",c),X(l,"SID","null"),x.U=!0,fs(x,l,null)):fs(x,l,c),this.I=2}}else this.I==3&&(i?Vo(this,i):this.i.length==0||ho(this.h)||Vo(this))};function Vo(i,c){var l;c?l=c.l:l=i.V++;const f=De(i.J);X(f,"SID",i.M),X(f,"RID",l),X(f,"AID",i.K),yn(i,f),i.u&&i.o&&vs(f,i.u,i.o),l=new Je(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=No(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),_s(i.h,l),fs(l,f,c)}function yn(i,c){i.H&&Qn(i.H,function(l,f){X(c,f,l)}),i.l&&Qn({},function(l,f){X(c,f,l)})}function No(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var x=i.i;let z=-1;for(;;){const ae=["count="+l];z==-1?l>0?(z=x[0].g,ae.push("ofs="+z)):z=0:ae.push("ofs="+z);let Y=!0;for(let he=0;he<l;he++){var A=x[he].g;const ke=x[he].map;if(A-=z,A<0)z=Math.max(0,x[he].g-100),Y=!1;else try{A="req"+A+"_"||"";try{var N=ke instanceof Map?ke:Object.entries(ke);for(const[bt,et]of N){let tt=et;u(et)&&(tt=cs(et)),ae.push(A+bt+"="+encodeURIComponent(tt))}}catch(bt){throw ae.push(A+"type="+encodeURIComponent("_badmap")),bt}}catch{f&&f(ke)}}if(Y){N=ae.join("&");break e}}N=void 0}return i=i.i.splice(0,l),c.G=i,N}function Do(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;J||_(),se||(J(),se=!0),I.add(c,i),i.A=0}}function Ts(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=on(d(i.Da,i),jo(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,ko(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=on(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ie(10),sr(this),ko(this))};function Is(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function ko(i){i.g=new Je(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=De(i.na);X(c,"RID","rpc"),X(c,"SID",i.M),X(c,"AID",i.K),X(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&X(c,"TO",i.ia),X(c,"TYPE","xmlhttp"),yn(i,c),i.u&&i.o&&vs(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=tr(De(c)),l.u=null,l.R=!0,ao(l,i)}n.Va=function(){this.C!=null&&(this.C=null,sr(this),Ts(this),Ie(19))};function or(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Oo(i,c){var l=null;if(i.g==c){or(i),Is(i),i.g=null;var f=2}else if(gs(i.h,c))l=c.G,mo(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var x=i.D;f=Xn(),Te(f,new no(f,l)),ir(i)}else Do(i);else if(x=c.m,x==3||x==0&&c.X>0||!(f==1&&Nu(i,c)||f==2&&Ts(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),x){case 1:vt(i,5);break;case 4:vt(i,10);break;case 3:vt(i,6);break;default:vt(i,2)}}}function jo(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function vt(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const x=!f;f=new Ye(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||un(f,"https"),tr(f),x?Au(f.toString(),l):Su(f.toString(),l)}else Ie(2);i.I=0,i.l&&i.l.pa(c),Mo(i),Po(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))};function Mo(i){if(i.I=0,i.ja=[],i.l){const c=po(i.h);(c.length!=0||i.i.length!=0)&&(D(i.ja,c),D(i.ja,i.i),i.h.i.length=0,S(i.i),i.i.length=0),i.l.oa()}}function Lo(i,c,l){var f=l instanceof Ye?De(l):new Ye(l);if(f.g!="")c&&(f.g=c+"."+f.g),hn(f,f.u);else{var x=a.location;f=x.protocol,c=c?c+"."+x.hostname:x.hostname,x=+x.port;const A=new Ye(null);f&&un(A,f),c&&(A.g=c),x&&hn(A,x),l&&(A.h=l),f=A}return l=i.G,c=i.wa,l&&c&&X(f,l,c),X(f,"VER",i.ka),yn(i,f),f}function Fo(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new ne(new Es({ab:l})):new ne(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Uo(){}n=Uo.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ar(){}ar.prototype.g=function(i,c){return new Ae(i,c)};function Ae(i,c){ye.call(this),this.g=new Co(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!p(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!p(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Dt(this)}v(Ae,ye),Ae.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ae.prototype.close=function(){bs(this.g)},Ae.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=cs(i),i=l);c.i.push(new yu(c.Ya++,i)),c.I==3&&ir(c)},Ae.prototype.N=function(){this.g.l=null,delete this.j,bs(this.g),delete this.g,Ae.Z.N.call(this)};function Bo(i){ls.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const l in c){i=l;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}v(Bo,ls);function zo(){us.call(this),this.status=1}v(zo,us);function Dt(i){this.g=i}v(Dt,Uo),Dt.prototype.ra=function(){Te(this.g,"a")},Dt.prototype.qa=function(i){Te(this.g,new Bo(i))},Dt.prototype.pa=function(i){Te(this.g,new zo)},Dt.prototype.oa=function(){Te(this.g,"b")},ar.prototype.createWebChannel=ar.prototype.g,Ae.prototype.send=Ae.prototype.o,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,vc=function(){return new ar},Ec=function(){return Xn()},yc=_t,$s={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Zn.NO_ERROR=0,Zn.TIMEOUT=8,Zn.HTTP_ERROR=6,pr=Zn,ro.COMPLETE="complete",_c=ro,Xi.EventType=rn,rn.OPEN="a",rn.CLOSE="b",rn.ERROR="c",rn.MESSAGE="d",ye.prototype.listen=ye.prototype.J,In=Xi,ne.prototype.listenOnce=ne.prototype.K,ne.prototype.getLastError=ne.prototype.Ha,ne.prototype.getLastErrorCode=ne.prototype.ya,ne.prototype.getStatus=ne.prototype.ca,ne.prototype.getResponseJson=ne.prototype.La,ne.prototype.getResponseText=ne.prototype.la,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Fa,gc=ne}).apply(typeof lr<"u"?lr:typeof self<"u"?self:typeof window<"u"?window:{});class ve{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");let Yt="12.9.0";function Yd(n){Yt=n}const At=new lc("@firebase/firestore");function jt(){return At.logLevel}function k(n,...e){if(At.logLevel<=K.DEBUG){const t=e.map(ui);At.debug(`Firestore (${Yt}): ${n}`,...t)}}function He(n,...e){if(At.logLevel<=K.ERROR){const t=e.map(ui);At.error(`Firestore (${Yt}): ${n}`,...t)}}function St(n,...e){if(At.logLevel<=K.WARN){const t=e.map(ui);At.warn(`Firestore (${Yt}): ${n}`,...t)}}function ui(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function L(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,bc(n,r,t)}function bc(n,e,t){let r=`FIRESTORE (${Yt}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw He(r),new Error(r)}function Q(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||bc(e,s,r)}function U(n,e){return n}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends Jt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qe{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Tc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Xd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(ve.UNAUTHENTICATED)))}shutdown(){}}class Zd{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ef{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new qe;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new qe,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new qe)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Tc(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new ve(e)}}class tf{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class nf{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new tf(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(ve.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ia{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rf{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,kd(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);const r=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ia(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ia(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function sf(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class hi{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=sf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function $(n,e){return n<e?-1:n>e?1:0}function Gs(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Vs(s)===Vs(o)?$(s,o):Vs(s)?1:-1}return $(n.length,e.length)}const of=55296,af=57343;function Vs(n){const e=n.charCodeAt(0);return e>=of&&e<=af}function Gt(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const oa="__name__";class je{constructor(e,t,r){t===void 0?t=0:t>e.length&&L(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&L(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return je.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof je?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=je.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return $(e.length,t.length)}static compareSegments(e,t){const r=je.isNumericId(e),s=je.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?je.extractNumericId(e).compare(je.extractNumericId(t)):Gs(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ot.fromString(e.substring(4,e.length-2))}}class Z extends je{construct(e,t,r){return new Z(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new O(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new Z(t)}static emptyPath(){return new Z([])}}const cf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ge extends je{construct(e,t,r){return new ge(e,t,r)}static isValidIdentifier(e){return cf.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ge.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===oa}static keyField(){return new ge([oa])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new O(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new O(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new O(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new O(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ge(t)}static emptyPath(){return new ge([])}}class j{constructor(e){this.path=e}static fromPath(e){return new j(Z.fromString(e))}static fromName(e){return new j(Z.fromString(e).popFirst(5))}static empty(){return new j(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Z.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new j(new Z(e.slice()))}}function Ic(n,e,t){if(!t)throw new O(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function lf(n,e,t,r){if(e===!0&&r===!0)throw new O(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function aa(n){if(!j.isDocumentKey(n))throw new O(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ca(n){if(j.isDocumentKey(n))throw new O(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function wc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function di(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function Ke(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=di(n);throw new O(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function oe(n,e){const t={typeString:n};return e&&(t.value=e),t}function zn(n,e){if(!wc(n))throw new O(C.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new O(C.INVALID_ARGUMENT,t);return!0}const la=-62135596800,ua=1e6;class ee{static now(){return ee.fromMillis(Date.now())}static fromDate(e){return ee.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ua);return new ee(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<la)throw new O(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ua}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ee._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(zn(e,ee._jsonSchema))return new ee(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-la;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ee._jsonSchemaVersion="firestore/timestamp/1.0",ee._jsonSchema={type:oe("string",ee._jsonSchemaVersion),seconds:oe("number"),nanoseconds:oe("number")};class F{static fromTimestamp(e){return new F(e)}static min(){return new F(new ee(0,0))}static max(){return new F(new ee(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const On=-1;function uf(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=F.fromTimestamp(r===1e9?new ee(t+1,0):new ee(t,r));return new ct(s,j.empty(),e)}function hf(n){return new ct(n.readTime,n.key,On)}class ct{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ct(F.min(),j.empty(),On)}static max(){return new ct(F.max(),j.empty(),On)}}function df(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=j.comparator(n.documentKey,e.documentKey),t!==0?t:$(n.largestBatchId,e.largestBatchId))}const ff="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class mf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Xt(n){if(n.code!==C.FAILED_PRECONDITION||n.message!==ff)throw n;k("LocalStore","Unexpectedly lost primary lease")}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):R.reject(t)}static resolve(e){return new R(((t,r)=>{t(e)}))}static reject(e){return new R(((t,r)=>{r(e)}))}static waitFor(e){return new R(((t,r)=>{let s=0,o=0,a=!1;e.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=R.resolve(!1);for(const r of e)t=t.next((s=>s?R.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new R(((r,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((g=>{a[d]=g,++u,u===o&&r(a)}),(g=>s(g)))}}))}static doWhile(e,t){return new R(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function pf(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Zt(n){return n.name==="IndexedDbTransactionError"}class Mr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Mr.ce=-1;const fi=-1;function Lr(n){return n==null}function xr(n){return n===0&&1/n==-1/0}function gf(n){return typeof n=="number"&&Number.isInteger(n)&&!xr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const xc="";function _f(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ha(e)),e=yf(n.get(t),e);return ha(e)}function yf(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case xc:t+="";break;default:t+=o}}return t}function ha(n){return n+xc+""}function da(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function mt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ac(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class te{constructor(e,t){this.comparator=e,this.root=t||pe.EMPTY}insert(e,t){return new te(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,pe.BLACK,null,null))}remove(e){return new te(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ur(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ur(this.root,e,this.comparator,!1)}getReverseIterator(){return new ur(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ur(this.root,e,this.comparator,!0)}}class ur{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pe{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??pe.RED,this.left=s??pe.EMPTY,this.right=o??pe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new pe(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return pe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return pe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw L(27949);return e+(this.isRed()?0:1)}}pe.EMPTY=null,pe.RED=!0,pe.BLACK=!1;pe.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new pe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ue{constructor(e){this.comparator=e,this.data=new te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fa(this.data.getIterator())}getIteratorFrom(e){return new fa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ue)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ue(this.comparator);return t.data=e,t}}class fa{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Se{constructor(e){this.fields=e,e.sort(ge.comparator)}static empty(){return new Se([])}unionWith(e){let t=new ue(ge.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Se(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Gt(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class Sc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class _e{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Sc("Invalid base64 string: "+o):o}})(e);return new _e(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new _e(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}_e.EMPTY_BYTE_STRING=new _e("");const Ef=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lt(n){if(Q(!!n,39018),typeof n=="string"){let e=0;const t=Ef.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:re(n.seconds),nanos:re(n.nanos)}}function re(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ut(n){return typeof n=="string"?_e.fromBase64String(n):_e.fromUint8Array(n)}const Rc="server_timestamp",Cc="__type__",Pc="__previous_value__",Vc="__local_write_time__";function mi(n){return(n?.mapValue?.fields||{})[Cc]?.stringValue===Rc}function Fr(n){const e=n.mapValue.fields[Pc];return mi(e)?Fr(e):e}function jn(n){const e=lt(n.mapValue.fields[Vc].timestampValue);return new ee(e.seconds,e.nanos)}class vf{constructor(e,t,r,s,o,a,u,h,d,g,v){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=g,this.apiKey=v}}const Ar="(default)";class Mn{constructor(e,t){this.projectId=e,this.database=t||Ar}static empty(){return new Mn("","")}get isDefaultDatabase(){return this.database===Ar}isEqual(e){return e instanceof Mn&&e.projectId===this.projectId&&e.database===this.database}}function bf(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new O(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mn(n.options.projectId,e)}const Nc="__type__",Tf="__max__",hr={mapValue:{}},Dc="__vector__",Sr="value";function ht(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?mi(n)?4:wf(n)?9007199254740991:If(n)?10:11:L(28295,{value:n})}function Be(n,e){if(n===e)return!0;const t=ht(n);if(t!==ht(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return jn(n).isEqual(jn(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=lt(s.timestampValue),u=lt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return ut(s.bytesValue).isEqual(ut(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return re(s.geoPointValue.latitude)===re(o.geoPointValue.latitude)&&re(s.geoPointValue.longitude)===re(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return re(s.integerValue)===re(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=re(s.doubleValue),u=re(o.doubleValue);return a===u?xr(a)===xr(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return Gt(n.arrayValue.values||[],e.arrayValue.values||[],Be);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(da(a)!==da(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Be(a[h],u[h])))return!1;return!0})(n,e);default:return L(52216,{left:n})}}function Ln(n,e){return(n.values||[]).find((t=>Be(t,e)))!==void 0}function Ht(n,e){if(n===e)return 0;const t=ht(n),r=ht(e);if(t!==r)return $(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=re(o.integerValue||o.doubleValue),h=re(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return ma(n.timestampValue,e.timestampValue);case 4:return ma(jn(n),jn(e));case 5:return Gs(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=ut(o),h=ut(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const g=$(u[d],h[d]);if(g!==0)return g}return $(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=$(re(o.latitude),re(a.latitude));return u!==0?u:$(re(o.longitude),re(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return pa(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[Sr]?.arrayValue,g=h[Sr]?.arrayValue,v=$(d?.values?.length||0,g?.values?.length||0);return v!==0?v:pa(d,g)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===hr.mapValue&&a===hr.mapValue)return 0;if(o===hr.mapValue)return 1;if(a===hr.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},g=Object.keys(d);h.sort(),g.sort();for(let v=0;v<h.length&&v<g.length;++v){const T=Gs(h[v],g[v]);if(T!==0)return T;const S=Ht(u[h[v]],d[g[v]]);if(S!==0)return S}return $(h.length,g.length)})(n.mapValue,e.mapValue);default:throw L(23264,{he:t})}}function ma(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return $(n,e);const t=lt(n),r=lt(e),s=$(t.seconds,r.seconds);return s!==0?s:$(t.nanos,r.nanos)}function pa(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=Ht(t[s],r[s]);if(o)return o}return $(t.length,r.length)}function Kt(n){return Hs(n)}function Hs(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=lt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return ut(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return j.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=Hs(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Hs(t.fields[a])}`;return s+"}"})(n.mapValue):L(61005,{value:n})}function gr(n){switch(ht(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Fr(n);return e?16+gr(e):16;case 5:return 2*n.stringValue.length;case 6:return ut(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+gr(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return mt(r.fields,((o,a)=>{s+=o.length+gr(a)})),s})(n.mapValue);default:throw L(13486,{value:n})}}function Ks(n){return!!n&&"integerValue"in n}function pi(n){return!!n&&"arrayValue"in n}function ga(n){return!!n&&"nullValue"in n}function _a(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function _r(n){return!!n&&"mapValue"in n}function If(n){return(n?.mapValue?.fields||{})[Nc]?.stringValue===Dc}function Cn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return mt(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Cn(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Cn(n.arrayValue.values[t]);return e}return{...n}}function wf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Tf}class xe{constructor(e){this.value=e}static empty(){return new xe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!_r(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Cn(t)}setAll(e){let t=ge.emptyPath(),r={},s=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=Cn(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());_r(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Be(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];_r(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){mt(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new xe(Cn(this.value))}}function kc(n){const e=[];return mt(n.fields,((t,r)=>{const s=new ge([t]);if(_r(r)){const o=kc(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new Se(e)}class be{constructor(e,t,r,s,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new be(e,0,F.min(),F.min(),F.min(),xe.empty(),0)}static newFoundDocument(e,t,r,s){return new be(e,1,t,F.min(),r,s,0)}static newNoDocument(e,t){return new be(e,2,t,F.min(),F.min(),xe.empty(),0)}static newUnknownDocument(e,t){return new be(e,3,t,F.min(),F.min(),xe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(F.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=F.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof be&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new be(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Rr{constructor(e,t){this.position=e,this.inclusive=t}}function ya(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=j.comparator(j.fromName(a.referenceValue),t.key):r=Ht(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ea(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Be(n.position[t],e.position[t]))return!1;return!0}class Cr{constructor(e,t="asc"){this.field=e,this.dir=t}}function xf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Oc{}class ce extends Oc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Sf(e,t,r):t==="array-contains"?new Pf(e,r):t==="in"?new Vf(e,r):t==="not-in"?new Nf(e,r):t==="array-contains-any"?new Df(e,r):new ce(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Rf(e,r):new Cf(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Ht(t,this.value)):t!==null&&ht(this.value)===ht(t)&&this.matchesComparison(Ht(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ze extends Oc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ze(e,t)}matches(e){return jc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function jc(n){return n.op==="and"}function Mc(n){return Af(n)&&jc(n)}function Af(n){for(const e of n.filters)if(e instanceof ze)return!1;return!0}function Ws(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+Kt(n.value);if(Mc(n))return n.filters.map((e=>Ws(e))).join(",");{const e=n.filters.map((t=>Ws(t))).join(",");return`${n.op}(${e})`}}function Lc(n,e){return n instanceof ce?(function(r,s){return s instanceof ce&&r.op===s.op&&r.field.isEqual(s.field)&&Be(r.value,s.value)})(n,e):n instanceof ze?(function(r,s){return s instanceof ze&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&Lc(a,s.filters[u])),!0):!1})(n,e):void L(19439)}function Fc(n){return n instanceof ce?(function(t){return`${t.field.canonicalString()} ${t.op} ${Kt(t.value)}`})(n):n instanceof ze?(function(t){return t.op.toString()+" {"+t.getFilters().map(Fc).join(" ,")+"}"})(n):"Filter"}class Sf extends ce{constructor(e,t,r){super(e,t,r),this.key=j.fromName(r.referenceValue)}matches(e){const t=j.comparator(e.key,this.key);return this.matchesComparison(t)}}class Rf extends ce{constructor(e,t){super(e,"in",t),this.keys=Uc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Cf extends ce{constructor(e,t){super(e,"not-in",t),this.keys=Uc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Uc(n,e){return(e.arrayValue?.values||[]).map((t=>j.fromName(t.referenceValue)))}class Pf extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return pi(t)&&Ln(t.arrayValue,this.value)}}class Vf extends ce{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ln(this.value.arrayValue,t)}}class Nf extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ln(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ln(this.value.arrayValue,t)}}class Df extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!pi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Ln(this.value.arrayValue,r)))}}class kf{constructor(e,t=null,r=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function va(n,e=null,t=[],r=[],s=null,o=null,a=null){return new kf(n,e,t,r,s,o,a)}function gi(n){const e=U(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Ws(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Lr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Kt(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Kt(r))).join(",")),e.Te=t}return e.Te}function _i(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!xf(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Lc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ea(n.startAt,e.startAt)&&Ea(n.endAt,e.endAt)}function Qs(n){return j.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Ur{constructor(e,t=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Of(n,e,t,r,s,o,a,u){return new Ur(n,e,t,r,s,o,a,u)}function yi(n){return new Ur(n)}function ba(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function jf(n){return j.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Mf(n){return n.collectionGroup!==null}function Pn(n){const e=U(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ue(ge.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Cr(o,r))})),t.has(ge.keyField().canonicalString())||e.Ie.push(new Cr(ge.keyField(),r))}return e.Ie}function Le(n){const e=U(n);return e.Ee||(e.Ee=Lf(e,Pn(n))),e.Ee}function Lf(n,e){if(n.limitType==="F")return va(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Cr(s.field,o)}));const t=n.endAt?new Rr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Rr(n.startAt.position,n.startAt.inclusive):null;return va(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Js(n,e,t){return new Ur(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Br(n,e){return _i(Le(n),Le(e))&&n.limitType===e.limitType}function Bc(n){return`${gi(Le(n))}|lt:${n.limitType}`}function Mt(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Fc(s))).join(", ")}]`),Lr(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Kt(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Kt(s))).join(",")),`Target(${r})`})(Le(n))}; limitType=${n.limitType})`}function zr(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):j.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Pn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=ya(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,Pn(r),s)||r.endAt&&!(function(a,u,h){const d=ya(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,Pn(r),s))})(n,e)}function Ff(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function zc(n){return(e,t)=>{let r=!1;for(const s of Pn(n)){const o=Uf(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Uf(n,e,t){const r=n.field.isKeyField()?j.comparator(e.key,t.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Ht(h,d):L(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}class Ct{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){mt(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return Ac(this.inner)}size(){return this.innerSize}}const Bf=new te(j.comparator);function We(){return Bf}const qc=new te(j.comparator);function wn(...n){let e=qc;for(const t of n)e=e.insert(t.key,t);return e}function $c(n){let e=qc;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function wt(){return Vn()}function Gc(){return Vn()}function Vn(){return new Ct((n=>n.toString()),((n,e)=>n.isEqual(e)))}const zf=new te(j.comparator),qf=new ue(j.comparator);function G(...n){let e=qf;for(const t of n)e=e.add(t);return e}const $f=new ue($);function Gf(){return $f}function Ei(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xr(e)?"-0":e}}function Hc(n){return{integerValue:""+n}}function Hf(n,e){return gf(e)?Hc(e):Ei(n,e)}class qr{constructor(){this._=void 0}}function Kf(n,e,t){return n instanceof Pr?(function(s,o){const a={fields:{[Cc]:{stringValue:Rc},[Vc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&mi(o)&&(o=Fr(o)),o&&(a.fields[Pc]=o),{mapValue:a}})(t,e):n instanceof Fn?Wc(n,e):n instanceof Un?Qc(n,e):(function(s,o){const a=Kc(s,o),u=Ta(a)+Ta(s.Ae);return Ks(a)&&Ks(s.Ae)?Hc(u):Ei(s.serializer,u)})(n,e)}function Wf(n,e,t){return n instanceof Fn?Wc(n,e):n instanceof Un?Qc(n,e):t}function Kc(n,e){return n instanceof Vr?(function(r){return Ks(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Pr extends qr{}class Fn extends qr{constructor(e){super(),this.elements=e}}function Wc(n,e){const t=Jc(e);for(const r of n.elements)t.some((s=>Be(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Un extends qr{constructor(e){super(),this.elements=e}}function Qc(n,e){let t=Jc(e);for(const r of n.elements)t=t.filter((s=>!Be(s,r)));return{arrayValue:{values:t}}}class Vr extends qr{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ta(n){return re(n.integerValue||n.doubleValue)}function Jc(n){return pi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Qf(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Fn&&s instanceof Fn||r instanceof Un&&s instanceof Un?Gt(r.elements,s.elements,Be):r instanceof Vr&&s instanceof Vr?Be(r.Ae,s.Ae):r instanceof Pr&&s instanceof Pr})(n.transform,e.transform)}class Jf{constructor(e,t){this.version=e,this.transformResults=t}}class Re{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Re}static exists(e){return new Re(void 0,e)}static updateTime(e){return new Re(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function yr(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class $r{}function Yc(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Gr(n.key,Re.none()):new qn(n.key,n.data,Re.none());{const t=n.data,r=xe.empty();let s=new ue(ge.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new pt(n.key,r,new Se(s.toArray()),Re.none())}}function Yf(n,e,t){n instanceof qn?(function(s,o,a){const u=s.value.clone(),h=wa(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof pt?(function(s,o,a){if(!yr(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=wa(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Xc(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Nn(n,e,t,r){return n instanceof qn?(function(o,a,u,h){if(!yr(o.precondition,a))return u;const d=o.value.clone(),g=xa(o.fieldTransforms,h,a);return d.setAll(g),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof pt?(function(o,a,u,h){if(!yr(o.precondition,a))return u;const d=xa(o.fieldTransforms,h,a),g=a.data;return g.setAll(Xc(o)),g.setAll(d),a.convertToFoundDocument(a.version,g).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((v=>v.field)))})(n,e,t,r):(function(o,a,u){return yr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function Xf(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=Kc(r.transform,s||null);o!=null&&(t===null&&(t=xe.empty()),t.set(r.field,o))}return t||null}function Ia(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Gt(r,s,((o,a)=>Qf(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class qn extends $r{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class pt extends $r{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Xc(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function wa(n,e,t){const r=new Map;Q(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,u=e.data.field(o.field);r.set(o.field,Wf(a,u,t[s]))}return r}function xa(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,Kf(o,a,e))}return r}class Gr extends $r{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Zf extends $r{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class em{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&Yf(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Nn(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Nn(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Gc();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=Yc(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(F.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),G())}isEqual(e){return this.batchId===e.batchId&&Gt(this.mutations,e.mutations,((t,r)=>Ia(t,r)))&&Gt(this.baseMutations,e.baseMutations,((t,r)=>Ia(t,r)))}}class vi{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Q(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return zf})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new vi(e,t,r,s)}}class tm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class nm{constructor(e,t){this.count=e,this.unchangedNames=t}}var ie,H;function rm(n){switch(n){case C.OK:return L(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function Zc(n){if(n===void 0)return He("GRPC error has no .code"),C.UNKNOWN;switch(n){case ie.OK:return C.OK;case ie.CANCELLED:return C.CANCELLED;case ie.UNKNOWN:return C.UNKNOWN;case ie.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case ie.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case ie.INTERNAL:return C.INTERNAL;case ie.UNAVAILABLE:return C.UNAVAILABLE;case ie.UNAUTHENTICATED:return C.UNAUTHENTICATED;case ie.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case ie.NOT_FOUND:return C.NOT_FOUND;case ie.ALREADY_EXISTS:return C.ALREADY_EXISTS;case ie.PERMISSION_DENIED:return C.PERMISSION_DENIED;case ie.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case ie.ABORTED:return C.ABORTED;case ie.OUT_OF_RANGE:return C.OUT_OF_RANGE;case ie.UNIMPLEMENTED:return C.UNIMPLEMENTED;case ie.DATA_LOSS:return C.DATA_LOSS;default:return L(39323,{code:n})}}(H=ie||(ie={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";function sm(){return new TextEncoder}const im=new ot([4294967295,4294967295],0);function Aa(n){const e=sm().encode(n),t=new pc;return t.update(e),new Uint8Array(t.digest())}function Sa(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ot([t,r],0),new ot([s,o],0)]}class bi{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new xn(`Invalid padding: ${t}`);if(r<0)throw new xn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new xn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new xn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ot.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(ot.fromNumber(r)));return s.compare(im)===1&&(s=new ot([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Aa(e),[r,s]=Sa(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new bi(o,s,t);return r.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=Aa(e),[r,s]=Sa(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.be(a)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class xn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Hr{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,$n.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Hr(F.min(),s,new te($),We(),G())}}class $n{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new $n(r,t,G(),G(),G())}}class Er{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class el{constructor(e,t){this.targetId=e,this.Ce=t}}class tl{constructor(e,t,r=_e.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Ra{constructor(){this.ve=0,this.Fe=Ca(),this.Me=_e.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=G(),t=G(),r=G();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:L(38017,{changeType:o})}})),new $n(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=Ca()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class om{constructor(e){this.Ge=e,this.ze=new Map,this.je=We(),this.He=dr(),this.Je=dr(),this.Ze=new te($)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:L(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(Qs(o))if(r===0){const a=new j(o.path);this.et(t,a,be.newNoDocument(a,F.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,u;try{a=ut(r).toUint8Array()}catch(h){if(h instanceof Sc)return St("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new bi(a,s,o)}catch(h){return St(h instanceof xn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&Qs(u.target)){const h=new j(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,be.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}}));let r=G();this.Je.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new Hr(e,t,this.Ze,this.je,r);return this.je=We(),this.He=dr(),this.Je=dr(),this.Ze=new te($),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Ra,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new ue($),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new ue($),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||k("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ra),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function dr(){return new te(j.comparator)}function Ca(){return new te(j.comparator)}const am={asc:"ASCENDING",desc:"DESCENDING"},cm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lm={and:"AND",or:"OR"};class um{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ys(n,e){return n.useProto3Json||Lr(e)?e:{value:e}}function Nr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function nl(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function hm(n,e){return Nr(n,e.toTimestamp())}function Fe(n){return Q(!!n,49232),F.fromTimestamp((function(t){const r=lt(t);return new ee(r.seconds,r.nanos)})(n))}function Ti(n,e){return Xs(n,e).canonicalString()}function Xs(n,e){const t=(function(s){return new Z(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function rl(n){const e=Z.fromString(n);return Q(cl(e),10190,{key:e.toString()}),e}function Zs(n,e){return Ti(n.databaseId,e.path)}function Ns(n,e){const t=rl(e);if(t.get(1)!==n.databaseId.projectId)throw new O(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new j(il(t))}function sl(n,e){return Ti(n.databaseId,e)}function dm(n){const e=rl(n);return e.length===4?Z.emptyPath():il(e)}function ei(n){return new Z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function il(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Pa(n,e,t){return{name:Zs(n,e),fields:t.value.mapValue.fields}}function fm(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,g){return d.useProto3Json?(Q(g===void 0||typeof g=="string",58123),_e.fromBase64String(g||"")):(Q(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),_e.fromUint8Array(g||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){const g=d.code===void 0?C.UNKNOWN:Zc(d.code);return new O(g,d.message||"")})(a);t=new tl(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ns(n,r.document.name),o=Fe(r.document.updateTime),a=r.document.createTime?Fe(r.document.createTime):F.min(),u=new xe({mapValue:{fields:r.document.fields}}),h=be.newFoundDocument(s,o,a,u),d=r.targetIds||[],g=r.removedTargetIds||[];t=new Er(d,g,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ns(n,r.document),o=r.readTime?Fe(r.readTime):F.min(),a=be.newNoDocument(s,o),u=r.removedTargetIds||[];t=new Er([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ns(n,r.document),o=r.removedTargetIds||[];t=new Er([],o,s,null)}else{if(!("filter"in e))return L(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new nm(s,o),u=r.targetId;t=new el(u,a)}}return t}function mm(n,e){let t;if(e instanceof qn)t={update:Pa(n,e.key,e.value)};else if(e instanceof Gr)t={delete:Zs(n,e.key)};else if(e instanceof pt)t={update:Pa(n,e.key,e.data),updateMask:Im(e.fieldMask)};else{if(!(e instanceof Zf))return L(16599,{dt:e.type});t={verify:Zs(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof Pr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Fn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Un)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Vr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw L(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:hm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)})(n,e.precondition)),t}function pm(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?Fe(s.updateTime):Fe(o);return a.isEqual(F.min())&&(a=Fe(o)),new Jf(a,s.transformResults||[])})(t,e)))):[]}function gm(n,e){return{documents:[sl(n,e.path)]}}function _m(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=sl(n,s);const o=(function(d){if(d.length!==0)return al(ze.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((g=>(function(T){return{field:Lt(T.field),direction:vm(T.dir)}})(g)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=Ys(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function ym(n){let e=dm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Q(r===1,65062);const g=t.from[0];g.allDescendants?s=g.collectionId:e=e.child(g.collectionId)}let o=[];t.where&&(o=(function(v){const T=ol(v);return T instanceof ze&&Mc(T)?T.getFilters():[T]})(t.where));let a=[];t.orderBy&&(a=(function(v){return v.map((T=>(function(D){return new Cr(Ft(D.field),(function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(T)))})(t.orderBy));let u=null;t.limit&&(u=(function(v){let T;return T=typeof v=="object"?v.value:v,Lr(T)?null:T})(t.limit));let h=null;t.startAt&&(h=(function(v){const T=!!v.before,S=v.values||[];return new Rr(S,T)})(t.startAt));let d=null;return t.endAt&&(d=(function(v){const T=!v.before,S=v.values||[];return new Rr(S,T)})(t.endAt)),Of(e,s,a,o,u,"F",h,d)}function Em(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ol(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ft(t.unaryFilter.field);return ce.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ft(t.unaryFilter.field);return ce.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ft(t.unaryFilter.field);return ce.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ft(t.unaryFilter.field);return ce.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ce.create(Ft(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ze.create(t.compositeFilter.filters.map((r=>ol(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(t.compositeFilter.op))})(n):L(30097,{filter:n})}function vm(n){return am[n]}function bm(n){return cm[n]}function Tm(n){return lm[n]}function Lt(n){return{fieldPath:n.canonicalString()}}function Ft(n){return ge.fromServerFormat(n.fieldPath)}function al(n){return n instanceof ce?(function(t){if(t.op==="=="){if(_a(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NAN"}};if(ga(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(_a(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NOT_NAN"}};if(ga(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Lt(t.field),op:bm(t.op),value:t.value}}})(n):n instanceof ze?(function(t){const r=t.getFilters().map((s=>al(s)));return r.length===1?r[0]:{compositeFilter:{op:Tm(t.op),filters:r}}})(n):L(54877,{filter:n})}function Im(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function cl(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function ll(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class rt{constructor(e,t,r,s,o=F.min(),a=F.min(),u=_e.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new rt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new rt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class wm{constructor(e){this.yt=e}}function xm(n){const e=ym({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Js(e,e.limit,"L"):e}class Am{constructor(){this.Sn=new Sm}addToCollectionParentIndex(e,t){return this.Sn.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(ct.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(ct.min())}updateCollectionGroup(e,t,r){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class Sm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ue(Z.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ue(Z.comparator)).toArray()}}const Va={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ul=41943040;class we{static withCacheSize(e){return new we(e,we.DEFAULT_COLLECTION_PERCENTILE,we.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}we.DEFAULT_COLLECTION_PERCENTILE=10,we.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,we.DEFAULT=new we(ul,we.DEFAULT_COLLECTION_PERCENTILE,we.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),we.DISABLED=new we(-1,0,0);class Wt{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Wt(0)}static ar(){return new Wt(-1)}}const Na="LruGarbageCollector",Rm=1048576;function Da([n,e],[t,r]){const s=$(n,t);return s===0?$(e,r):s}class Cm{constructor(e){this.Pr=e,this.buffer=new ue(Da),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Da(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Pm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){k(Na,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Zt(t)?k(Na,"Ignoring IndexedDB error during garbage collection: ",t):await Xt(t)}await this.Ar(3e5)}))}}class Vm{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return R.resolve(Mr.ce);const r=new Cm(t);return this.Vr.forEachTarget(e,(s=>r.Er(s.sequenceNumber))).next((()=>this.Vr.mr(e,(s=>r.Er(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Va)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Va):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,o,a,u,h,d;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((v=>(v>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,a=Date.now(),this.nthSequenceNumber(e,s)))).next((v=>(r=v,u=Date.now(),this.removeTargets(e,r,t)))).next((v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((v=>(d=Date.now(),jt()<=K.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-g}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${v} documents in `+(d-h)+`ms
Total Duration: ${d-g}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v}))))}}function Nm(n,e){return new Vm(n,e)}class Dm{constructor(){this.changes=new Ct((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,be.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?R.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class km{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Om{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Nn(r.mutation,s,Se.empty(),ee.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,G()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=G()){const s=wt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=wn();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=wt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,G())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,r,s){let o=We();const a=Vn(),u=(function(){return Vn()})();return t.forEach(((h,d)=>{const g=r.get(d.key);s.has(d.key)&&(g===void 0||g.mutation instanceof pt)?o=o.insert(d.key,d):g!==void 0?(a.set(d.key,g.mutation.getFieldMask()),Nn(g.mutation,d,g.mutation.getFieldMask(),ee.now())):a.set(d.key,Se.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,g)=>a.set(d,g))),t.forEach(((d,g)=>u.set(d,new km(g,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=Vn();let s=new te(((a,u)=>a-u)),o=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let g=r.get(h)||Se.empty();g=u.applyToLocalView(d,g),r.set(h,g);const v=(s.get(u.batchId)||G()).add(h);s=s.insert(u.batchId,v)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,g=h.value,v=Gc();g.forEach((T=>{if(!o.has(T)){const S=Yc(t.get(T),r.get(T));S!==null&&v.set(T,S),o=o.add(T)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return R.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return jf(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Mf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):R.resolve(wt());let u=On,h=o;return a.next((d=>R.forEach(d,((g,v)=>(u<v.largestBatchId&&(u=v.largestBatchId),o.get(g)?R.resolve():this.remoteDocumentCache.getEntry(e,g).next((T=>{h=h.insert(g,T)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,G()))).next((g=>({batchId:u,changes:$c(g)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new j(t)).next((r=>{let s=wn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=wn();return this.indexManager.getCollectionParents(e,o).next((u=>R.forEach(u,(h=>{const d=(function(v,T){return new Ur(T,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((g=>{g.forEach(((v,T)=>{a=a.insert(v,T)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const g=d.getKey();a.get(g)===null&&(a=a.insert(g,be.newInvalidDocument(g)))}));let u=wn();return a.forEach(((h,d)=>{const g=o.get(h);g!==void 0&&Nn(g.mutation,d,Se.empty(),ee.now()),zr(t,d)&&(u=u.insert(h,d))})),u}))}}class jm{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return R.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Fe(s.createTime)}})(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(s){return{name:s.name,query:xm(s.bundledQuery),readTime:Fe(s.readTime)}})(t)),R.resolve()}}class Mm{constructor(){this.overlays=new te(j.comparator),this.Lr=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const r=wt();return R.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.bt(e,t,o)})),R.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.Lr.delete(r)),R.resolve()}getOverlaysForCollection(e,t,r){const s=wt(),o=t.length+1,a=new j(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return R.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new te(((d,g)=>d-g));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let g=o.get(d.largestBatchId);g===null&&(g=wt(),o=o.insert(d.largestBatchId,g)),g.set(d.getKey(),d)}}const u=wt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,g)=>u.set(d,g))),!(u.size()>=s)););return R.resolve(u)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new tm(t,r));let o=this.Lr.get(t);o===void 0&&(o=G(),this.Lr.set(t,o)),this.Lr.set(t,o.add(r.key))}}class Lm{constructor(){this.sessionToken=_e.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}class Ii{constructor(){this.kr=new ue(fe.Kr),this.qr=new ue(fe.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new fe(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new fe(e,t))}Qr(e,t){e.forEach((r=>this.removeReference(r,t)))}Gr(e){const t=new j(new Z([])),r=new fe(t,e),s=new fe(t,e+1),o=[];return this.qr.forEachInRange([r,s],(a=>{this.Wr(a),o.push(a.key)})),o}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new j(new Z([])),r=new fe(t,e),s=new fe(t,e+1);let o=G();return this.qr.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new fe(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class fe{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return j.comparator(e.key,t.key)||$(e.Hr,t.Hr)}static Ur(e,t){return $(e.Hr,t.Hr)||j.comparator(e.key,t.key)}}class Fm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new ue(fe.Kr)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new em(o,t,r,s);this.mutationQueue.push(a);for(const u of s)this.Jr=this.Jr.add(new fe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),o=s<0?0:s;return R.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?fi:this.Yn-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new fe(t,0),s=new fe(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,s],(a=>{const u=this.Zr(a.Hr);o.push(u)})),R.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ue($);return t.forEach((s=>{const o=new fe(s,0),a=new fe(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],(u=>{r=r.add(u.Hr)}))})),R.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;j.isDocumentKey(o)||(o=o.child(""));const a=new fe(new j(o),0);let u=new ue($);return this.Jr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Hr)),!0)}),a),R.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach((r=>{const s=this.Zr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Q(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return R.forEach(t.mutations,(s=>{const o=new fe(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Jr=r}))}nr(e){}containsKey(e,t){const r=new fe(t,0),s=this.Jr.firstAfterOrEqual(r);return R.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Um{constructor(e){this.ti=e,this.docs=(function(){return new te(j.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return R.resolve(r?r.document.mutableCopy():be.newInvalidDocument(t))}getEntries(e,t){let r=We();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():be.newInvalidDocument(s))})),R.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=We();const a=t.path,u=new j(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:g}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||df(hf(g),r)<=0||(s.has(g.key)||zr(t,g))&&(o=o.insert(g.key,g.mutableCopy()))}return R.resolve(o)}getAllFromCollectionGroup(e,t,r,s){L(9500)}ni(e,t){return R.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new Bm(this)}getSize(e){return R.resolve(this.size)}}class Bm extends Dm{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)})),R.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class zm{constructor(e){this.persistence=e,this.ri=new Ct((t=>gi(t)),_i),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.ii=0,this.si=new Ii,this.targetCount=0,this.oi=Wt._r()}forEachTarget(e,t){return this.ri.forEach(((r,s)=>t(s))),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),R.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Wt(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.lr(t),R.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.ri.forEach(((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)})),R.waitFor(o).next((()=>s))}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return R.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),R.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),R.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return R.resolve(r)}containsKey(e,t){return R.resolve(this.si.containsKey(t))}}class hl{constructor(e,t){this._i={},this.overlays={},this.ai=new Mr(0),this.ui=!1,this.ui=!0,this.ci=new Lm,this.referenceDelegate=e(this),this.li=new zm(this),this.indexManager=new Am,this.remoteDocumentCache=(function(s){return new Um(s)})((r=>this.referenceDelegate.hi(r))),this.serializer=new wm(t),this.Pi=new jm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Mm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new Fm(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){k("MemoryPersistence","Starting transaction:",e);const s=new qm(this.ai.next());return this.referenceDelegate.Ti(),r(s).next((o=>this.referenceDelegate.Ii(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ei(e,t){return R.or(Object.values(this._i).map((r=>()=>r.containsKey(e,t))))}}class qm extends mf{constructor(e){super(),this.currentSequenceNumber=e}}class wi{constructor(e){this.persistence=e,this.Ri=new Ii,this.Ai=null}static Vi(e){return new wi(e)}get di(){if(this.Ai)return this.Ai;throw L(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),R.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),R.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((s=>this.di.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.di.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.di,(r=>{const s=j.fromPath(r);return this.mi(e,s).next((o=>{o||t.removeEntry(s,F.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return R.or([()=>R.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Dr{constructor(e,t){this.persistence=e,this.fi=new Ct((r=>_f(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Nm(this,t)}static Vi(e,t){return new Dr(e,t)}Ti(){}Ii(e){return R.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}mr(e,t){return R.forEach(this.fi,((r,s)=>this.wr(e,r,s).next((o=>o?R.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ni(e,(a=>this.wr(e,a,t).next((u=>{u||(r++,o.removeEntry(a,F.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),R.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),R.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),R.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),R.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=gr(e.data.value)),t}wr(e,t,r){return R.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return R.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class xi{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=G(),s=G();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new xi(e,t.fromCache,r,s)}}class $m{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Gm{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Vh()?8:pf(Ch())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.gs(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ps(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new $m;return this.ys(e,t,a).next((u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)}))})).next((()=>o.result))}ws(e,t,r,s){return r.documentReadCount<this.Vs?(jt()<=K.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Mt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),R.resolve()):(jt()<=K.DEBUG&&k("QueryEngine","Query:",Mt(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(jt()<=K.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Mt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Le(t))):R.resolve())}gs(e,t){if(ba(t))return R.resolve(null);let r=Le(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Js(t,null,"F"),r=Le(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=G(...o);return this.fs.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.bs(t,u);return this.Ss(t,d,a,h.readTime)?this.gs(e,Js(t,null,"F")):this.Ds(e,d,t,h)}))))})))))}ps(e,t,r,s){return ba(t)||s.isEqual(F.min())?R.resolve(null):this.fs.getDocuments(e,r).next((o=>{const a=this.bs(t,o);return this.Ss(t,a,r,s)?R.resolve(null):(jt()<=K.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Mt(t)),this.Ds(e,a,t,uf(s,On)).next((u=>u)))}))}bs(e,t){let r=new ue(zc(e));return t.forEach(((s,o)=>{zr(e,o)&&(r=r.add(o))})),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ys(e,t,r){return jt()<=K.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Mt(t)),this.fs.getDocumentsMatchingQuery(e,t,ct.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Ai="LocalStore",Hm=3e8;class Km{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new te($),this.Fs=new Ct((o=>gi(o)),_i),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Om(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function Wm(n,e,t,r){return new Km(n,e,t,r)}async function dl(n,e){const t=U(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Os(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=G();for(const d of s){a.push(d.batchId);for(const g of d.mutations)h=h.add(g.key)}for(const d of o){u.push(d.batchId);for(const g of d.mutations)h=h.add(g.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ns:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function Qm(n,e){const t=U(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,g){const v=d.batch,T=v.keys();let S=R.resolve();return T.forEach((D=>{S=S.next((()=>g.getEntry(h,D))).next((P=>{const V=d.docVersions.get(D);Q(V!==null,48541),P.version.compareTo(V)<0&&(v.applyToRemoteDocument(P,d),P.isValidDocument()&&(P.setReadTime(d.commitVersion),g.addEntry(P)))}))})),S.next((()=>u.mutationQueue.removeMutationBatch(h,v)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=G();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function fl(n){const e=U(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function Jm(n,e){const t=U(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const u=[];e.targetChanges.forEach(((g,v)=>{const T=s.get(v);if(!T)return;u.push(t.li.removeMatchingKeys(o,g.removedDocuments,v).next((()=>t.li.addMatchingKeys(o,g.addedDocuments,v))));let S=T.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?S=S.withResumeToken(_e.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):g.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(g.resumeToken,r)),s=s.insert(v,S),(function(P,V,M){return P.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=Hm?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0})(T,S,g)&&u.push(t.li.updateTargetData(o,S))}));let h=We(),d=G();if(e.documentUpdates.forEach((g=>{e.resolvedLimboDocuments.has(g)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,g))})),u.push(Ym(o,a,e.documentUpdates).next((g=>{h=g.Bs,d=g.Ls}))),!r.isEqual(F.min())){const g=t.li.getLastRemoteSnapshotVersion(o).next((v=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(g)}return R.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.vs=s,o)))}function Ym(n,e,t){let r=G(),s=G();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=We();return t.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(F.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):k(Ai,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{Bs:a,Ls:s}}))}function Xm(n,e){const t=U(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=fi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Zm(n,e){const t=U(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.li.getTargetData(r,e).next((o=>o?(s=o,R.resolve(s)):t.li.allocateTargetId(r).next((a=>(s=new rt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r}))}async function ti(n,e,t){const r=U(n),s=r.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Zt(a))throw a;k(Ai,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function ka(n,e,t){const r=U(n);let s=F.min(),o=G();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,g){const v=U(h),T=v.Fs.get(g);return T!==void 0?R.resolve(v.vs.get(T)):v.li.getTargetData(d,g)})(r,a,Le(e)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:F.min(),t?o:G()))).next((u=>(ep(r,Ff(e),u),{documents:u,ks:o})))))}function ep(n,e,t){let r=n.Ms.get(e)||F.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Ms.set(e,r)}class Oa{constructor(){this.activeTargetIds=Gf()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class tp{constructor(){this.vo=new Oa,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Oa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class np{Mo(e){}shutdown(){}}const ja="ConnectivityMonitor";class Ma{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){k(ja,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){k(ja,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let fr=null;function ni(){return fr===null?fr=(function(){return 268435456+Math.round(2147483648*Math.random())})():fr++,"0x"+fr.toString(16)}const Ds="RestConnection",rp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class sp{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===Ar?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,o){const a=ni(),u=this.Qo(e,t.toUriEncodedString());k(Ds,`Sending RPC '${e}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,s,o);const{host:d}=new URL(u),g=ci(d);return this.zo(e,u,h,r,g).then((v=>(k(Ds,`Received RPC '${e}' ${a}: `,v),v)),(v=>{throw St(Ds,`RPC '${e}' ${a} failed with error: `,v,"url: ",u,"request:",r),v}))}jo(e,t,r,s,o,a){return this.Wo(e,t,r,s,o)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Yt})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}Qo(e,t){const r=rp[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class ip{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Ee="WebChannelConnection",En=(n,e,t)=>{n.listen(e,(r=>{try{t(r)}catch(s){setTimeout((()=>{throw s}),0)}}))};class zt extends sp{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!zt.c_){const e=Ec();En(e,yc.STAT_EVENT,(t=>{t.stat===$s.PROXY?k(Ee,"STAT_EVENT: detected buffering proxy"):t.stat===$s.NOPROXY&&k(Ee,"STAT_EVENT: detected no buffering proxy")})),zt.c_=!0}}zo(e,t,r,s,o){const a=ni();return new Promise(((u,h)=>{const d=new gc;d.setWithCredentials(!0),d.listenOnce(_c.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case pr.NO_ERROR:const v=d.getResponseJson();k(Ee,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(v)),u(v);break;case pr.TIMEOUT:k(Ee,`RPC '${e}' ${a} timed out`),h(new O(C.DEADLINE_EXCEEDED,"Request time out"));break;case pr.HTTP_ERROR:const T=d.getStatus();if(k(Ee,`RPC '${e}' ${a} failed with status:`,T,"response text:",d.getResponseText()),T>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);const D=S?.error;if(D&&D.status&&D.message){const P=(function(M){const B=M.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(B)>=0?B:C.UNKNOWN})(D.status);h(new O(P,D.message))}else h(new O(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new O(C.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{k(Ee,`RPC '${e}' ${a} completed.`)}}));const g=JSON.stringify(s);k(Ee,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",g,r,15)}))}T_(e,t,r){const s=ni(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const d=o.join("");k(Ee,`Creating RPC '${e}' stream ${s}: ${d}`,u);const g=a.createWebChannel(d,u);this.I_(g);let v=!1,T=!1;const S=new ip({Ho:D=>{T?k(Ee,`Not sending because RPC '${e}' stream ${s} is closed:`,D):(v||(k(Ee,`Opening RPC '${e}' stream ${s} transport.`),g.open(),v=!0),k(Ee,`RPC '${e}' stream ${s} sending:`,D),g.send(D))},Jo:()=>g.close()});return En(g,In.EventType.OPEN,(()=>{T||(k(Ee,`RPC '${e}' stream ${s} transport opened.`),S.i_())})),En(g,In.EventType.CLOSE,(()=>{T||(T=!0,k(Ee,`RPC '${e}' stream ${s} transport closed`),S.o_(),this.E_(g))})),En(g,In.EventType.ERROR,(D=>{T||(T=!0,St(Ee,`RPC '${e}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),S.o_(new O(C.UNAVAILABLE,"The operation could not be completed")))})),En(g,In.EventType.MESSAGE,(D=>{if(!T){const P=D.data[0];Q(!!P,16349);const V=P,M=V?.error||V[0]?.error;if(M){k(Ee,`RPC '${e}' stream ${s} received error:`,M);const B=M.status;let q=(function(se){const I=ie[se];if(I!==void 0)return Zc(I)})(B),W=M.message;B==="NOT_FOUND"&&W.includes("database")&&W.includes("does not exist")&&W.includes(this.databaseId.database)&&St(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),q===void 0&&(q=C.INTERNAL,W="Unknown error status: "+B+" with message "+M.message),T=!0,S.o_(new O(q,W)),g.close()}else k(Ee,`RPC '${e}' stream ${s} received:`,P),S.__(P)}})),zt.u_(),setTimeout((()=>{S.s_()}),0),S}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return vc()}}function op(n){return new zt(n)}function ks(){return typeof document<"u"?document:null}function Kr(n){return new um(n,!0)}zt.c_=!1;class ml{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const La="PersistentStream";class pl{constructor(e,t,r,s,o,a,u,h){this.Ci=e,this.b_=r,this.S_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ml(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(He(t.toString()),He("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new O(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return k(La,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(k(La,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ap extends pl{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=fm(this.serializer,e),r=(function(o){if(!("targetChange"in o))return F.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?F.min():a.readTime?Fe(a.readTime):F.min()})(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=ei(this.serializer),t.addTarget=(function(o,a){let u;const h=a.target;if(u=Qs(h)?{documents:gm(o,h)}:{query:_m(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=nl(o,a.resumeToken);const d=Ys(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(F.min())>0){u.readTime=Nr(o,a.snapshotVersion.toTimestamp());const d=Ys(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);const r=Em(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=ei(this.serializer),t.removeTarget=e,this.K_(t)}}class cp extends pl{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=pm(e.writeResults,e.commitTime),r=Fe(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=ei(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>mm(this.serializer,r)))};this.K_(t)}}class lp{}class up extends lp{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new O(C.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Wo(e,Xs(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(C.UNKNOWN,o.toString())}))}jo(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.jo(e,Xs(t,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(C.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function hp(n,e,t,r){return new up(n,e,t,r)}class dp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(He(t),this.aa=!1):k("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Rt="RemoteStore";class fp{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo((a=>{r.enqueueAndForget((async()=>{Pt(this)&&(k(Rt,"Restarting streams for network reachability change."),await(async function(h){const d=U(h);d.Ea.add(4),await Gn(d),d.Va.set("Unknown"),d.Ea.delete(4),await Wr(d)})(this))}))})),this.Va=new dp(r,s)}}async function Wr(n){if(Pt(n))for(const e of n.Ra)await e(!0)}async function Gn(n){for(const e of n.Ra)await e(!1)}function gl(n,e){const t=U(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Pi(t)?Ci(t):en(t).O_()&&Ri(t,e))}function Si(n,e){const t=U(n),r=en(t);t.Ia.delete(e),r.O_()&&_l(t,e),t.Ia.size===0&&(r.O_()?r.L_():Pt(t)&&t.Va.set("Unknown"))}function Ri(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(F.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}en(n).Z_(e)}function _l(n,e){n.da.$e(e),en(n).X_(e)}function Ci(n){n.da=new om({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),en(n).start(),n.Va.ua()}function Pi(n){return Pt(n)&&!en(n).x_()&&n.Ia.size>0}function Pt(n){return U(n).Ea.size===0}function yl(n){n.da=void 0}async function mp(n){n.Va.set("Online")}async function pp(n){n.Ia.forEach(((e,t)=>{Ri(n,e)}))}async function gp(n,e){yl(n),Pi(n)?(n.Va.ha(e),Ci(n)):n.Va.set("Unknown")}async function _p(n,e,t){if(n.Va.set("Online"),e instanceof tl&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.da.removeTarget(u))})(n,e)}catch(r){k(Rt,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await kr(n,r)}else if(e instanceof Er?n.da.Xe(e):e instanceof el?n.da.st(e):n.da.tt(e),!t.isEqual(F.min()))try{const r=await fl(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const u=o.da.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const g=o.Ia.get(d);g&&o.Ia.set(d,g.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const g=o.Ia.get(h);if(!g)return;o.Ia.set(h,g.withResumeToken(_e.EMPTY_BYTE_STRING,g.snapshotVersion)),_l(o,h);const v=new rt(g.target,h,d,g.sequenceNumber);Ri(o,v)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){k(Rt,"Failed to raise snapshot:",r),await kr(n,r)}}async function kr(n,e,t){if(!Zt(e))throw e;n.Ea.add(1),await Gn(n),n.Va.set("Offline"),t||(t=()=>fl(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{k(Rt,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Wr(n)}))}function El(n,e){return e().catch((t=>kr(n,t,e)))}async function Qr(n){const e=U(n),t=dt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:fi;for(;yp(e);)try{const s=await Xm(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Ep(e,s)}catch(s){await kr(e,s)}vl(e)&&bl(e)}function yp(n){return Pt(n)&&n.Ta.length<10}function Ep(n,e){n.Ta.push(e);const t=dt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function vl(n){return Pt(n)&&!dt(n).x_()&&n.Ta.length>0}function bl(n){dt(n).start()}async function vp(n){dt(n).ra()}async function bp(n){const e=dt(n);for(const t of n.Ta)e.ea(t.mutations)}async function Tp(n,e,t){const r=n.Ta.shift(),s=vi.from(r,e,t);await El(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Qr(n)}async function Ip(n,e){e&&dt(n).Y_&&await(async function(r,s){if((function(a){return rm(a)&&a!==C.ABORTED})(s.code)){const o=r.Ta.shift();dt(r).B_(),await El(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await Qr(r)}})(n,e),vl(n)&&bl(n)}async function Fa(n,e){const t=U(n);t.asyncQueue.verifyOperationInProgress(),k(Rt,"RemoteStore received new credentials");const r=Pt(t);t.Ea.add(3),await Gn(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Wr(t)}async function wp(n,e){const t=U(n);e?(t.Ea.delete(2),await Wr(t)):e||(t.Ea.add(2),await Gn(t),t.Va.set("Unknown"))}function en(n){return n.ma||(n.ma=(function(t,r,s){const o=U(t);return o.sa(),new ap(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Zo:mp.bind(null,n),Yo:pp.bind(null,n),t_:gp.bind(null,n),J_:_p.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),Pi(n)?Ci(n):n.Va.set("Unknown")):(await n.ma.stop(),yl(n))}))),n.ma}function dt(n){return n.fa||(n.fa=(function(t,r,s){const o=U(t);return o.sa(),new cp(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:vp.bind(null,n),t_:Ip.bind(null,n),ta:bp.bind(null,n),na:Tp.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await Qr(n)):(await n.fa.stop(),n.Ta.length>0&&(k(Rt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Vi{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new qe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,u=new Vi(e,t,a,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ni(n,e){if(He("AsyncQueue",`${e}: ${n}`),Zt(n))return new O(C.UNAVAILABLE,`${e}: ${n}`);throw n}class qt{static emptySet(e){return new qt(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||j.comparator(t.key,r.key):(t,r)=>j.comparator(t.key,r.key),this.keyedMap=wn(),this.sortedSet=new te(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof qt)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new qt;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Ua{constructor(){this.ga=new te(j.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):L(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Qt{constructor(e,t,r,s,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new Qt(e,t,qt.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Br(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class xp{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class Ap{constructor(){this.queries=Ba(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=U(t),o=s.queries;s.queries=Ba(),o.forEach(((a,u)=>{for(const h of u.ba)h.onError(r)}))})(this,new O(C.ABORTED,"Firestore shutting down"))}}function Ba(){return new Ct((n=>Bc(n)),Br)}async function Tl(n,e){const t=U(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.Sa()&&e.Da()&&(r=2):(o=new xp,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const u=Ni(a,`Initialization of query '${Mt(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Di(t)}async function Il(n,e){const t=U(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?s=e.Da()?0:1:!o.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Sp(n,e){const t=U(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const u of a.ba)u.Fa(s)&&(r=!0);a.wa=s}}r&&Di(t)}function Rp(n,e,t){const r=U(n),s=r.queries.get(e);if(s)for(const o of s.ba)o.onError(t);r.queries.delete(e)}function Di(n){n.Ca.forEach((e=>{e.next()}))}var ri,za;(za=ri||(ri={})).Ma="default",za.Cache="cache";class wl{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Qt(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Qt.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ri.Cache}}class xl{constructor(e){this.key=e}}class Al{constructor(e){this.key=e}}class Cp{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=G(),this.mutatedKeys=G(),this.eu=zc(e),this.tu=new qt(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new Ua,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((g,v)=>{const T=s.get(g),S=zr(this.query,v)?v:null,D=!!T&&this.mutatedKeys.has(T.key),P=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let V=!1;T&&S?T.data.isEqual(S.data)?D!==P&&(r.track({type:3,doc:S}),V=!0):this.su(T,S)||(r.track({type:2,doc:S}),V=!0,(h&&this.eu(S,h)>0||d&&this.eu(S,d)<0)&&(u=!0)):!T&&S?(r.track({type:0,doc:S}),V=!0):T&&!S&&(r.track({type:1,doc:T}),V=!0,(h||d)&&(u=!0)),V&&(S?(a=a.add(S),o=P?o.add(g):o.delete(g)):(a=a.delete(g),o=o.delete(g)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const g=this.query.limitType==="F"?a.last():a.first();a=a.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{tu:a,iu:r,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((g,v)=>(function(S,D){const P=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Vt:V})}};return P(S)-P(D)})(g.type,v.type)||this.eu(g.doc,v.doc))),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Ya.size===0&&this.current&&!s?1:0,d=h!==this.Xa;return this.Xa=h,a.length!==0||d?{snapshot:new Qt(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ua,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=G(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))}));const t=[];return e.forEach((r=>{this.Ya.has(r)||t.push(new Al(r))})),this.Ya.forEach((r=>{e.has(r)||t.push(new xl(r))})),t}cu(e){this.Za=e.ks,this.Ya=G();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Qt.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ki="SyncEngine";class Pp{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Vp{constructor(e){this.key=e,this.hu=!1}}class Np{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Ct((u=>Bc(u)),Br),this.Iu=new Map,this.Eu=new Set,this.Ru=new te(j.comparator),this.Au=new Map,this.Vu=new Ii,this.du={},this.mu=new Map,this.fu=Wt.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Dp(n,e,t=!0){const r=Nl(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Sl(r,e,t,!0),s}async function kp(n,e){const t=Nl(n);await Sl(t,e,!0,!1)}async function Sl(n,e,t,r){const s=await Zm(n.localStore,Le(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await Op(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&gl(n.remoteStore,s),u}async function Op(n,e,t,r,s){n.pu=(v,T,S)=>(async function(P,V,M,B){let q=V.view.ru(M);q.Ss&&(q=await ka(P.localStore,V.query,!1).then((({documents:I})=>V.view.ru(I,q))));const W=B&&B.targetChanges.get(V.targetId),J=B&&B.targetMismatches.get(V.targetId)!=null,se=V.view.applyChanges(q,P.isPrimaryClient,W,J);return $a(P,V.targetId,se.au),se.snapshot})(n,v,T,S);const o=await ka(n.localStore,e,!0),a=new Cp(e,o.ks),u=a.ru(o.documents),h=$n.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);$a(n,t,d.au);const g=new Pp(e,t,a);return n.Tu.set(e,g),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function jp(n,e,t){const r=U(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!Br(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ti(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Si(r.remoteStore,s.targetId),si(r,s.targetId)})).catch(Xt)):(si(r,s.targetId),await ti(r.localStore,s.targetId,!0))}async function Mp(n,e){const t=U(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Si(t.remoteStore,r.targetId))}async function Lp(n,e,t){const r=Gp(n);try{const s=await(function(a,u){const h=U(a),d=ee.now(),g=u.reduce(((S,D)=>S.add(D.key)),G());let v,T;return h.persistence.runTransaction("Locally write mutations","readwrite",(S=>{let D=We(),P=G();return h.xs.getEntries(S,g).next((V=>{D=V,D.forEach(((M,B)=>{B.isValidDocument()||(P=P.add(M))}))})).next((()=>h.localDocuments.getOverlayedDocuments(S,D))).next((V=>{v=V;const M=[];for(const B of u){const q=Xf(B,v.get(B.key).overlayedDocument);q!=null&&M.push(new pt(B.key,q,kc(q.value.mapValue),Re.exists(!0)))}return h.mutationQueue.addMutationBatch(S,d,M,u)})).next((V=>{T=V;const M=V.applyToLocalDocumentSet(v,P);return h.documentOverlayCache.saveOverlays(S,V.batchId,M)}))})).then((()=>({batchId:T.batchId,changes:$c(v)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.du[a.currentUser.toKey()];d||(d=new te($)),d=d.insert(u,h),a.du[a.currentUser.toKey()]=d})(r,s.batchId,t),await Hn(r,s.changes),await Qr(r.remoteStore)}catch(s){const o=Ni(s,"Failed to persist write");t.reject(o)}}async function Rl(n,e){const t=U(n);try{const r=await Jm(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await Hn(t,r,e)}catch(r){await Xt(r)}}function qa(n,e,t){const r=U(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=U(a);h.onlineState=u;let d=!1;h.queries.forEach(((g,v)=>{for(const T of v.ba)T.va(u)&&(d=!0)})),d&&Di(h)})(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Fp(n,e,t){const r=U(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new te(j.comparator);a=a.insert(o,be.newNoDocument(o,F.min()));const u=G().add(o),h=new Hr(F.min(),new Map,new te($),a,u);await Rl(r,h),r.Ru=r.Ru.remove(o),r.Au.delete(e),Oi(r)}else await ti(r.localStore,e,!1).then((()=>si(r,e,t))).catch(Xt)}async function Up(n,e){const t=U(n),r=e.batch.batchId;try{const s=await Qm(t.localStore,e);Pl(t,r,null),Cl(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Hn(t,s)}catch(s){await Xt(s)}}async function Bp(n,e,t){const r=U(n);try{const s=await(function(a,u){const h=U(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let g;return h.mutationQueue.lookupMutationBatch(d,u).next((v=>(Q(v!==null,37113),g=v.keys(),h.mutationQueue.removeMutationBatch(d,v)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,g,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,g))).next((()=>h.localDocuments.getDocuments(d,g)))}))})(r.localStore,e);Pl(r,e,t),Cl(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Hn(r,s)}catch(s){await Xt(s)}}function Cl(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Pl(n,e,t){const r=U(n);let s=r.du[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function si(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((r=>{n.Vu.containsKey(r)||Vl(n,r)}))}function Vl(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Si(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),Oi(n))}function $a(n,e,t){for(const r of t)r instanceof xl?(n.Vu.addReference(r.key,e),zp(n,r)):r instanceof Al?(k(ki,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Vl(n,r.key)):L(19791,{wu:r})}function zp(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(k(ki,"New document in limbo: "+t),n.Eu.add(r),Oi(n))}function Oi(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new j(Z.fromString(e)),r=n.fu.next();n.Au.set(r,new Vp(t)),n.Ru=n.Ru.insert(t,r),gl(n.remoteStore,new rt(Le(yi(t.path)),r,"TargetPurposeLimboResolution",Mr.ce))}}async function Hn(n,e,t){const r=U(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const g=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,g?"current":"not-current")}if(d){s.push(d);const g=xi.Es(h.targetId,d);o.push(g)}})))})),await Promise.all(a),r.Pu.J_(s),await(async function(h,d){const g=U(h);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",(v=>R.forEach(d,(T=>R.forEach(T.Ts,(S=>g.persistence.referenceDelegate.addReference(v,T.targetId,S))).next((()=>R.forEach(T.Is,(S=>g.persistence.referenceDelegate.removeReference(v,T.targetId,S)))))))))}catch(v){if(!Zt(v))throw v;k(Ai,"Failed to update sequence numbers: "+v)}for(const v of d){const T=v.targetId;if(!v.fromCache){const S=g.vs.get(T),D=S.snapshotVersion,P=S.withLastLimboFreeSnapshotVersion(D);g.vs=g.vs.insert(T,P)}}})(r.localStore,o))}async function qp(n,e){const t=U(n);if(!t.currentUser.isEqual(e)){k(ki,"User change. New user:",e.toKey());const r=await dl(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new O(C.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Hn(t,r.Ns)}}function $p(n,e){const t=U(n),r=t.Au.get(e);if(r&&r.hu)return G().add(r.key);{let s=G();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function Nl(n){const e=U(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Rl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=$p.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Fp.bind(null,e),e.Pu.J_=Sp.bind(null,e.eventManager),e.Pu.yu=Rp.bind(null,e.eventManager),e}function Gp(n){const e=U(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Up.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Bp.bind(null,e),e}class Or{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Kr(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Wm(this.persistence,new Gm,e.initialUser,this.serializer)}Cu(e){return new hl(wi.Vi,this.serializer)}Du(e){return new tp}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Or.provider={build:()=>new Or};class Hp extends Or{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Q(this.persistence.referenceDelegate instanceof Dr,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Pm(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?we.withCacheSize(this.cacheSizeBytes):we.DEFAULT;return new hl((r=>Dr.Vi(r,t)),this.serializer)}}class ii{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>qa(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=qp.bind(null,this.syncEngine),await wp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Ap})()}createDatastore(e){const t=Kr(e.databaseInfo.databaseId),r=op(e.databaseInfo);return hp(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,u){return new fp(r,s,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>qa(this.syncEngine,t,0)),(function(){return Ma.v()?new Ma:new np})())}createSyncEngine(e,t){return(function(s,o,a,u,h,d,g){const v=new Np(s,o,a,u,h,d);return g&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=U(t);k(Rt,"RemoteStore shutting down."),r.Ea.add(5),await Gn(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ii.provider={build:()=>new ii};class Dl{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):He("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const ft="FirestoreClient";class Kp{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=ve.UNAUTHENTICATED,this.clientId=hi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{k(ft,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(k(ft,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ni(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Os(n,e){n.asyncQueue.verifyOperationInProgress(),k(ft,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await dl(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Ga(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Wp(n);k(ft,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Fa(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Fa(e.remoteStore,s))),n._onlineComponents=e}async function Wp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k(ft,"Using user provided OfflineComponentProvider");try{await Os(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===C.FAILED_PRECONDITION||s.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;St("Error using user provided cache. Falling back to memory cache: "+t),await Os(n,new Or)}}else k(ft,"Using default OfflineComponentProvider"),await Os(n,new Hp(void 0));return n._offlineComponents}async function kl(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(k(ft,"Using user provided OnlineComponentProvider"),await Ga(n,n._uninitializedComponentsProvider._online)):(k(ft,"Using default OnlineComponentProvider"),await Ga(n,new ii))),n._onlineComponents}function Qp(n){return kl(n).then((e=>e.syncEngine))}async function Ol(n){const e=await kl(n),t=e.eventManager;return t.onListen=Dp.bind(null,e.syncEngine),t.onUnlisten=jp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=kp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Mp.bind(null,e.syncEngine),t}function Jp(n,e,t={}){const r=new qe;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const g=new Dl({next:T=>{g.Nu(),a.enqueueAndForget((()=>Il(o,v)));const S=T.docs.has(u);!S&&T.fromCache?d.reject(new O(C.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&T.fromCache&&h&&h.source==="server"?d.reject(new O(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(T)},error:T=>d.reject(T)}),v=new wl(yi(u.path),g,{includeMetadataChanges:!0,Ka:!0});return Tl(o,v)})(await Ol(n),n.asyncQueue,e,t,r))),r.promise}function Yp(n,e,t={}){const r=new qe;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const g=new Dl({next:T=>{g.Nu(),a.enqueueAndForget((()=>Il(o,v))),T.fromCache&&h.source==="server"?d.reject(new O(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(T)},error:T=>d.reject(T)}),v=new wl(u,g,{includeMetadataChanges:!0,Ka:!0});return Tl(o,v)})(await Ol(n),n.asyncQueue,e,t,r))),r.promise}function Xp(n,e){const t=new qe;return n.asyncQueue.enqueueAndForget((async()=>Lp(await Qp(n),e,t))),t.promise}function jl(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Zp="ComponentProvider",Ha=new Map;function eg(n,e,t,r,s){return new vf(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,jl(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}const Ml="firestore.googleapis.com",Ka=!0;class Wa{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new O(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ml,this.ssl=Ka}else this.host=e.host,this.ssl=e.ssl??Ka;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ul;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Rm)throw new O(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jl(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Jr{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wa({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wa(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Xd;switch(r.type){case"firstParty":return new nf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Ha.get(t);r&&(k(Zp,"Removing Datastore"),Ha.delete(t),r.terminate())})(this),Promise.resolve()}}function tg(n,e,t,r={}){n=Ke(n,Jr);const s=ci(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(wh(`https://${u}`),Rh("Firestore",!0)),o.host!==Ml&&o.host!==u&&St("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Tr(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,g;if(typeof r.mockUserToken=="string")d=r.mockUserToken,g=ve.MOCK_USER;else{d=xh(r.mockUserToken,n._app?.options.projectId);const v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new O(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new ve(v)}n._authCredentials=new Zd(new Tc(d,g))}}class Yr{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Yr(this.firestore,e,this._query)}}class le{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new at(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new le(this.firestore,e,this._key)}toJSON(){return{type:le._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(zn(t,le._jsonSchema))return new le(e,r||null,new j(Z.fromString(t.referencePath)))}}le._jsonSchemaVersion="firestore/documentReference/1.0",le._jsonSchema={type:oe("string",le._jsonSchemaVersion),referencePath:oe("string")};class at extends Yr{constructor(e,t,r){super(e,t,yi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new j(e))}withConverter(e){return new at(this.firestore,e,this._path)}}function Ll(n,e,...t){if(n=$e(n),Ic("collection","path",e),n instanceof Jr){const r=Z.fromString(e,...t);return ca(r),new at(n,null,r)}{if(!(n instanceof le||n instanceof at))throw new O(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(e,...t));return ca(r),new at(n.firestore,null,r)}}function Ce(n,e,...t){if(n=$e(n),arguments.length===1&&(e=hi.newId()),Ic("doc","path",e),n instanceof Jr){const r=Z.fromString(e,...t);return aa(r),new le(n,null,new j(r))}{if(!(n instanceof le||n instanceof at))throw new O(C.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(e,...t));return aa(r),new le(n.firestore,n instanceof at?n.converter:null,new j(r))}}const Qa="AsyncQueue";class Ja{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ml(this,"async_queue_retry"),this._c=()=>{const r=ks();r&&k(Qa,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=ks();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ks();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new qe;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Zt(e))throw e;k(Qa,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,He("INTERNAL UNHANDLED ERROR: ",Ya(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Vi.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&L(47125,{Pc:Ya(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ya(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class tn extends Jr{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Ja,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ja(e),this._firestoreClient=void 0,await e}}}function ng(n,e){const t=typeof n=="object"?n:Ld(),r=typeof n=="string"?n:Ar,s=Dd(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Th("firestore");o&&tg(s,...o)}return s}function Xr(n){if(n._terminated)throw new O(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||rg(n),n._firestoreClient}function rg(n){const e=n._freezeSettings(),t=eg(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Kp(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class Pe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Pe(_e.fromBase64String(e))}catch(t){throw new O(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Pe(_e.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Pe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(zn(e,Pe._jsonSchema))return Pe.fromBase64String(e.bytes)}}Pe._jsonSchemaVersion="firestore/bytes/1.0",Pe._jsonSchema={type:oe("string",Pe._jsonSchemaVersion),bytes:oe("string")};class ji{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ge(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Mi{constructor(e){this._methodName=e}}class Ue{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ue._jsonSchemaVersion}}static fromJSON(e){if(zn(e,Ue._jsonSchema))return new Ue(e.latitude,e.longitude)}}Ue._jsonSchemaVersion="firestore/geoPoint/1.0",Ue._jsonSchema={type:oe("string",Ue._jsonSchemaVersion),latitude:oe("number"),longitude:oe("number")};class Ne{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ne._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(zn(e,Ne._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ne(e.vectorValues);throw new O(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ne._jsonSchemaVersion="firestore/vectorValue/1.0",Ne._jsonSchema={type:oe("string",Ne._jsonSchemaVersion),vectorValues:oe("object")};const sg=/^__.*__$/;class ig{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new pt(e,this.data,this.fieldMask,t,this.fieldTransforms):new qn(e,this.data,t,this.fieldTransforms)}}class Fl{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new pt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ul(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{dataSource:n})}}class Li{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new Li({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return jr(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Ul(this.dataSource)&&sg.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class og{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Kr(e)}createContext(e,t,r,s=!1){return new Li({dataSource:e,methodName:t,targetDoc:r,path:ge.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bl(n){const e=n._freezeSettings(),t=Kr(n._databaseId);return new og(n._databaseId,!!e.ignoreUndefinedProperties,t)}function zl(n,e,t,r,s,o={}){const a=n.createContext(o.merge||o.mergeFields?2:0,e,t,s);Fi("Data must be an object, but it was:",a,r);const u=ql(r,a);let h,d;if(o.merge)h=new Se(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const g=[];for(const v of o.mergeFields){const T=Bn(e,v,t);if(!a.contains(T))throw new O(C.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);Hl(g,T)||g.push(T)}h=new Se(g),d=a.fieldTransforms.filter((v=>h.covers(v.field)))}else h=null,d=a.fieldTransforms;return new ig(new xe(u),h,d)}class Zr extends Mi{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Zr}}function ag(n,e,t,r){const s=n.createContext(1,e,t);Fi("Data must be an object, but it was:",s,r);const o=[],a=xe.empty();mt(r,((h,d)=>{const g=Gl(e,h,t);d=$e(d);const v=s.childContextForFieldPath(g);if(d instanceof Zr)o.push(g);else{const T=es(d,v);T!=null&&(o.push(g),a.set(g,T))}}));const u=new Se(o);return new Fl(a,u,s.fieldTransforms)}function cg(n,e,t,r,s,o){const a=n.createContext(1,e,t),u=[Bn(e,r,t)],h=[s];if(o.length%2!=0)throw new O(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<o.length;T+=2)u.push(Bn(e,o[T])),h.push(o[T+1]);const d=[],g=xe.empty();for(let T=u.length-1;T>=0;--T)if(!Hl(d,u[T])){const S=u[T];let D=h[T];D=$e(D);const P=a.childContextForFieldPath(S);if(D instanceof Zr)d.push(S);else{const V=es(D,P);V!=null&&(d.push(S),g.set(S,V))}}const v=new Se(d);return new Fl(g,v,a.fieldTransforms)}function es(n,e){if($l(n=$e(n)))return Fi("Unsupported field value:",e,n),ql(n,e);if(n instanceof Mi)return(function(r,s){if(!Ul(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=es(u,s.childContextForArray(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=$e(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Hf(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=ee.fromDate(r);return{timestampValue:Nr(s.serializer,o)}}if(r instanceof ee){const o=new ee(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Nr(s.serializer,o)}}if(r instanceof Ue)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Pe)return{bytesValue:nl(s.serializer,r._byteString)};if(r instanceof le){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ti(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ne)return(function(a,u){const h=a instanceof Ne?a.toArray():a;return{mapValue:{fields:{[Nc]:{stringValue:Dc},[Sr]:{arrayValue:{values:h.map((g=>{if(typeof g!="number")throw u.createError("VectorValues must only contain numeric values.");return Ei(u.serializer,g)}))}}}}}})(r,s);if(ll(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${di(r)}`)})(n,e)}function ql(n,e){const t={};return Ac(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):mt(n,((r,s)=>{const o=es(s,e.childContextForField(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function $l(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ee||n instanceof Ue||n instanceof Pe||n instanceof le||n instanceof Mi||n instanceof Ne||ll(n))}function Fi(n,e,t){if(!$l(t)||!wc(t)){const r=di(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Bn(n,e,t){if((e=$e(e))instanceof ji)return e._internalPath;if(typeof e=="string")return Gl(n,e);throw jr("Field path arguments must be of type string or ",n,!1,void 0,t)}const lg=new RegExp("[~\\*/\\[\\]]");function Gl(n,e,t){if(e.search(lg)>=0)throw jr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ji(...e.split("."))._internalPath}catch{throw jr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function jr(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new O(C.INVALID_ARGUMENT,u+n+h)}function Hl(n,e){return n.some((t=>t.isEqual(e)))}class ug{convertValue(e,t="none"){switch(ht(e)){case 0:return null;case 1:return e.booleanValue;case 2:return re(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ut(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return mt(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[Sr].arrayValue?.values?.map((r=>re(r.doubleValue)));return new Ne(t)}convertGeoPoint(e){return new Ue(re(e.latitude),re(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Fr(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(jn(e));default:return null}}convertTimestamp(e){const t=lt(e);return new ee(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Z.fromString(e);Q(cl(r),9688,{name:e});const s=new Mn(r.get(1),r.get(3)),o=new j(r.popFirst(5));return s.isEqual(t)||He(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}class Kl extends ug{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}const Xa="@firebase/firestore",Za="4.11.0";class Wl{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new hg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(Bn("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class hg extends Wl{data(){return super.data()}}function dg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Ql(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class An{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xt extends Wl{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new vr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Bn("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=xt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}xt._jsonSchemaVersion="firestore/documentSnapshot/1.0",xt._jsonSchema={type:oe("string",xt._jsonSchemaVersion),bundleSource:oe("string","DocumentSnapshot"),bundleName:oe("string"),bundle:oe("string")};class vr extends xt{data(e={}){return super.data(e)}}class $t{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new An(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new vr(this._firestore,this._userDataWriter,r.key,r,new An(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new vr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new An(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new vr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new An(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,g=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),g=a.indexOf(u.doc.key)),{type:fg(u.type),doc:h,oldIndex:d,newIndex:g}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=$t._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=hi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function fg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}$t._jsonSchemaVersion="firestore/querySnapshot/1.0",$t._jsonSchema={type:oe("string",$t._jsonSchemaVersion),bundleSource:oe("string","QuerySnapshot"),bundleName:oe("string"),bundle:oe("string")};class mg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Bl(e)}set(e,t,r){this._verifyNotCommitted();const s=js(e,this._firestore),o=Ql(s.converter,t,r),a=zl(this._dataReader,"WriteBatch.set",s._key,o,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Re.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const o=js(e,this._firestore);let a;return a=typeof(t=$e(t))=="string"||t instanceof ji?cg(this._dataReader,"WriteBatch.update",o._key,t,r,s):ag(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(a.toMutation(o._key,Re.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=js(e,this._firestore);return this._mutations=this._mutations.concat(new Gr(t._key,Re.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function js(n,e){if((n=$e(n)).firestore!==e)throw new O(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function vn(n){n=Ke(n,le);const e=Ke(n.firestore,tn),t=Xr(e);return Jp(t,n._key).then((r=>gg(e,n,r)))}function Jl(n){n=Ke(n,Yr);const e=Ke(n.firestore,tn),t=Xr(e),r=new Kl(e);return dg(n._query),Yp(t,n._query).then((s=>new $t(e,r,n,s)))}function kt(n,e,t){n=Ke(n,le);const r=Ke(n.firestore,tn),s=Ql(n.converter,e,t),o=Bl(r);return Ui(r,[zl(o,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Re.none())])}function pg(n){return Ui(Ke(n.firestore,tn),[new Gr(n._key,Re.none())])}function Ui(n,e){const t=Xr(n);return Xp(t,e)}function gg(n,e,t){const r=t.docs.get(e._key),s=new Kl(n);return new xt(n,s,e._key,r,new An(t.hasPendingWrites,t.fromCache),e.converter)}function _g(n){return n=Ke(n,tn),Xr(n),new mg(n,(e=>Ui(n,e)))}(function(e,t=!0){Yd(Md),wr(new Dn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new tn(new ef(r.getProvider("auth-internal")),new rf(a,r.getProvider("app-check-internal")),bf(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Bt(Xa,Za,e),Bt(Xa,Za,"esm2020")})();const yg=()=>({apiKey:localStorage.getItem("isp_firebase_api_key")||void 0,authDomain:localStorage.getItem("isp_firebase_auth_domain")||void 0,projectId:localStorage.getItem("isp_firebase_project_id")||void 0,storageBucket:localStorage.getItem("isp_firebase_storage_bucket")||void 0,messagingSenderId:localStorage.getItem("isp_firebase_messaging_sender_id")||void 0,appId:localStorage.getItem("isp_firebase_app_id")||void 0});let ec=null,Ms=null;const Kn=()=>{const n=yg();if(!n.apiKey||!n.projectId)return console.warn("Firebase config missing"),null;if(!Ms)try{Ms=dc(n),ec=ng(Ms),console.log("Firebase initialized")}catch(e){console.error("Error initializing Firebase",e)}return ec},Sn=n=>new Promise(e=>setTimeout(e,n)),Ls=200,Eg=async(n,e=()=>{})=>{const t=Kn();if(!t)throw new Error("Firebase no configurado");const r=new Date,s=r.toISOString().replace(/[:.]/g,"-"),o=r.toISOString(),a=n.clients||[],h=Math.max(1,Math.ceil(a.length/Ls))+4;let d=0;const g=V=>{d++,e({step:d,totalSteps:h,label:V,percent:Math.round(d/h*100)})},v={createdAt:o,versionId:s,totalClients:a.length,totalTickets:(n.tickets||[]).length,totalAverias:(n.averias||[]).length,totalEquipos:(n.equipos||[]).length,totalVisitas:(n.visitas||[]).length,totalTecnicos:(n.tecnicos||[]).length,label:`Respaldo ${r.toLocaleDateString("es-PE")} ${r.toLocaleTimeString("es-PE")}`};await kt(Ce(t,"backups_history",s),v),g("Metadata guardada");const T=[];for(let V=0;V<a.length;V+=Ls)T.push(a.slice(V,V+Ls));for(let V=0;V<T.length;V++){const M=Ce(t,"backups_history",s,"data",`clients_${V}`);await kt(M,{data:T[V]}),g(`Clientes ${V+1}/${T.length}`),V<T.length-1&&await Sn(300)}const S=["tickets","averias","tecnicos","equipos","visitas","instalaciones","derivaciones","postVenta","sesionesRemoto","movimientosEquipos","whatsappLogs","templates"],D=8e5,P={};for(const V of S){const M=n[V]||[],B=new Blob([JSON.stringify(M)]).size;if(B>D&&Array.isArray(M)&&M.length>0){const q=Math.ceil(M.length/Math.ceil(B/D)),W=[];for(let J=0;J<M.length;J+=q)W.push(M.slice(J,J+q));P[V]=W.length;for(let J=0;J<W.length;J++)await kt(Ce(t,"backups_history",s,"data",`${V}_${J}`),{data:W[J]}),J<W.length-1&&await Sn(200)}else P[V]=1,await kt(Ce(t,"backups_history",s,"data",V),{data:M});await Sn(150)}return g("Colecciones guardadas"),await Sn(300),await kt(Ce(t,"backups_history",s,"data","config"),{columnPrefs:n.columnPrefs||{},cleaningOptions:n.cleaningOptions||{},importHistory:n.importHistory||[]}),g("Configuracin guardada"),await kt(Ce(t,"backups_history",s,"data","_meta"),{clientChunks:T.length,collectionChunks:P}),g("Backup completado!"),{success:!0,versionId:s,timestamp:o}},vg=async()=>{if(!Kn())throw new Error("Firebase no configurado");const e=await Yl();if(e.length===0)throw new Error("No hay backups disponibles");return oi(e[0].id)},Yl=async()=>{const n=Kn();if(!n)throw new Error("Firebase no configurado");const e=await Jl(Ll(n,"backups_history")),t=[];return e.forEach(r=>{const s=r.data();s.createdAt&&t.push({id:r.id,...s})}),t.sort((r,s)=>new Date(s.createdAt)-new Date(r.createdAt)),t},oi=async n=>{const e=Kn();if(!e)throw new Error("Firebase no configurado");const t=await vn(Ce(e,"backups_history",n,"data","_meta")),r=t.exists()?t.data():{clientChunks:0,collectionChunks:{}};let s=[];for(let g=0;g<(r.clientChunks||0);g++){const v=await vn(Ce(e,"backups_history",n,"data",`clients_${g}`));v.exists()&&(s=[...s,...v.data().data||[]])}const o=["tickets","averias","tecnicos","equipos","visitas","instalaciones","derivaciones","postVenta","sesionesRemoto","movimientosEquipos","whatsappLogs","templates"],a={},u=r.collectionChunks||{};for(const g of o){const v=u[g]||1;let T=[];if(v>1)for(let S=0;S<v;S++){const D=await vn(Ce(e,"backups_history",n,"data",`${g}_${S}`));D.exists()&&(T=[...T,...D.data().data||[]])}else{const S=await vn(Ce(e,"backups_history",n,"data",g));S.exists()&&(T=S.data().data||[])}a[g]=T}const h=await vn(Ce(e,"backups_history",n,"data","config")),d=h.exists()?h.data():{};return{clients:s,tickets:a.tickets||[],averias:a.averias||[],tecnicos:a.tecnicos||[],equipos:a.equipos||[],visitas:a.visitas||[],instalaciones:a.instalaciones||[],derivaciones:a.derivaciones||[],postVenta:a.postVenta||[],sesionesRemoto:a.sesionesRemoto||[],movimientosEquipos:a.movimientosEquipos||[],whatsappLogs:a.whatsappLogs||[],templates:a.templates||[],columnPrefs:d.columnPrefs,cleaningOptions:d.cleaningOptions,importHistory:d.importHistory}},bg=async n=>{const e=Kn();if(!e)throw new Error("Firebase no configurado");const t=await Jl(Ll(e,"backups_history",n,"data")),r=[];t.forEach(o=>r.push(o.ref));const s=450;for(let o=0;o<r.length;o+=s){const a=_g(e);r.slice(o,o+s).forEach(u=>a.delete(u)),await a.commit(),o+s<r.length&&await Sn(200)}return await pg(Ce(e,"backups_history",n)),!0},Xl=Du((n,e)=>({isSyncing:!1,lastSync:localStorage.getItem("isp_last_sync")||null,syncError:null,syncMode:"manual",backupVersions:[],loadingVersions:!1,restoringVersion:null,syncProgress:null,setSyncMode:t=>n({syncMode:t}),syncPush:async()=>{n({isSyncing:!0,syncError:null,syncProgress:{step:0,totalSteps:1,label:"Preparando datos...",percent:0}});try{const t=de.getState(),r={clients:t.clients,tickets:t.tickets,averias:t.averias,tecnicos:t.tecnicos,equipos:t.equipos,visitas:t.visitas,instalaciones:t.instalaciones,derivaciones:t.derivaciones,postVenta:t.postVenta,sesionesRemoto:t.sesionesRemoto,movimientosEquipos:t.movimientosEquipos,whatsappLogs:t.whatsappLogs,templates:t.templates,columnPrefs:t.columnPrefs,cleaningOptions:t.cleaningOptions,importHistory:t.importHistory},o=await Eg(r,u=>n({syncProgress:u})),a=new Date().toISOString();return localStorage.setItem("isp_last_sync",a),n({lastSync:a,isSyncing:!1,syncProgress:null}),e().loadVersions(),o}catch(t){return console.error("Sync Push Error:",t),n({isSyncing:!1,syncError:t.message,syncProgress:null}),!1}},syncPull:async()=>{n({isSyncing:!0,syncError:null});try{const t=await vg();if(t){const r=de.getState().restoreSystem;r&&r(t);const s=new Date().toISOString();return localStorage.setItem("isp_last_sync",s),n({lastSync:s,isSyncing:!1}),!0}else throw new Error("No se encontraron datos de respaldo en la nube.")}catch(t){return console.error("Sync Pull Error:",t),n({isSyncing:!1,syncError:t.message}),!1}},loadVersions:async()=>{n({loadingVersions:!0});try{const t=await Yl();return n({backupVersions:t,loadingVersions:!1}),t}catch(t){return console.error("Error loading versions:",t),n({loadingVersions:!1,syncError:t.message}),[]}},restoreVersion:async t=>{n({restoringVersion:t,syncError:null});try{const r=await oi(t);if(r){const s=de.getState().restoreSystem;s&&s(r);const o=new Date().toISOString();return localStorage.setItem("isp_last_sync",o),n({restoringVersion:null,lastSync:o}),!0}throw new Error("No se encontraron datos para esa versin.")}catch(r){return console.error("Restore Version Error:",r),n({restoringVersion:null,syncError:r.message}),!1}},removeVersion:async t=>{try{return await bg(t),n(r=>({backupVersions:r.backupVersions.filter(s=>s.id!==t)})),!0}catch(r){return console.error("Delete Version Error:",r),n({syncError:r.message}),!1}},downloadVersionData:async t=>{n({restoringVersion:t});try{const r=await oi(t);return n({restoringVersion:null}),r}catch(r){return console.error("Download Version Error:",r),n({restoringVersion:null,syncError:r.message}),null}}}));function Zl(){const n=de(e=>e.addToast);return{success:(e,t=3e3)=>n({message:e,type:"success",duration:t}),error:(e,t=5e3)=>n({message:e,type:"error",duration:t}),warning:(e,t=4e3)=>n({message:e,type:"warning",duration:t}),info:(e,t=3e3)=>n({message:e,type:"info",duration:t})}}function Tg(n,e="backup"){const t=new Blob([JSON.stringify(n,null,2)],{type:"application/json"});eu(t,`${e}.json`)}function Ig(n,e="backup"){const t={};for(const[o,a]of Object.entries(n))Array.isArray(a)&&a.length>0&&(t[o]=a);let r="";for(const[o,a]of Object.entries(t)){r+=`
=== ${o.toUpperCase()} ===
`;const u=new Set;a.forEach(d=>{Object.keys(d).forEach(g=>u.add(g))});const h=[...u];r+=h.map(d=>`"${d}"`).join(",")+`
`,a.forEach(d=>{const g=h.map(v=>{const T=d[v];return T==null?"":typeof T=="object"?`"${JSON.stringify(T).replace(/"/g,'""')}"`:`"${String(T).replace(/"/g,'""')}"`});r+=g.join(",")+`
`})}const s=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"});eu(s,`${e}.csv`)}async function wg(n,e="backup"){const t=await ku(()=>import("./xlsx-CNerDvZX.js"),[]),r=t.utils.book_new();for(const[o,a]of Object.entries(n))if(Array.isArray(a)&&a.length>0){const u=a.map(g=>{const v={};for(const[T,S]of Object.entries(g))v[T]=typeof S=="object"&&S!==null?JSON.stringify(S):S;return v}),h=t.utils.json_to_sheet(u),d=o.substring(0,31);t.utils.book_append_sheet(r,h,d)}const s={};for(const[o,a]of Object.entries(n))Array.isArray(a)||(s[o]=typeof a=="object"?JSON.stringify(a):a);if(Object.keys(s).length>0){const o=Object.entries(s).map(([u,h])=>({key:u,value:h})),a=t.utils.json_to_sheet(o);t.utils.book_append_sheet(r,a,"config")}t.writeFile(r,`${e}.xlsx`)}function eu(n,e){const t=URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}function xg(){const{authorizedEmails:n,addAuthorizedEmail:e,removeAuthorizedEmail:t}=de(),[r,s]=Me.useState(""),o=()=>{if(!r)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)){alert("Por favor ingresa un correo vlido");return}e(r)?(s(""),alert(" Correo agregado exitosamente")):alert(" Este correo ya est en la lista")};return m.jsxs(zu,{className:"p-6",children:[m.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[m.jsx(nc,{className:"w-5 h-5 text-green-500"}),"Usuarios Autorizados"]}),m.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-3",children:[m.jsx($u,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),m.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:[m.jsx("p",{className:"font-medium mb-1",children:"Control de Acceso"}),m.jsx("p",{children:"Solo los correos en esta lista podrn acceder al sistema."}),m.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:"Si la lista est vaca, cualquier correo puede acceder (modo desarrollo)."})]})]}),m.jsxs("div",{className:"flex gap-2 mb-4",children:[m.jsx("input",{type:"email",value:r,onChange:a=>s(a.target.value),onKeyPress:a=>a.key==="Enter"&&o(),placeholder:"correo@ejemplo.com",className:"flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),m.jsxs(qu,{onClick:o,className:"flex items-center gap-2",children:[m.jsx(Gu,{className:"w-4 h-4"}),"Agregar"]})]}),m.jsx("div",{className:"space-y-2",children:n.length===0?m.jsxs("div",{className:"text-center py-8 text-gray-500",children:[m.jsx($o,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),m.jsx("p",{className:"text-sm font-medium",children:"No hay correos autorizados"}),m.jsx("p",{className:"text-xs mt-1",children:"(Modo desarrollo: todos pueden acceder)"})]}):n.map(a=>m.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx($o,{className:"w-4 h-4 text-gray-500"}),m.jsx("span",{className:"font-mono text-sm",children:a})]}),m.jsx("button",{onClick:()=>{confirm(`Eliminar ${a} de la lista de autorizados?`)&&t(a)},className:"text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-2 rounded transition-colors",title:"Eliminar correo",children:m.jsx(rc,{className:"w-4 h-4"})})]},a))}),n.length>0&&m.jsxs("div",{className:"mt-4 text-xs text-gray-500 text-center",children:[n.length," usuario",n.length!==1?"s":""," autorizado",n.length!==1?"s":""]})]})}function Oe({label:n,envVar:e,value:t,onChange:r,placeholder:s}){const[o,a]=Me.useState(!1);return m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-xs font-semibold",children:n}),m.jsx("p",{className:"text-[10px] text-text-muted font-mono",children:e})]}),m.jsx("button",{onClick:()=>a(!o),className:"text-[10px] text-accent-blue bg-accent-blue/10 px-2 py-0.5 rounded cursor-pointer border-none hover:bg-accent-blue/20",children:o?"Ocultar":"Mostrar"})]}),m.jsx("input",{type:o?"text":"password",value:t,onChange:u=>r(u.target.value),placeholder:s,className:"w-full py-2 px-3 bg-bg-card border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted font-mono"})]})}function Ag(){const{backupVersions:n,loadingVersions:e,loadVersions:t,restoreVersion:r,removeVersion:s,restoringVersion:o,downloadVersionData:a}=Xl(),u=Zl(),[h,d]=Me.useState(null),[g,v]=Me.useState(null);Me.useEffect(()=>{t()},[t]);const T=async P=>{if(!window.confirm("Ests seguro de restaurar esta versin? Esto reemplazar TODOS los datos actuales."))return;await r(P)?u.success("Versin restaurada correctamente"):u.error("Error al restaurar la versin")},S=async P=>{await s(P)?(u.success("Versin eliminada"),v(null)):u.error("Error al eliminar")},D=async(P,V)=>{d(P.id);try{const M=await a(P.id);if(!M){u.error("Error al descargar datos");return}const B=`backup_${P.createdAt?.split("T")[0]||"unknown"}_${P.createdAt?.split("T")[1]?.split(".")[0]?.replace(/:/g,"-")||""}`;switch(V){case"json":Tg(M,B),u.success("Descarga JSON completada");break;case"csv":Ig(M,B),u.success("Descarga CSV completada");break;case"excel":await wg(M,B),u.success("Descarga Excel completada");break}}catch(M){u.error(`Error: ${M.message}`)}finally{d(null)}};return m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsxs("div",{className:"flex items-center justify-between mb-5",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent-purple/10 flex items-center justify-center",children:m.jsx(Ku,{size:18,className:"text-accent-purple"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-bold",children:"Historial de Backups"}),m.jsx("p",{className:"text-[11px] text-text-muted",children:"Versiones guardadas en Firebase"})]})]}),m.jsxs("button",{onClick:t,disabled:e,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-bg-secondary border border-border text-xs font-medium hover:bg-bg-card-hover cursor-pointer transition-colors disabled:opacity-50",children:[m.jsx(Uu,{size:12,className:e?"animate-spin":""}),"Actualizar"]})]}),e&&n.length===0?m.jsxs("div",{className:"flex items-center justify-center py-12",children:[m.jsx(As,{size:24,className:"animate-spin text-text-muted"}),m.jsx("span",{className:"ml-3 text-sm text-text-muted",children:"Cargando versiones..."})]}):n.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[m.jsx("div",{className:"w-14 h-14 rounded-2xl bg-bg-secondary border border-border flex items-center justify-center mb-3",children:m.jsx(mr,{size:24,className:"text-text-muted"})}),m.jsx("p",{className:"text-sm font-medium text-text-secondary",children:"No hay backups guardados"}),m.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Sube tu primer respaldo para empezar"})]}):m.jsx("div",{className:"flex flex-col gap-3 max-h-[500px] overflow-y-auto pr-1",children:n.map((P,V)=>{const M=new Date(P.createdAt),B=V===0,q=g===P.id,W=o===P.id,J=h===P.id;return m.jsxs("div",{className:`relative p-4 rounded-xl border transition-all ${B?"bg-accent-blue/5 border-accent-blue/30":"bg-bg-secondary border-border hover:border-accent-blue/20"}`,children:[m.jsx("div",{className:"flex items-start justify-between mb-3",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Wu,{size:14,className:"text-text-muted"}),m.jsx("div",{children:m.jsxs("p",{className:"text-sm font-semibold",children:[M.toLocaleDateString("es-PE",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),m.jsx("span",{className:"ml-2 text-text-muted font-mono text-xs",children:M.toLocaleTimeString("es-PE")})]})}),B&&m.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold bg-accent-blue/10 text-accent-blue",children:"LTIMO"})]})}),m.jsxs("div",{className:"flex flex-wrap gap-3 mb-3",children:[m.jsx(Ot,{label:"Clientes",value:P.totalClients}),m.jsx(Ot,{label:"Tickets",value:P.totalTickets}),m.jsx(Ot,{label:"Averas",value:P.totalAverias}),m.jsx(Ot,{label:"Equipos",value:P.totalEquipos}),m.jsx(Ot,{label:"Visitas",value:P.totalVisitas}),m.jsx(Ot,{label:"Tcnicos",value:P.totalTecnicos})]}),m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsxs("button",{onClick:()=>T(P.id),disabled:W,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-accent-purple/10 text-accent-purple text-[11px] font-bold hover:bg-accent-purple/20 disabled:opacity-50 transition-colors cursor-pointer border-none",children:[W?m.jsx(As,{size:12,className:"animate-spin"}):m.jsx(sc,{size:12}),"Restaurar"]}),m.jsxs("div",{className:"flex items-center gap-1 ml-1",children:[m.jsx("span",{className:"text-[10px] text-text-muted mr-1",children:"Descargar:"}),m.jsxs("button",{onClick:()=>D(P,"json"),disabled:J,title:"Descargar JSON",className:"flex items-center gap-1 px-2 py-1.5 rounded-lg bg-emerald-500/10 text-emerald-500 text-[11px] font-bold hover:bg-emerald-500/20 disabled:opacity-50 transition-colors cursor-pointer border-none",children:[m.jsx(Yu,{size:12})," JSON"]}),m.jsxs("button",{onClick:()=>D(P,"csv"),disabled:J,title:"Descargar CSV",className:"flex items-center gap-1 px-2 py-1.5 rounded-lg bg-blue-500/10 text-blue-500 text-[11px] font-bold hover:bg-blue-500/20 disabled:opacity-50 transition-colors cursor-pointer border-none",children:[m.jsx(Bu,{size:12})," CSV"]}),m.jsxs("button",{onClick:()=>D(P,"excel"),disabled:J,title:"Descargar Excel",className:"flex items-center gap-1 px-2 py-1.5 rounded-lg bg-orange-500/10 text-orange-500 text-[11px] font-bold hover:bg-orange-500/20 disabled:opacity-50 transition-colors cursor-pointer border-none",children:[m.jsx(Hu,{size:12})," Excel"]})]}),q?m.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[m.jsx("span",{className:"text-[11px] text-red-400",children:"Eliminar?"}),m.jsx("button",{onClick:()=>S(P.id),className:"px-2 py-1 rounded-lg bg-red-500/20 text-red-500 text-[11px] font-bold hover:bg-red-500/30 cursor-pointer border-none",children:"S"}),m.jsx("button",{onClick:()=>v(null),className:"px-2 py-1 rounded-lg bg-bg-card text-text-muted text-[11px] font-medium hover:bg-bg-card-hover cursor-pointer border-none",children:"No"})]}):m.jsx("button",{onClick:()=>v(P.id),className:"ml-auto p-1.5 rounded-lg text-text-muted hover:text-red-500 hover:bg-red-500/10 cursor-pointer border-none bg-transparent transition-colors",title:"Eliminar versin",children:m.jsx(rc,{size:14})})]}),J&&m.jsxs("div",{className:"absolute inset-0 bg-bg-card/80 rounded-xl flex items-center justify-center backdrop-blur-sm",children:[m.jsx(As,{size:20,className:"animate-spin text-accent-blue mr-2"}),m.jsx("span",{className:"text-sm text-text-secondary",children:"Descargando..."})]})]},P.id)})})]})}function Ot({label:n,value:e}){return m.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-bg-card border border-border",children:[m.jsxs("span",{className:"text-[10px] text-text-muted",children:[n,":"]}),m.jsx("span",{className:"text-[11px] font-bold text-text-primary",children:e??0})]})}function Bg(){const{user:n}=Ou(),e=de(y=>y.clients),t=de(y=>y.dataSource),r=de(y=>y.tickets),s=de(y=>y.averias),o=de(y=>y.equipos),a=de(y=>y.theme),{syncPush:u,syncPull:h,isSyncing:d,lastSync:g,syncProgress:v}=Xl(),T=Zl(),[S,D]=Me.useState("general"),[P,V]=Me.useState(()=>({googleApiKey:localStorage.getItem("isp_google_api_key")||xs.GOOGLE_API_KEY,googleClientId:localStorage.getItem("isp_google_client_id")||xs.GOOGLE_CLIENT_ID||"",googleSheetId:localStorage.getItem("isp_google_sheet_id")||xs.GOOGLE_SHEET_ID||"",geminiApiKey:localStorage.getItem("isp_gemini_api_key")||"",firebaseApiKey:localStorage.getItem("isp_firebase_api_key")||"",firebaseAuthDomain:localStorage.getItem("isp_firebase_auth_domain")||"",firebaseProjectId:localStorage.getItem("isp_firebase_project_id")||"",firebaseStorageBucket:localStorage.getItem("isp_firebase_storage_bucket")||"",firebaseMessagingSenderId:localStorage.getItem("isp_firebase_messaging_sender_id")||"",firebaseAppId:localStorage.getItem("isp_firebase_app_id")||""})),[M,B]=Me.useState(!1),[q,W]=Me.useState(()=>({empresaNombre:localStorage.getItem("isp_empresa_nombre")||"ISP Carabayllo",empresaTelefono:localStorage.getItem("isp_empresa_telefono")||"999-000-111",empresaEmail:localStorage.getItem("isp_empresa_email")||"soporte@isp.com",empresaDireccion:localStorage.getItem("isp_empresa_direccion")||"Carabayllo, Lima",moneda:localStorage.getItem("isp_moneda")||"PEN",zonaHoraria:localStorage.getItem("isp_zona_horaria")||"America/Lima"})),[J,se]=Me.useState(!1),I=()=>{localStorage.setItem("isp_google_api_key",P.googleApiKey),localStorage.setItem("isp_google_client_id",P.googleClientId),localStorage.setItem("isp_google_sheet_id",P.googleSheetId),localStorage.setItem("isp_gemini_api_key",P.geminiApiKey),localStorage.setItem("isp_firebase_api_key",P.firebaseApiKey),localStorage.setItem("isp_firebase_auth_domain",P.firebaseAuthDomain),localStorage.setItem("isp_firebase_project_id",P.firebaseProjectId),localStorage.setItem("isp_firebase_storage_bucket",P.firebaseStorageBucket),localStorage.setItem("isp_firebase_messaging_sender_id",P.firebaseMessagingSenderId),localStorage.setItem("isp_firebase_app_id",P.firebaseAppId),B(!0),T.success("Credenciales API guardadas"),setTimeout(()=>B(!1),3e3)},_=()=>{Object.entries(q).forEach(([y,p])=>{localStorage.setItem("isp_"+y.replace(/([A-Z])/g,"_$1").toLowerCase(),p)}),se(!0),T.success("Parmetros guardados"),setTimeout(()=>se(!1),3e3)},E=async()=>{await u()?T.success("Respaldo subido correctamente a Firebase"):T.error("Error al subir respaldo")},w=async()=>{if(!window.confirm("ADVERTENCIA: Esto reemplazar TODOS los datos actuales con la versin ms reciente de la nube. Deseas continuar?"))return;await h()?T.success("Datos restaurados desde Firebase"):T.error("Error al restaurar datos")},b=[{id:"general",label:"General",icon:ju},{id:"usuarios",label:"Usuarios & Roles",icon:Mu},{id:"api",label:"Conexin API",icon:th},{id:"backups",label:"Backups",icon:mr},{id:"sistema",label:"Sistema",icon:mr}];return m.jsxs("div",{className:"animate-fade p-6 px-8 h-full overflow-y-auto",children:[m.jsx("div",{className:"flex justify-between items-center mb-6",children:m.jsxs("div",{children:[m.jsx("h1",{className:"text-[26px] font-bold tracking-tight",children:"Configuracin"}),m.jsx("p",{className:"text-text-secondary text-sm mt-1",children:"Parmetros del sistema, roles y conexiones"})]})}),m.jsx("div",{className:"flex gap-1 bg-bg-secondary rounded-xl p-1 mb-6 w-fit",children:b.map(y=>{const p=y.icon;return m.jsxs("button",{onClick:()=>D(y.id),className:`flex items-center gap-2 py-2 px-4 rounded-lg text-sm border-none cursor-pointer transition-all ${S===y.id?"bg-accent-blue text-white font-semibold shadow-sm":"bg-transparent text-text-secondary hover:text-text-primary"}`,children:[m.jsx(p,{size:14}),y.label]},y.id)})}),S==="general"&&m.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[m.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent-blue/10 flex items-center justify-center",children:m.jsx(Lu,{size:18,className:"text-accent-blue"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-bold",children:"ISP System"}),m.jsx("p",{className:"text-[11px] text-text-muted",children:"Sistema de Gestin para Proveedores de Internet"})]})]}),m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsx(nt,{label:"Versin",value:"1.1.0"}),m.jsx(nt,{label:"Framework",value:"React 18 + Vite 5"}),m.jsx(nt,{label:"Estado",value:"Produccin",badge:"bg-emerald-500/10 text-emerald-400"}),m.jsx(nt,{label:"ltima actualizacin",value:new Date().toLocaleDateString("es-PE")})]})]}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border col-span-2",children:[m.jsxs("h3",{className:"text-sm font-semibold mb-4 text-text-secondary flex items-center gap-2",children:[m.jsx(Go,{size:16,className:"text-accent-yellow"})," Personalizacin"]}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[m.jsx(Tt,{id:"default",label:"Azul Noche",color:"#0a0e1a",accent:"#3b82f6",icon:ih,active:a==="default",onClick:()=>de.getState().setTheme("default")}),m.jsx(Tt,{id:"light",label:"Modo Claro",color:"#ffffff",accent:"#2563eb",icon:lh,active:a==="light",onClick:()=>de.getState().setTheme("light")}),m.jsx(Tt,{id:"black",label:"Negro OLED",color:"#000000",accent:"#e5e5e5",icon:ah,active:a==="black",onClick:()=>de.getState().setTheme("black")}),m.jsx(Tt,{id:"purple",label:"Lila Suave",color:"#faf5ff",accent:"#a855f7",icon:Go,active:a==="purple",onClick:()=>de.getState().setTheme("purple")}),m.jsx(Tt,{id:"rose",label:"Rosa Nrdico",color:"#fff1f2",accent:"#e11d48",icon:Zu,active:a==="rose",onClick:()=>de.getState().setTheme("rose")}),m.jsx(Tt,{id:"ocean",label:"Brisa Marina",color:"#ecfeff",accent:"#0891b2",icon:hh,active:a==="ocean",onClick:()=>de.getState().setTheme("ocean")}),m.jsx(Tt,{id:"sage",label:"Jardn Salvia",color:"#f0fdf4",accent:"#16a34a",icon:rh,active:a==="sage",onClick:()=>de.getState().setTheme("sage")})]})]}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Resumen del Sistema"}),m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsx(bn,{label:"Clientes registrados",value:e.length,color:"text-accent-blue"}),m.jsx(bn,{label:"Tickets",value:r.length,color:"text-accent-purple"}),m.jsx(bn,{label:"Averas registradas",value:s.length,color:"text-accent-red"}),m.jsx(bn,{label:"Equipos en inventario",value:o.length,color:"text-accent-yellow"}),m.jsx(bn,{label:"Fuente de datos",value:t==="demo"?"Demo (30 registros)":"Excel importado",color:"text-text-secondary"})]})]}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border col-span-2",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Sesin Activa"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center text-lg font-bold",style:{background:(Ve[n?.rol]||Ve.TECNICO).color+"20",color:(Ve[n?.rol]||Ve.TECNICO).color},children:n?.nombre?.[0]||"?"}),m.jsxs("div",{className:"flex-1",children:[m.jsx("p",{className:"text-base font-bold",children:n?.nombre}),m.jsx("p",{className:"text-sm text-text-secondary",children:n?.email}),m.jsx("p",{className:"text-xs mt-1 font-medium",style:{color:(Ve[n?.rol]||Ve.TECNICO).color},children:(Ve[n?.rol]||Ve.TECNICO).label})]}),m.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-500/10 rounded-lg",children:[m.jsx(Ut,{size:14,className:"text-emerald-400"}),m.jsx("span",{className:"text-[11px] text-emerald-400 font-semibold",children:"Sesin activa"})]})]})]})]}),S==="usuarios"&&m.jsxs("div",{className:"flex flex-col gap-6",children:[m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Roles del Sistema"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(Ve).map(([y,p])=>m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:p.color+"20",color:p.color},children:m.jsx(nc,{size:16})}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-bold",children:p.label}),m.jsx("p",{className:"text-[11px] text-text-muted font-mono",children:y})]})]}),m.jsx("div",{className:"flex flex-wrap gap-1.5",children:p.permissions.map(me=>m.jsx("span",{className:"px-2 py-0.5 rounded-md text-[10px] font-medium bg-white/[0.05] text-text-secondary border border-border",children:me},me))})]},y))})]}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Usuarios Autorizados (Demo)"}),m.jsxs("table",{className:"w-full text-[13px]",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"text-left text-[11px] text-text-muted uppercase",children:[m.jsx("th",{className:"py-2 px-3",children:"Correo"}),m.jsx("th",{className:"py-2 px-3",children:"Rol"}),m.jsx("th",{className:"py-2 px-3",children:"Permisos"})]})}),m.jsx("tbody",{children:Fu.map(y=>{const p=Ve[y.rol]||Ve.TECNICO;return m.jsxs("tr",{className:"border-t border-border",children:[m.jsx("td",{className:"py-2.5 px-3 font-mono text-xs",children:y.email}),m.jsx("td",{className:"py-2.5 px-3",children:m.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[11px] font-medium",style:{background:p.color+"15",color:p.color},children:p.label})}),m.jsxs("td",{className:"py-2.5 px-3 text-text-muted text-[11px]",children:[p.permissions.length," permisos"]})]},y.email)})})]}),m.jsxs("p",{className:"text-[11px] text-text-muted mt-3",children:["* Los usuarios se gestionan desde Google Cloud Console y la hoja ",m.jsx("code",{className:"text-accent-blue",children:"tb_Usuarios_Auth"})]})]}),m.jsx(xg,{})]}),S==="api"&&m.jsxs("div",{className:"flex flex-col gap-6",children:[m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Google Cloud Platform"}),m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsx(Oe,{label:"Google API Key",envVar:"VITE_GOOGLE_API_KEY",value:P.googleApiKey,onChange:y=>V(p=>({...p,googleApiKey:y})),placeholder:"AIza..."}),m.jsx(Oe,{label:"Google Client ID (OAuth)",envVar:"VITE_GOOGLE_CLIENT_ID",value:P.googleClientId,onChange:y=>V(p=>({...p,googleClientId:y})),placeholder:"123456789-abc.apps.googleusercontent.com"}),m.jsx(Oe,{label:"Google Sheet ID",envVar:"VITE_GOOGLE_SHEET_ID",value:P.googleSheetId,onChange:y=>V(p=>({...p,googleSheetId:y})),placeholder:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgVE2upms"}),m.jsx(Oe,{label:"Gemini API Key",envVar:"VITE_GEMINI_API_KEY",value:P.geminiApiKey,onChange:y=>V(p=>({...p,geminiApiKey:y})),placeholder:"AIza..."}),m.jsxs("div",{className:"pt-4 border-t border-border mt-2",children:[m.jsxs("h4",{className:"text-xs font-bold mb-3 text-accent-cyan flex items-center gap-2",children:[m.jsx(mr,{size:14})," Firebase Sync (Respaldo en la Nube)"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsx(Oe,{label:"API Key",envVar:"VITE_FIREBASE_API_KEY",value:P.firebaseApiKey,onChange:y=>V(p=>({...p,firebaseApiKey:y})),placeholder:"AIza..."}),m.jsx(Oe,{label:"Project ID",envVar:"VITE_FIREBASE_PROJECT_ID",value:P.firebaseProjectId,onChange:y=>V(p=>({...p,firebaseProjectId:y})),placeholder:"isp-sistema-xxx"}),m.jsx(Oe,{label:"Auth Domain",envVar:"VITE_FIREBASE_AUTH_DOMAIN",value:P.firebaseAuthDomain,onChange:y=>V(p=>({...p,firebaseAuthDomain:y})),placeholder:"isp-sistema.firebaseapp.com"}),m.jsx(Oe,{label:"Storage Bucket",envVar:"VITE_FIREBASE_STORAGE_BUCKET",value:P.firebaseStorageBucket,onChange:y=>V(p=>({...p,firebaseStorageBucket:y})),placeholder:"isp-sistema.appspot.com"}),m.jsx(Oe,{label:"Msg Sender ID",envVar:"VITE_FIREBASE_MESSAG...",value:P.firebaseMessagingSenderId,onChange:y=>V(p=>({...p,firebaseMessagingSenderId:y})),placeholder:"123456..."}),m.jsx(Oe,{label:"App ID",envVar:"VITE_FIREBASE_APP_ID",value:P.firebaseAppId,onChange:y=>V(p=>({...p,firebaseAppId:y})),placeholder:"1:123456:web:abcd..."})]})]})]}),m.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[m.jsxs("button",{onClick:I,className:"py-2.5 px-6 rounded-xl bg-accent-blue border-none text-white text-sm font-semibold cursor-pointer flex items-center gap-2 hover:opacity-90",children:[m.jsx(Ho,{size:14})," Guardar Cambios"]}),M&&m.jsxs("span",{className:"text-xs text-accent-green flex items-center gap-1",children:[m.jsx(Ut,{size:14})," Guardado correctamente"]})]})]}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Estado de Servicios"}),m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsx(Tn,{name:"Google Sheets API v4",status:!1}),m.jsx(Tn,{name:"Google Identity Services (OAuth 2.0)",status:!1}),m.jsx(Tn,{name:"Google Drive API",status:!0}),m.jsx(Tn,{name:"Firebase Firestore",status:!!P.firebaseApiKey}),m.jsx(Tn,{name:"SheetJS (Lectura Excel local)",status:!0})]})]}),m.jsx("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(tc,{size:18,className:"text-accent-yellow mt-0.5"}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-semibold mb-1",children:"Configuracin de APIs"}),m.jsxs("p",{className:"text-[12px] text-text-secondary leading-relaxed",children:["Las credenciales se configuran mediante variables de entorno en ",m.jsx("code",{className:"text-accent-blue",children:".env"})," o directamente desde esta pgina (se guardan en localStorage). Nunca compartas las API keys en repositorios pblicos."]})]})]})})]}),S==="backups"&&m.jsxs("div",{className:"flex flex-col gap-6",children:[v&&m.jsx("div",{className:"fixed inset-0 z-[9998] bg-black/60 backdrop-blur-sm flex items-center justify-center animate-fade",children:m.jsxs("div",{className:"bg-bg-card border border-border rounded-2xl p-8 w-[420px] shadow-2xl",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[m.jsx("div",{className:"w-11 h-11 rounded-xl bg-accent-blue/10 flex items-center justify-center",children:m.jsx(qo,{size:20,className:"text-accent-blue animate-pulse"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-sm font-bold text-text-primary",children:"Subiendo Respaldo a Firebase"}),m.jsx("p",{className:"text-[11px] text-text-muted",children:"No cierres esta ventana"})]})]}),m.jsx("div",{className:"w-full bg-bg-secondary rounded-full h-3 mb-3 overflow-hidden border border-border",children:m.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${v.percent}%`,background:v.percent===100?"linear-gradient(90deg, #10b981, #34d399)":"linear-gradient(90deg, #3b82f6, #60a5fa)"}})}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-xs text-text-secondary font-medium",children:v.label}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{className:"text-[10px] text-text-muted",children:["Paso ",v.step,"/",v.totalSteps]}),m.jsxs("span",{className:"text-sm font-bold text-accent-blue",children:[v.percent,"%"]})]})]}),v.percent===100&&m.jsxs("div",{className:"mt-4 flex items-center gap-2 justify-center text-emerald-400",children:[m.jsx(Ut,{size:16}),m.jsx("span",{className:"text-xs font-semibold",children:"Completado!"})]})]})}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Sincronizacin Manual"}),m.jsxs("div",{className:"flex items-center justify-between p-4 bg-bg-secondary rounded-xl border border-border",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Respaldo y Restauracin"}),m.jsx("p",{className:"text-[11px] text-text-muted mt-1",children:g?`ltima sincronizacin: ${new Date(g).toLocaleString()}`:"No se ha sincronizado an"})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsxs("button",{onClick:E,disabled:d||!P.firebaseApiKey,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-accent-blue/10 text-accent-blue text-xs font-bold hover:bg-accent-blue/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer border-none",children:[m.jsx(qo,{size:16}),d?"Sincronizando...":"Subir Respaldo"]}),m.jsxs("button",{onClick:w,disabled:d||!P.firebaseApiKey,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-accent-purple/10 text-accent-purple text-xs font-bold hover:bg-accent-purple/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer border-none",children:[m.jsx(sc,{size:16}),d?"Sincronizando...":"Restaurar ltimo"]})]})]})]}),m.jsx(Ag,{})]}),S==="sistema"&&m.jsxs("div",{className:"flex flex-col gap-6",children:[m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Parmetros de la Empresa"}),m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsx("label",{className:"text-xs font-semibold mb-1 block",children:"Nombre de la Empresa"}),m.jsx("input",{type:"text",value:q.empresaNombre,onChange:y=>W(p=>({...p,empresaNombre:y.target.value})),placeholder:"ISP Carabayllo",className:"w-full py-2 px-3 bg-bg-card border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted"})]}),m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsx("label",{className:"text-xs font-semibold mb-1 block",children:"Telfono"}),m.jsx("input",{type:"text",value:q.empresaTelefono,onChange:y=>W(p=>({...p,empresaTelefono:y.target.value})),placeholder:"999-000-111",className:"w-full py-2 px-3 bg-bg-card border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted"})]}),m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsx("label",{className:"text-xs font-semibold mb-1 block",children:"Email de Soporte"}),m.jsx("input",{type:"email",value:q.empresaEmail,onChange:y=>W(p=>({...p,empresaEmail:y.target.value})),placeholder:"soporte@isp.com",className:"w-full py-2 px-3 bg-bg-card border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted"})]}),m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsx("label",{className:"text-xs font-semibold mb-1 block",children:"Direccin"}),m.jsx("input",{type:"text",value:q.empresaDireccion,onChange:y=>W(p=>({...p,empresaDireccion:y.target.value})),placeholder:"Carabayllo, Lima",className:"w-full py-2 px-3 bg-bg-card border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsx("label",{className:"text-xs font-semibold mb-1 block",children:"Moneda"}),m.jsx("input",{type:"text",value:q.moneda,onChange:y=>W(p=>({...p,moneda:y.target.value})),placeholder:"PEN",className:"w-full py-2 px-3 bg-bg-card border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted"})]}),m.jsxs("div",{className:"p-4 rounded-xl bg-bg-secondary border border-border",children:[m.jsx("label",{className:"text-xs font-semibold mb-1 block",children:"Zona Horaria"}),m.jsx("input",{type:"text",value:q.zonaHoraria,onChange:y=>W(p=>({...p,zonaHoraria:y.target.value})),placeholder:"America/Lima",className:"w-full py-2 px-3 bg-bg-card border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted"})]})]})]}),m.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[m.jsxs("button",{onClick:_,className:"py-2.5 px-6 rounded-xl bg-accent-blue border-none text-white text-sm font-semibold cursor-pointer flex items-center gap-2 hover:opacity-90",children:[m.jsx(Ho,{size:14})," Guardar Parmetros"]}),J&&m.jsxs("span",{className:"text-xs text-accent-green flex items-center gap-1",children:[m.jsx(Ut,{size:14})," Guardado correctamente"]})]})]}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Almacenamiento Local"}),m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsx(nt,{label:"Mtodo",value:"Zustand (memoria) + IndexedDB (persistencia)"}),m.jsx(nt,{label:"Datos en memoria",value:`${e.length} clientes, ${r.length} tickets, ${o.length} equipos`}),m.jsx(nt,{label:"Motor ETL",value:"9 reglas de limpieza (dataTransformer.js)"}),m.jsx(nt,{label:"Formatos soportados",value:".xlsx, .xls (lectura va SheetJS)"})]})]}),m.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 border border-border",children:[m.jsx("h3",{className:"text-sm font-semibold mb-4 text-text-secondary",children:"Stack Tecnolgico"}),m.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{name:"React 18",desc:"UI Framework"},{name:"Vite 5",desc:"Build tool"},{name:"Tailwind CSS v4",desc:"Estilos"},{name:"Zustand",desc:"Estado global"},{name:"Firebase",desc:"Cloud Backup"},{name:"SheetJS",desc:"Lectura Excel"},{name:"Lucide React",desc:"Iconografa"},{name:"Google OAuth 2.0",desc:"Autenticacin"},{name:"IndexedDB",desc:"Storage local"}].map(y=>m.jsxs("div",{className:"p-3 rounded-xl bg-bg-secondary border border-border text-center",children:[m.jsx("p",{className:"text-xs font-bold",children:y.name}),m.jsx("p",{className:"text-[10px] text-text-muted",children:y.desc})]},y.name))})]})]})]})}function nt({label:n,value:e,badge:t}){return m.jsxs("div",{className:"flex justify-between items-center py-1.5 text-xs",children:[m.jsx("span",{className:"text-text-muted",children:n}),t?m.jsx("span",{className:`px-2 py-0.5 rounded-full text-[11px] font-medium ${t}`,children:e}):m.jsx("span",{className:"font-medium text-text-primary",children:e})]})}function bn({label:n,value:e,color:t}){return m.jsxs("div",{className:"flex justify-between items-center py-1.5 text-xs",children:[m.jsx("span",{className:"text-text-muted",children:n}),m.jsx("span",{className:`font-mono font-bold ${t}`,children:e})]})}function Tn({name:n,status:e}){return m.jsxs("div",{className:"flex items-center justify-between py-2 text-xs",children:[m.jsx("span",{className:"font-medium",children:n}),e?m.jsxs("span",{className:"flex items-center gap-1.5 text-emerald-400",children:[m.jsx(Ut,{size:12})," Listo"]}):m.jsxs("span",{className:"flex items-center gap-1.5 text-accent-yellow",children:[m.jsx(tc,{size:12})," Pendiente"]})]})}function Tt({id:n,label:e,color:t,accent:r,icon:s,active:o,onClick:a}){return m.jsxs("button",{onClick:a,className:`relative p-4 rounded-xl border transition-all cursor-pointer flex flex-col items-center gap-3 group
        ${o?"border-accent-blue bg-accent-blue/5 shadow-[0_0_15px_-3px_rgba(59,130,246,0.3)]":"border-border bg-bg-secondary hover:border-accent-blue/50 hover:bg-bg-card"}
      `,children:[m.jsxs("div",{className:"w-full h-16 rounded-lg mb-1 relative overflow-hidden border border-border/50 shadow-inner",style:{background:t},children:[m.jsx("div",{className:"absolute top-2 left-2 w-8 h-2 rounded bg-white/20"}),m.jsx("div",{className:"absolute top-6 left-2 w-12 h-2 rounded bg-white/10"}),m.jsx("div",{className:"absolute bottom-2 right-2 w-6 h-6 rounded-full flex items-center justify-center text-white",style:{background:r},children:m.jsx(s,{size:12})})]}),m.jsx("div",{className:"text-center",children:m.jsx("span",{className:`text-xs font-semibold block ${o?"text-text-primary":"text-text-secondary group-hover:text-text-primary"}`,children:e})}),o&&m.jsx("div",{className:"absolute top-2 right-2 w-5 h-5 bg-accent-blue rounded-full flex items-center justify-center text-white shadow-sm",children:m.jsx(Ut,{size:12,fill:"currentColor",className:"text-white"})})]})}export{Bg as default};
