import{c as Pt,a as b,r,j as e,o as Ze,X as xe,F as zt,m as et,T as Ft}from"./index-DBbpf6L9.js";import{C as $t,a as tt,A as S}from"./Adjuntos-D2ZySTL2.js";import{R as Vt}from"./ResolutionModal-e4835I8m.js";import{g as me,D as Ot}from"./DiagnosticFields-CvDlfq8c.js";import{C as st,e as at}from"./CopyButton-CZH_h5nj.js";import{P as Lt}from"./plus-BMGYk195.js";import{M as ue}from"./map-pin-BQjOBAGj.js";import{C as be}from"./clock-IOYZEdMt.js";import{S as pe}from"./search-B2oC94of.js";import{C as _t}from"./chevron-right-BBmXq-uv.js";import{U as ge}from"./user-Doc4fUmV.js";import{A as rt}from"./activity-pIpKoAyO.js";import{P as Bt}from"./pen-line-BRZ9Hc44.js";import{C as qt}from"./circle-check-ii6TWyto.js";import{H as Ht}from"./history-CI4UNN3E.js";import{A as Ut}from"./arrow-right-Dsjz8N1L.js";import"./upload-C-iEl_q_.js";import"./eye-BC8INoTL.js";import"./download-fudvv3Gy.js";import"./chevron-down-D3hXCwB2.js";import"./radio-gTQBO_OZ.js";import"./check-DDCzPa57.js";const Yt=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],ot=Pt("list",Yt);function u({label:n,value:l,unit:c,warn:d}){return l==null||l===""?null:e.jsxs("div",{className:`bg-bg-secondary rounded-lg p-2.5 border ${d?"border-accent-orange/50":"border-border/50"}`,children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide font-semibold mb-0.5",children:n}),e.jsxs("p",{className:`text-sm font-mono font-semibold ${d?"text-accent-orange":"text-text-primary"}`,children:[l,c?` ${c}`:"",d&&e.jsx(Ft,{size:12,className:"inline ml-1 text-accent-orange"})]})]})}const D={Programada:{bg:"bg-blue-500/20",text:"text-blue-400",dot:"bg-blue-400",hex:"#3b82f6"},"En Ruta":{bg:"bg-purple-500/20",text:"text-purple-400",dot:"bg-purple-400",hex:"#8b5cf6"},"En Sitio":{bg:"bg-yellow-500/20",text:"text-yellow-400",dot:"bg-yellow-400",hex:"#f59e0b"},Completada:{bg:"bg-green-500/20",text:"text-green-400",dot:"bg-green-400",hex:"#10b981"},Cancelada:{bg:"bg-gray-500/20",text:"text-gray-400",dot:"bg-gray-400",hex:"#6b7280"},Ausente:{bg:"bg-orange-500/20",text:"text-orange-400",dot:"bg-orange-400",hex:"#f97316"},Reprogramada:{bg:"bg-cyan-500/20",text:"text-cyan-400",dot:"bg-cyan-400",hex:"#06b6d4"},"Derivado a Planta Externa":{bg:"bg-amber-500/20",text:"text-amber-400",dot:"bg-amber-400",hex:"#f59e0b"}},he={Alta:{text:"text-red-400",hex:"#ef4444"},Media:{text:"text-yellow-400",hex:"#f59e0b"},Baja:{text:"text-green-400",hex:"#10b981"}},fe=[{bg:"#3b82f620",border:"#3b82f6",text:"#93c5fd"},{bg:"#8b5cf620",border:"#8b5cf6",text:"#c4b5fd"},{bg:"#10b98120",border:"#10b981",text:"#6ee7b7"},{bg:"#f59e0b20",border:"#f59e0b",text:"#fcd34d"},{bg:"#ef444420",border:"#ef4444",text:"#fca5a5"}],Jt=["Lun","Mar","Mié","Jue","Vie","Sáb"],Wt=Array.from({length:11},(n,l)=>l+8);function Gt(n){const l=new Date(n),c=l.getDay(),d=c===0?-6:1-c;return l.setDate(l.getDate()+d),l.setHours(0,0,0,0),l}function g(n){const l=n.getFullYear(),c=String(n.getMonth()+1).padStart(2,"0"),d=String(n.getDate()).padStart(2,"0");return`${l}-${c}-${d}`}function Kt(n){return`${String(n.getDate()).padStart(2,"0")}/${String(n.getMonth()+1).padStart(2,"0")}`}function Qt(n){return Array.from({length:6},(l,c)=>{const d=new Date(n);return d.setDate(n.getDate()+c),d})}function Xt(){const n=new Date,l=new Date(n.getFullYear(),n.getMonth(),1),c=new Date(n.getFullYear(),n.getMonth()+1,0);return{start:g(l),end:g(c)}}function vs(){const n=b(t=>t.visitas),l=b(t=>t.addVisita),c=b(t=>t.updateVisita),d=b(t=>t.clients),R=b(t=>t.tecnicos),je=b(t=>t.tickets),Ne=b(t=>t.updateTicket),nt=b(t=>t.addDerivacion),ve=b(t=>t.deleteVisita),[F,ye]=r.useState("calendar"),[$,it]=r.useState(""),[V,lt]=r.useState("all"),[O,ct]=r.useState("all"),[L,dt]=r.useState("all"),[xt,N]=r.useState(!1),[s,p]=r.useState(null),[se,ae]=r.useState(0),[o,_]=r.useState(me()),[Ce,v]=r.useState(!1);r.useEffect(()=>{if(s){if(s.diagnosticoCompleto)_(s.diagnosticoCompleto);else{const t=me(),a={};Object.keys(t).forEach(i=>{a[i]=s[i]||""}),_(a)}v(!1)}},[s]);const mt=()=>{s&&(c(s.id,{diagnosticoCompleto:o,...o,_historyEntry:{accion:"Actualización Diagnóstico",motivo:"Se actualizaron los parámetros técnicos"}}),p(t=>({...t,diagnosticoCompleto:o,...o})),v(!1))},ut=()=>{if(!s||!window.confirm("¿Estás seguro de limpiar los parámetros de diagnóstico?"))return;const t=me();c(s.id,{diagnosticoCompleto:t,...t,_historyEntry:{accion:"Limpieza Diagnóstico",motivo:"Se eliminaron los parámetros técnicos"}}),_(t),p(a=>({...a,diagnosticoCompleto:t,...t})),v(!1)},[y,B]=r.useState(""),[E,q]=r.useState(""),[bt,H]=r.useState(""),[T,we]=r.useState(""),[ke,Se]=r.useState("Reparación"),[De,Re]=r.useState("Media"),[Ee,Te]=r.useState(g(new Date)),[Me,Ae]=r.useState("09:00"),[Ie,Pe]=r.useState("10:00"),[ze,U]=r.useState(""),[Fe,re]=r.useState(""),[$e,M]=r.useState(""),[pt,Y]=r.useState(!1),[C,J]=r.useState(""),[gt,A]=r.useState(!1),[Ve,Oe]=r.useState([]),[ht,oe]=r.useState(!1),[w,ne]=r.useState(null),[ft,W]=r.useState(!1),[G,Le]=r.useState(""),[I,_e]=r.useState(""),[P,Be]=r.useState(""),[K,qe]=r.useState([]),[jt,Q]=r.useState(!1),[X,He]=r.useState(""),[Z,Ue]=r.useState([]),[ie,Nt]=r.useState(!1),f=b(t=>t.prefillVisita),vt=b(t=>t.clearPrefillVisita);r.useEffect(()=>{f&&(q(f.clienteId),H(f.clienteNombre),B(f.clienteNombre),M(f.ticketId||""),re(f.descripcion||""),N(!0),vt())},[f]),r.useEffect(()=>{if(s){const t=n.find(a=>a.id===s.id);t&&t!==s&&p(t)}},[n,s]);const Ye=r.useMemo(()=>{const a=Gt(new Date);return a.setDate(a.getDate()+se*7),a},[se]),h=r.useMemo(()=>Qt(Ye),[Ye]),Je=r.useMemo(()=>{const t={};return[...new Set(n.map(i=>i.tecnicoId))].forEach((i,m)=>{t[i]=fe[m%fe.length]}),t},[n]),le=r.useMemo(()=>Xt(),[]),j=r.useMemo(()=>{const t=n.filter(a=>a.fecha>=le.start&&a.fecha<=le.end);return{programadas:n.filter(a=>a.estado==="Programada").length,enRuta:n.filter(a=>a.estado==="En Ruta").length,completadas:n.filter(a=>a.estado==="Completada").length,totalMes:t.length}},[n,le]),We=r.useMemo(()=>n.filter(t=>{const a=$.toLowerCase(),i=!$||t.clienteNombre&&t.clienteNombre.toLowerCase().includes(a)||t.id&&t.id.toLowerCase().includes(a)||t.tecnicoNombre&&t.tecnicoNombre.toLowerCase().includes(a)||t.direccion&&t.direccion.toLowerCase().includes(a),m=V==="all"||t.estado===V,ce=O==="all"||t.tipo===O,de=L==="all"||t.tecnicoId===L;return i&&m&&ce&&de}),[n,$,V,O,L]),Ge=r.useMemo(()=>{const t=g(h[0]),a=g(h[5]);return n.filter(i=>!(i.fecha<t||i.fecha>a||ie&&(i.estado==="Cancelada"||i.estado==="Ausente")))},[n,h,ie]),Ke=r.useMemo(()=>{if(!y||y.length<2)return[];const t=y.toLowerCase();return d.filter(a=>a.nombre&&a.nombre.toLowerCase().includes(t)||a.id&&a.id.includes(t)).slice(0,8)},[d,y]),Qe=r.useMemo(()=>{if(!C||C.length<2)return[];const t=C.toLowerCase();return je.filter(a=>a.id&&a.id.toLowerCase().includes(t)||a.clienteNombre&&a.clienteNombre.toLowerCase().includes(t)||a.descripcion&&a.descripcion.toLowerCase().includes(t)).slice(0,8)},[je,C]),yt=r.useMemo(()=>R.filter(t=>t.estado==="Activo"),[R]);function z(){B(""),q(""),H(""),we(""),Se("Reparación"),Re("Media"),Te(g(new Date)),Ae("09:00"),Pe("10:00"),U(""),re(""),M(""),Y(!1),J(""),A(!1),Oe([])}function Ct(t){q(t.id),H(t.nombre),B(t.nombre),U(t.direccion||t.sector||""),Y(!1)}function wt(t){if(t.preventDefault(),!E||!T)return;const a=R.find(i=>i.id===T);l({clienteId:E,clienteNombre:bt,tecnicoId:T,tecnicoNombre:a?a.nombre:"",tipo:ke,estado:"Programada",prioridad:De,direccion:ze,descripcion:Fe,resultado:"",fecha:Ee,horaInicio:Me,horaFin:Ie||null,ticketId:$e||null,adjuntos:Ve}),N(!1),z()}const k=(t,a)=>{a==="Completada"?(ne({visitaId:t,newEstado:a}),oe(!0)):c(t,{estado:a,_historyComment:"Cambio de estado manual"})},kt=t=>{if(!w)return;c(w.visitaId,{estado:w.newEstado,...t,_historyComment:t.solucion});const a=n.find(i=>i.id===w.visitaId);a?.ticketId&&Ne(a.ticketId,{estado:"Resuelto",_historyComment:`Resuelto desde Visita Técnica (${a.id})`}),oe(!1),ne(null)},St=()=>{_e(""),Be(""),Le(""),qe([]),W(!0)},Dt=async()=>{if(!s)return;const t=[];if(K.length>0)for(const a of K)t.push({name:a.name,url:a.dataUrl,type:a.type});c(s.id,{estado:"Reprogramada",fecha:I||s.fecha,horaInicio:P||s.horaInicio,motivoReprogramacion:G,evidenciaReprogramacion:t,_historyEntry:{accion:"Visita Reprogramada",estadoAnterior:s.estado,estadoNuevo:"Reprogramada",motivo:G,adjuntos:K,detalles:`Nueva fecha: ${I||s.fecha} ${P||s.horaInicio}`}}),W(!1)},Rt=()=>{He(""),Ue([]),Q(!0)},Et=async()=>{if(!s)return;const t=[];if(Z.length>0)for(const a of Z)t.push({name:a.name,url:a.dataUrl,type:a.type});c(s.id,{estado:"Ausente",resultado:`Cliente Ausente: ${X}`,evidenciaResultado:t,_historyEntry:{accion:"Cliente Ausente",estadoAnterior:s.estado,estadoNuevo:"Ausente",motivo:X,adjuntos:Z,detalles:"Se marcó al cliente como ausente en el domicilio"}}),Q(!1)};function Tt(t,a){return Ge.filter(i=>i.fecha!==t||!i.horaInicio?!1:parseInt(i.horaInicio.split(":")[0],10)===a)}const Mt=()=>{if(!s)return;const t=d.find(a=>a.id===s.clienteId);c(s.id,{estado:"Derivado a Planta Externa",_historyComment:"Derivado a Planta Externa - problema de infraestructura"}),nt({clienteId:s.clienteId,clienteNombre:s.clienteNombre||t?.NOMBRE||"",zona:t?.NODO||"",tipo:"Fibra Óptica",prioridad:s.prioridad||"Alta",estado:"Pendiente",descripcion:`Derivado de Visita Técnica (${s.id}). ${s.descripcion||""}`,ticketId:s.ticketId||null,visitaOrigenId:s.id}),s.ticketId&&Ne(s.ticketId,{estado:"Escalado",_historyEstadoLabel:"Escalado - Planta Externa",_historyComment:`Derivado desde Visita Técnica (${s.id}) a Planta Externa`}),p({...s,estado:"Derivado a Planta Externa"})},At=t=>{window.confirm("¿Estás seguro de eliminar esta visita técnica? Esta acción no se puede deshacer.")&&(ve&&ve(t),p(null))},It=r.useMemo(()=>{const t=h[0],a=h[5],i=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];return t.getMonth()===a.getMonth()?`${t.getDate()} - ${a.getDate()} ${i[t.getMonth()]} ${t.getFullYear()}`:`${t.getDate()} ${i[t.getMonth()]} - ${a.getDate()} ${i[a.getMonth()]} ${t.getFullYear()}`},[h]),Xe=g(new Date);return e.jsxs("div",{className:"animate-fade p-4 sm:p-6 sm:px-8 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-[26px] font-bold tracking-tight",children:"Visitas Técnicas"}),e.jsxs("p",{className:"text-text-secondary text-sm mt-1",children:[j.totalMes," visitas este mes — ",j.programadas," programadas, ",j.enRuta," en ruta"]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex bg-bg-secondary rounded-lg border border-border overflow-hidden",children:[e.jsxs("button",{onClick:()=>ye("calendar"),className:`px-3 py-2 flex items-center gap-1.5 text-xs font-medium cursor-pointer border-none transition-colors ${F==="calendar"?"bg-accent-blue text-white":"bg-transparent text-text-secondary hover:text-text-primary"}`,children:[e.jsx(Ze,{size:14})," Calendario"]}),e.jsxs("button",{onClick:()=>ye("list"),className:`px-3 py-2 flex items-center gap-1.5 text-xs font-medium cursor-pointer border-none transition-colors ${F==="list"?"bg-accent-blue text-white":"bg-transparent text-text-secondary hover:text-text-primary"}`,children:[e.jsx(ot,{size:14})," Lista"]})]}),e.jsxs("button",{onClick:()=>{z(),N(!0)},className:"w-full sm:w-auto justify-center py-2.5 px-4 rounded-xl bg-accent-blue border-none text-white text-sm font-semibold cursor-pointer flex items-center gap-2 hover:opacity-90 transition-opacity",children:[e.jsx(Lt,{size:16})," Nueva Visita"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[{label:"Programadas",value:j.programadas,color:"#3b82f6",icon:e.jsx(Ze,{size:16})},{label:"En Ruta",value:j.enRuta,color:"#8b5cf6",icon:e.jsx(ue,{size:16})},{label:"Completadas",value:j.completadas,color:"#10b981",icon:e.jsx(be,{size:16})},{label:"Total del mes",value:j.totalMes,color:"#f59e0b",icon:e.jsx(ot,{size:16})}].map(t=>e.jsxs("div",{className:"bg-bg-card rounded-xl p-4 border border-border flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:t.color+"15",color:t.color},children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold font-mono",children:t.value}),e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide",children:t.label})]})]},t.label))}),e.jsxs("div",{className:"flex gap-3 mb-5 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(pe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{placeholder:"Buscar por cliente, técnico, dirección...",value:$,onChange:t=>it(t.target.value),className:"w-full pl-9 bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue"})]}),e.jsxs("select",{value:V,onChange:t=>lt(t.target.value),className:"min-w-[150px] bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"Programada",children:"Programada"}),e.jsx("option",{value:"En Ruta",children:"En Ruta"}),e.jsx("option",{value:"En Sitio",children:"En Sitio"}),e.jsx("option",{value:"Completada",children:"Completada"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"}),e.jsx("option",{value:"Ausente",children:"Ausente"})]}),e.jsxs("select",{value:O,onChange:t=>ct(t.target.value),className:"min-w-[150px] bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),e.jsx("option",{value:"Reparación",children:"Reparación"}),e.jsx("option",{value:"Diagnóstico",children:"Diagnóstico"}),e.jsx("option",{value:"Instalación",children:"Instalación"}),e.jsx("option",{value:"Cambio de plan",children:"Cambio de plan"}),e.jsx("option",{value:"Mantenimiento",children:"Mantenimiento"})]}),e.jsxs("select",{value:L,onChange:t=>dt(t.target.value),className:"min-w-[150px] bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",children:[e.jsx("option",{value:"all",children:"Todos los técnicos"}),R.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),F==="calendar"&&e.jsxs("div",{className:"bg-bg-card rounded-xl border border-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-border",children:[e.jsx("button",{onClick:()=>ae(t=>t-1),className:"p-1.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer hover:text-text-primary hover:border-accent-blue/50 transition-colors",children:e.jsx($t,{size:16})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-semibold",children:It}),se!==0&&e.jsx("button",{onClick:()=>ae(0),className:"text-[11px] text-accent-blue cursor-pointer bg-accent-blue/10 px-2 py-0.5 rounded border-none hover:bg-accent-blue/20 transition-colors",children:"Hoy"})]}),e.jsx("button",{onClick:()=>ae(t=>t+1),className:"p-1.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer hover:text-text-primary hover:border-accent-blue/50 transition-colors",children:e.jsx(_t,{size:16})})]}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-2 border-b border-border bg-bg-secondary/50",children:[e.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[e.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wide flex-shrink-0",children:"Técnicos:"}),e.jsx("div",{className:"flex items-center gap-4 overflow-x-auto no-scrollbar",children:[...new Set(Ge.map(t=>t.tecnicoId))].map(t=>{const a=R.find(m=>m.id===t),i=Je[t];return!a||!i?null:e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm",style:{background:i.border}}),e.jsx("span",{className:"text-[11px] text-text-secondary",children:a.nombre})]},t)})})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer ml-4 pl-4 border-l border-border/50 flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:ie,onChange:t=>Nt(t.target.checked),className:"w-3.5 h-3.5 rounded border-border accent-accent-blue cursor-pointer"}),e.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Ocultar Canceladas/Ausentes"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[e.jsxs("div",{className:"grid grid-cols-[60px_repeat(6,1fr)] border-b border-border",children:[e.jsx("div",{className:"p-2 text-center text-[10px] text-text-muted uppercase"}),h.map((t,a)=>{const m=g(t)===Xe;return e.jsxs("div",{className:`p-2 text-center border-l border-border ${m?"bg-accent-blue/5":""}`,children:[e.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wide block",children:Jt[a]}),e.jsx("span",{className:`text-sm font-semibold ${m?"text-accent-blue":"text-text-primary"}`,children:Kt(t)})]},a)})]}),Wt.map(t=>e.jsxs("div",{className:"grid grid-cols-[60px_repeat(6,1fr)] border-b border-border last:border-b-0",children:[e.jsxs("div",{className:"p-2 text-right pr-3 text-[11px] text-text-muted font-mono flex items-start justify-end pt-1",children:[String(t).padStart(2,"0"),":00"]}),h.map((a,i)=>{const m=g(a),ce=m===Xe,de=Tt(m,t);return e.jsx("div",{className:`border-l border-border min-h-[52px] p-0.5 ${ce?"bg-accent-blue/5":""}`,children:de.map(x=>{const ee=Je[x.tecnicoId]||fe[0],te=D[x.estado];return e.jsxs("div",{onClick:()=>p(x),className:"rounded-md px-1.5 py-1 mb-0.5 cursor-pointer transition-all hover:opacity-80 hover:scale-[1.02]",style:{background:ee.bg,borderLeft:`3px solid ${ee.border}`},title:`${x.clienteNombre} - ${x.tipo} (${x.tecnicoNombre})`,children:[e.jsx("p",{className:"text-[10px] font-semibold truncate leading-tight",style:{color:ee.text},children:x.clienteNombre.length>18?x.clienteNombre.substring(0,18)+"...":x.clienteNombre}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsx("span",{className:"text-[9px] truncate",style:{color:ee.text,opacity:.8},children:x.tipo}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[8px] px-1 rounded font-semibold",style:{background:te?te.hex+"30":"#6b728030",color:te?te.hex:"#6b7280"},children:x.estado==="En Ruta"?"Ruta":x.estado==="En Sitio"?"Sitio":x.estado==="Programada"?"Prog":x.estado==="Completada"?"OK":x.estado}),e.jsx(tt,{count:x.adjuntos?.length})]})]})]},x.id)})},i)})]},t))]})})]}),F==="list"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[We.length===0&&e.jsx("div",{className:"bg-bg-card rounded-xl border border-border p-8 text-center",children:e.jsx("p",{className:"text-text-muted text-sm",children:"No se encontraron visitas con los filtros seleccionados."})}),We.map(t=>{const a=D[t.estado]||D.Programada,i=he[t.prioridad]||he.Media;return e.jsxs("div",{onClick:()=>p(t),className:"bg-bg-card rounded-xl p-4 border border-border cursor-pointer transition-all hover:border-accent-blue/50 hover:bg-bg-card/80",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"font-mono text-xs text-text-muted",children:t.id}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-bold ${a.bg} ${a.text}`,children:t.estado}),e.jsx("span",{className:`text-[11px] font-semibold ${i.text}`,children:t.prioridad}),e.jsx("span",{className:"text-[11px] text-text-muted bg-bg-secondary px-2 py-0.5 rounded",children:t.tipo}),e.jsx(tt,{count:t.adjuntos?.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{getTextFn:()=>at(t,d.find(m=>m.id===t.clienteId))}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-[11px] text-text-muted block",children:t.fecha}),e.jsxs("span",{className:"text-[11px] text-text-secondary font-mono",children:[t.horaInicio,t.horaFin?` - ${t.horaFin}`:""]})]})]})]}),e.jsx("p",{className:"text-sm font-medium mb-1",children:t.clienteNombre}),t.descripcion&&e.jsx("p",{className:"text-xs text-text-secondary line-clamp-1 mb-2",children:t.descripcion}),e.jsxs("div",{className:"flex items-center gap-4 text-[11px] text-text-muted",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{size:11}),e.jsx("span",{className:"text-text-secondary",children:t.tecnicoNombre})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{size:11}),e.jsx("span",{className:"text-text-secondary truncate max-w-[250px]",children:t.direccion})]}),t.ticketId&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{size:11}),e.jsx("span",{className:"text-accent-blue",children:t.ticketId})]})]})]},t.id)})]}),xt&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 backdrop-blur-sm p-4",onClick:()=>{N(!1),z()},children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-full max-w-[560px] border border-border max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Nueva Visita Técnica"}),e.jsx("button",{onClick:()=>{N(!1),z()},className:"p-1.5 rounded-lg bg-bg-secondary border border-border text-text-muted cursor-pointer hover:text-text-primary transition-colors",children:e.jsx(xe,{size:16})})]}),e.jsxs("form",{onSubmit:wt,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Cliente *"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",placeholder:"Buscar cliente por nombre o ID...",value:y,onChange:t=>{B(t.target.value),Y(!0),t.target.value||(q(""),H(""),U(""))},onFocus:()=>{y.length>=2&&Y(!0)},className:"w-full pl-9 bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",required:!0}),E&&e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-accent-green font-mono",children:E}),pt&&Ke.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-bg-card border border-border rounded-lg shadow-xl z-50 max-h-[200px] overflow-y-auto",children:Ke.map(t=>e.jsxs("button",{type:"button",onClick:()=>Ct(t),className:"w-full text-left px-3 py-2 text-sm hover:bg-bg-secondary cursor-pointer border-none bg-transparent text-text-primary transition-colors flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:t.nombre}),e.jsx("span",{className:"text-[10px] text-text-muted font-mono ml-2",children:t.id})]},t.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Técnico *"}),e.jsxs("select",{value:T,onChange:t=>we(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar técnico..."}),yt.map(t=>e.jsxs("option",{value:t.id,children:[t.nombre," - ",t.zona," (",t.especialidad,")"]},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Tipo *"}),e.jsxs("select",{value:ke,onChange:t=>Se(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",required:!0,children:[e.jsx("option",{value:"Reparación",children:"Reparación"}),e.jsx("option",{value:"Diagnóstico",children:"Diagnóstico"}),e.jsx("option",{value:"Instalación",children:"Instalación"}),e.jsx("option",{value:"Cambio de plan",children:"Cambio de plan"}),e.jsx("option",{value:"Mantenimiento",children:"Mantenimiento"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Prioridad *"}),e.jsxs("select",{value:De,onChange:t=>Re(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",required:!0,children:[e.jsx("option",{value:"Alta",children:"Alta"}),e.jsx("option",{value:"Media",children:"Media"}),e.jsx("option",{value:"Baja",children:"Baja"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Fecha *"}),e.jsx("input",{type:"date",value:Ee,onChange:t=>Te(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Hora inicio *"}),e.jsx("input",{type:"time",value:Me,onChange:t=>Ae(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Hora fin"}),e.jsx("input",{type:"time",value:Ie,onChange:t=>Pe(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Dirección"}),e.jsx("input",{type:"text",placeholder:"Dirección de la visita...",value:ze,onChange:t=>U(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Descripción"}),e.jsx("textarea",{placeholder:"Describe el motivo de la visita...",value:Fe,onChange:t=>re(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm min-h-[80px] resize-y outline-none focus:border-accent-blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block uppercase tracking-wide font-medium",children:"Ticket relacionado (opcional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",placeholder:"Buscar ticket por ID, cliente o descripcion...",value:C,onChange:t=>{J(t.target.value),A(!0),t.target.value||M("")},onFocus:()=>{C.length>=2&&A(!0)},className:"w-full pl-9 bg-bg-secondary border border-border text-text-primary rounded-lg py-2.5 px-3 text-sm outline-none focus:border-accent-blue"}),$e&&e.jsx("button",{type:"button",onClick:()=>{M(""),J(""),A(!1)},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary cursor-pointer bg-transparent border-none p-0",children:e.jsx(xe,{size:14})}),gt&&Qe.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-bg-card border border-border rounded-lg shadow-xl z-50 max-h-[200px] overflow-y-auto",children:Qe.map(t=>e.jsxs("button",{type:"button",onClick:()=>{M(t.id),J(`${t.id} - ${t.clienteNombre} (${t.estado})`),A(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-bg-secondary cursor-pointer border-none bg-transparent text-text-primary transition-colors flex items-center justify-between",children:[e.jsxs("span",{className:"truncate",children:[t.id," - ",t.clienteNombre]}),e.jsx("span",{className:"text-[10px] text-text-muted font-mono ml-2",children:t.estado})]},t.id))})]})]}),e.jsx(S,{value:Ve,onChange:Oe,max:5}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>{N(!1),z()},className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer text-sm hover:text-text-primary transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:!E||!T,className:"flex-1 py-2.5 rounded-lg bg-accent-blue border-none text-white cursor-pointer text-sm font-semibold disabled:opacity-40 disabled:cursor-not-allowed hover:opacity-90 transition-opacity",children:"Crear Visita"})]})]})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 backdrop-blur-sm p-4",onClick:()=>p(null),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-full max-w-[580px] border border-border max-h-[85vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start justify-between mb-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-sm text-text-muted",children:s.id}),e.jsx("h3",{className:"text-lg font-bold mt-1",children:s.clienteNombre})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-lg text-xs font-bold ${D[s.estado]?.bg||""} ${D[s.estado]?.text||""}`,children:s.estado}),e.jsx(st,{getTextFn:()=>at(s,d.find(t=>t.id===s.clienteId)),size:"md",title:"Copiar para WhatsApp"}),e.jsx("button",{onClick:()=>p(null),className:"p-1.5 rounded-lg bg-bg-secondary border border-border text-text-muted cursor-pointer hover:text-text-primary transition-colors",children:e.jsx(xe,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Tipo"}),e.jsx("p",{className:"text-sm font-medium",children:s.tipo})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Prioridad"}),e.jsx("p",{className:`text-sm font-semibold ${he[s.prioridad]?.text||""}`,children:s.prioridad})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Técnico"}),e.jsxs("p",{className:"text-sm font-medium flex items-center gap-1.5",children:[e.jsx(ge,{size:12,className:"text-text-muted"}),s.tecnicoNombre]})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Fecha y Hora"}),e.jsxs("p",{className:"text-sm font-medium flex items-center gap-1.5",children:[e.jsx(be,{size:12,className:"text-text-muted"}),s.fecha," ",s.horaInicio,s.horaFin?` - ${s.horaFin}`:""]})]})]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Dirección"}),e.jsxs("p",{className:"text-sm flex items-center gap-1.5",children:[e.jsx(ue,{size:12,className:"text-text-muted flex-shrink-0"}),s.direccion||"No especificada"]})]}),(()=>{const t=d.find(a=>a.id===s.clienteId);return t?.movil_1?e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Contacto del Cliente"}),e.jsx("p",{className:"text-sm font-mono",children:t.movil_1})]}):null})(),e.jsxs("div",{className:"mb-5",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide font-semibold mb-2 flex items-center gap-1",children:[e.jsx(zt,{size:12})," Detalle del Reporte"]}),e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 border border-border/50",children:[s.descripcion?e.jsx("p",{className:"text-sm text-text-primary leading-relaxed",children:s.descripcion}):e.jsx("p",{className:"text-sm text-text-muted italic",children:"Sin descripción"}),s.adjuntos&&s.adjuntos.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border/50",children:[e.jsx("p",{className:"text-[10px] text-text-muted mb-2",children:"Evidencia Inicial:"}),e.jsx(S,{value:s.adjuntos,onChange:()=>{},readOnly:!0,max:5})]})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide font-semibold flex items-center gap-1",children:[e.jsx(rt,{size:12})," Parámetros Técnicos"]}),!Ce&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>v(!0),className:"p-1 text-text-muted hover:text-accent-blue transition-colors",title:"Editar parámetros",children:e.jsx(Bt,{size:14})}),(o.ping||o.velocidadBajada||o.observaciones)&&e.jsx("button",{onClick:ut,className:"p-1 text-text-muted hover:text-red-400 transition-colors",title:"Limpiar parámetros",children:e.jsx(et,{size:14})})]})]}),Ce?e.jsxs("div",{className:"bg-bg-secondary/30 p-3 rounded-xl border border-accent-blue/30",children:[e.jsx(Ot,{tecnologia:s.tecnologia||d.find(t=>t.id===s.clienteId)?.tecnologia,value:o,onChange:_}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-3 py-1.5 rounded-lg border border-border text-text-secondary text-xs hover:bg-bg-secondary transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:mt,className:"px-3 py-1.5 rounded-lg bg-accent-blue text-white text-xs font-semibold hover:bg-accent-blue/90 transition-colors shadow-lg shadow-accent-blue/20",children:"Guardar Cambios"})]})]}):e.jsx("div",{className:"bg-bg-secondary rounded-lg p-3 border border-border/50",children:o.ping||o.velocidadBajada||o.nivelOLT||o.senalAP||o.observaciones?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(u,{label:"Ping",value:o.ping,unit:"ms"}),e.jsx(u,{label:"Bajada",value:o.velocidadBajada,unit:"Mbps"}),e.jsx(u,{label:"Subida",value:o.velocidadSubida,unit:"Mbps"})]}),(o.nivelOLT||o.nivelONT||o.atenuacion)&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-border/50",children:[e.jsx(u,{label:"Nivel OLT",value:o.nivelOLT,unit:"dBm",warn:parseFloat(o.nivelOLT)<-25}),e.jsx(u,{label:"Nivel ONT",value:o.nivelONT,unit:"dBm",warn:parseFloat(o.nivelONT)<-27}),e.jsx(u,{label:"Atenuación",value:o.atenuacion,unit:"dB"}),e.jsx(u,{label:"Puerto PON",value:o.puertoPON})]}),(o.senalAP||o.senalCPE||o.ccq)&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-border/50",children:[e.jsx(u,{label:"Señal AP",value:o.senalAP,unit:"dBm",warn:parseFloat(o.senalAP)<-70}),e.jsx(u,{label:"Señal CPE",value:o.senalCPE,unit:"dBm",warn:parseFloat(o.senalCPE)<-70}),e.jsx(u,{label:"CCQ",value:o.ccq,unit:"%",warn:parseFloat(o.ccq)<90}),e.jsx(u,{label:"Frecuencia",value:o.frecuencia,unit:"MHz"}),e.jsx(u,{label:"Equipo AP",value:o.equipoAP}),e.jsx(u,{label:"Equipo CPE",value:o.equipoCPE})]}),o.observaciones&&e.jsxs("div",{className:"mt-1 pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-[10px] text-text-muted mb-1",children:"OBSERVACIONES TÉCNICAS"}),e.jsx("p",{className:"text-xs text-text-secondary italic",children:o.observaciones})]})]}):e.jsxs("div",{className:"text-center py-4 text-text-muted",children:[e.jsx(rt,{size:24,className:"mx-auto mb-2 opacity-20"}),e.jsx("p",{className:"text-xs",children:"Sin parámetros registrados"}),e.jsx("button",{onClick:()=>v(!0),className:"mt-2 text-xs text-accent-cyan hover:underline",children:"+ Agregar parámetros"})]})})]}),(s.resultado||s.solucion||s.accionesRealizadas||s.adjuntosResolucion&&s.adjuntosResolucion.length>0)&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("p",{className:"text-[10px] text-green-400 uppercase tracking-wide font-semibold mb-2 flex items-center gap-1",children:[e.jsx(qt,{size:12})," Resolución Técnica"]}),e.jsxs("div",{className:"bg-green-500/5 border border-green-500/20 rounded-lg p-3",children:[(s.resultado||s.solucion)&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-[10px] text-text-muted mb-0.5",children:"Solución / Resultado:"}),e.jsx("p",{className:"text-sm text-text-secondary",children:s.solucion||s.resultado})]}),s.accionesRealizadas&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-[10px] text-text-muted mb-0.5",children:"Acciones Realizadas:"}),e.jsx("p",{className:"text-sm text-text-secondary",children:s.accionesRealizadas})]}),s.adjuntosResolucion&&s.adjuntosResolucion.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-[10px] text-text-muted mb-2",children:"Evidencia de Cierre:"}),e.jsx(S,{value:s.adjuntosResolucion,onChange:()=>{},readOnly:!0,max:5})]})]})]}),s.ticketId&&e.jsxs("div",{className:"bg-bg-secondary rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Ticket Relacionado"}),e.jsx("p",{className:"text-sm font-mono text-accent-blue",children:s.ticketId})]}),s.historial&&s.historial.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-3 font-semibold flex items-center gap-1",children:[e.jsx(Ht,{size:12})," Historial de Actividad"]}),e.jsx("div",{className:"border-l-2 border-border/50 ml-1.5 space-y-6",children:[...s.historial].reverse().map((t,a)=>e.jsxs("div",{className:"relative pl-5",children:[e.jsx("div",{className:`absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full border-2 border-bg-card ${D[t.estadoNuevo]?.dot||"bg-gray-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-text-primary block",children:t.accion||t.estadoNuevo}),t.estadoAnterior&&t.accion&&e.jsxs("span",{className:"text-[10px] text-text-muted",children:[t.estadoAnterior," ",e.jsx(Ut,{size:8,className:"inline mx-0.5"})," ",t.estadoNuevo]})]}),e.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:new Date(t.fecha).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),t.motivo&&e.jsx("div",{className:"bg-bg-secondary/50 rounded p-2 text-xs text-text-secondary mt-1",children:t.motivo}),t.detalles&&e.jsx("p",{className:"text-[10px] text-text-muted mt-1 italic",children:t.detalles}),t.adjuntos&&t.adjuntos.length>0&&e.jsx("div",{className:"mt-2",children:e.jsx(S,{value:t.adjuntos,onChange:()=>{},readOnly:!0,max:3})})]},a))})]}),s.estado==="Programada"&&e.jsx("div",{className:"flex gap-2 mt-3",children:e.jsx("button",{onClick:()=>k(s.id,"En Ruta"),className:"flex-1 py-2 rounded-lg bg-purple-500/20 text-purple-400 text-xs font-semibold cursor-pointer hover:bg-purple-500/30 transition-colors",children:"Iniciar Ruta"})}),s.estado==="En Ruta"&&e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>k(s.id,"Programada"),className:"flex-1 py-2 rounded-lg bg-blue-500/20 text-blue-400 text-xs font-semibold cursor-pointer hover:bg-blue-500/30 transition-colors",children:"Volver a Programada"}),e.jsx("button",{onClick:()=>k(s.id,"En Sitio"),className:"flex-1 py-2 rounded-lg bg-yellow-500/20 text-yellow-400 text-xs font-semibold cursor-pointer hover:bg-yellow-500/30 transition-colors",children:"Marcar En Sitio"})]}),s.estado==="En Sitio"&&e.jsxs("div",{className:"flex flex-col gap-2 mt-3",children:[e.jsx("button",{onClick:()=>k(s.id,"Completada"),className:"w-full py-2 rounded-lg bg-green-500/20 text-green-400 text-xs font-semibold cursor-pointer hover:bg-green-500/30 transition-colors",children:"Completar Visita"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(s.id,"En Ruta"),className:"flex-1 py-2 rounded-lg bg-purple-500/20 text-purple-400 text-xs font-semibold cursor-pointer hover:bg-purple-500/30 transition-colors",children:"Volver a En Ruta"}),e.jsx("button",{onClick:St,className:"flex-1 py-2 rounded-lg bg-blue-500/20 text-blue-400 text-xs font-semibold cursor-pointer hover:bg-blue-500/30 transition-colors",children:"Reprogramar"}),e.jsx("button",{onClick:Rt,className:"flex-1 py-2 rounded-lg bg-orange-500/20 text-orange-400 text-xs font-semibold cursor-pointer hover:bg-orange-500/30 transition-colors",children:"Cliente Ausente"})]}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx("button",{onClick:Mt,className:"flex-1 py-2 rounded-lg bg-amber-500/20 text-amber-400 text-xs font-semibold cursor-pointer hover:bg-amber-500/30 transition-colors",children:"Derivar a Planta Externa"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[s.estado!=="Cancelada"&&s.estado!=="Completada"&&e.jsx("button",{onClick:()=>k(s.id,"Cancelada"),className:"py-2.5 px-4 rounded-lg border border-border text-xs text-text-muted cursor-pointer bg-transparent hover:bg-red-500/10 hover:text-red-400 hover:border-red-500/30 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:()=>At(s.id),className:"py-2.5 px-4 rounded-lg border border-red-500/30 text-xs text-red-400 cursor-pointer bg-transparent hover:bg-red-500/10 transition-colors flex items-center gap-1.5",children:[e.jsx(et,{size:12})," Eliminar"]}),e.jsx("button",{onClick:()=>p(null),className:"flex-1 py-2.5 px-4 rounded-lg bg-bg-secondary border border-border text-text-secondary text-xs cursor-pointer hover:text-text-primary transition-colors",children:"Cerrar"})]})]})}),e.jsx(Vt,{open:ht,onClose:()=>{oe(!1),ne(null)},onConfirm:kt,title:"Completar Visita Tecnica",entityId:w?n.find(t=>t.id===w.visitaId)?.id:"",entityLabel:"Visita",newStatus:"Completada",accentColor:"accent-green"}),ft&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",onClick:()=>W(!1),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-full max-w-[450px] border border-border max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Reprogramar Visita"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block font-medium",children:"Nueva Fecha"}),e.jsx("input",{type:"date",value:I,onChange:t=>_e(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2 px-3 text-sm outline-none focus:border-accent-blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block font-medium",children:"Nueva Hora"}),e.jsx("input",{type:"time",value:P,onChange:t=>Be(t.target.value),className:"w-full bg-bg-secondary border border-border text-text-primary rounded-lg py-2 px-3 text-sm outline-none focus:border-accent-blue"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-text-muted mb-1.5 block font-medium",children:["Motivo ",I&&P?"(opcional)":"(obligatorio si no hay fecha)"]}),e.jsx("textarea",{value:G,onChange:t=>Le(t.target.value),placeholder:"Indica el motivo de la reprogramación...",className:"w-full bg-bg-secondary border border-border text-text-primary p-3 rounded-lg text-sm min-h-[80px] resize-y outline-none focus:border-accent-blue"})]}),e.jsx(S,{value:K,onChange:qe,max:5,label:"Evidencia (opcional)"}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[e.jsx("button",{onClick:()=>W(!1),className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer text-sm hover:text-text-primary transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Dt,disabled:!(I&&P||G.trim()),className:"flex-1 py-2.5 rounded-lg bg-accent-blue border-none text-white cursor-pointer text-sm font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:"Confirmar"})]})]})]})}),jt&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]",onClick:()=>Q(!1),children:e.jsxs("div",{className:"bg-bg-card rounded-2xl p-6 w-[450px] border border-border",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 text-orange-400 flex items-center gap-2",children:[e.jsx(ge,{size:20})," Cliente Ausente"]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("p",{className:"text-xs text-text-secondary",children:["Se registrará la visita como ",e.jsx("strong",{children:"Ausente"}),". Es obligatorio indicar una observación y se recomienda adjuntar evidencia (foto de fachada/medidor)."]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted mb-1.5 block font-medium",children:"Observaciones *"}),e.jsx("textarea",{value:X,onChange:t=>He(t.target.value),placeholder:"Ej: Se tocó timbre por 10 min, se llamó al cliente y no contestó...",className:"w-full bg-bg-secondary border border-border text-text-primary p-3 rounded-lg text-sm min-h-[80px] resize-y outline-none focus:border-accent-blue",autoFocus:!0})]}),e.jsx(S,{value:Z,onChange:Ue,max:5,label:"Evidencia de visita (opcional)"}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[e.jsx("button",{onClick:()=>Q(!1),className:"flex-1 py-2.5 rounded-lg bg-bg-secondary border border-border text-text-secondary cursor-pointer text-sm hover:text-text-primary transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Et,disabled:!X.trim(),className:"flex-1 py-2.5 rounded-lg bg-orange-500 text-white cursor-pointer text-sm font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:"Confirmar Ausencia"})]})]})]})})]})}export{vs as default};
