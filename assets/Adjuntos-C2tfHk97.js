import{c as E,r as v,j as t,F as _,X as I}from"./index-DkxSTD-9.js";import{U as M}from"./upload-Wj2hy97V.js";import{E as S}from"./eye-DvE9GMPz.js";import{D as T}from"./download-360FgciG.js";import{C as B}from"./chevron-right-Cw9tRM1F.js";const W=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],K=E("chevron-left",W);const X=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],q=E("paperclip",X),H=s=>new Promise(g=>{const c=new FileReader;c.readAsDataURL(s),c.onload=f=>{const r=new window.Image;r.src=f.target.result,r.onload=()=>{const a=document.createElement("canvas"),m=1024,j=m/Math.max(r.width,m),x=r.width*j,o=r.height*j;a.width=x,a.height=o,a.getContext("2d").drawImage(r,0,0,x,o);const p=a.toDataURL("image/jpeg",.7),y=Math.round((p.length-"data:image/jpeg;base64,".length)*3/4);g({name:s.name.replace(/\.[^/.]+$/,"")+".jpg",type:"image/jpeg",size:y,dataUrl:p})}}});function Y({value:s=[],onChange:g,max:c=5,label:f,compact:r=!1,readOnly:a=!1}){const m=v.useRef(null),[j,x]=v.useState(!1),[o,d]=v.useState(null),p=e=>{if(a)return;const n=c-s.length;if(n<=0)return;const U=Array.from(e).slice(0,n).map(l=>l.type.startsWith("image/")?H(l):new Promise(L=>{const N=new FileReader;N.onload=()=>{L({name:l.name,type:l.type,size:l.size,dataUrl:N.result})},N.readAsDataURL(l)}));Promise.all(U).then(l=>{g([...s,...l])})},k=e=>{e.target.files.length>0&&(p(e.target.files),e.target.value="")},y=e=>{e.preventDefault(),x(!1),e.dataTransfer.files.length>0&&p(e.dataTransfer.files)},F=e=>{a||g(s.filter((n,w)=>w!==e))},b=e=>e&&e.startsWith("image/"),z=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`,h=s.map((e,n)=>b(e.type)?n:-1).filter(e=>e!==-1),u=h.indexOf(o),C=u>0,D=u<h.length-1,P=e=>{e?.stopPropagation(),C&&d(h[u-1])},$=e=>{e?.stopPropagation(),D&&d(h[u+1])},A=e=>{o!==null&&(e.key==="ArrowLeft"&&P(),e.key==="ArrowRight"&&$(),e.key==="Escape"&&d(null))},R=e=>{if(e?.stopPropagation(),!i)return;const n=document.createElement("a");n.href=i.dataUrl,n.download=i.name,document.body.appendChild(n),n.click(),document.body.removeChild(n)};v.useEffect(()=>{if(o!==null)return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[o,s]);const i=o!==null?s[o]:null;return t.jsxs("div",{children:[f!==!1&&t.jsxs("label",{className:"text-xs text-text-secondary font-medium mb-1.5 block",children:[f||"Adjuntos"," ",t.jsxs("span",{className:"text-text-muted font-normal",children:["(",s.length,"/",c,", opcional)"]})]}),!a&&s.length<c&&t.jsxs("div",{onDragOver:e=>{e.preventDefault(),x(!0)},onDragLeave:()=>x(!1),onDrop:y,onClick:()=>m.current?.click(),className:`border-2 border-dashed rounded-lg cursor-pointer transition-colors flex items-center justify-center gap-2 ${r?"p-2":"p-4"} ${j?"border-accent-blue/60 bg-accent-blue/5":"border-border hover:border-accent-blue/40 bg-bg-secondary/30"}`,children:[t.jsx(M,{size:r?14:16,className:"text-text-muted"}),t.jsx("span",{className:`text-text-muted ${r?"text-[11px]":"text-xs"}`,children:r?"Adjuntar archivos":"Arrastra archivos aqui o haz clic para seleccionar"}),t.jsx("input",{ref:m,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt",onChange:k,className:"hidden"})]}),s.length>0&&t.jsx("div",{className:`flex flex-wrap gap-2 ${!a&&s.length<c?"mt-2":""}`,children:s.map((e,n)=>t.jsxs("div",{className:`relative group bg-bg-secondary rounded-lg border border-border overflow-hidden ${r?"w-16 h-16":"w-20 h-20"} ${b(e.type)?"cursor-pointer":""}`,onClick:()=>b(e.type)&&d(n),children:[b(e.type)?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:e.dataUrl,alt:e.name,className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:t.jsx(S,{size:20,className:"text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-md"})})]}):t.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-1",children:[t.jsx(_,{size:r?16:20,className:"text-text-muted mb-1"}),t.jsx("span",{className:"text-[8px] text-text-muted text-center truncate w-full px-1 leading-tight",children:e.name})]}),t.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 text-[8px] text-white px-1 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity truncate",children:[e.name," (",z(e.size),")"]}),!a&&t.jsx("button",{type:"button",onClick:w=>{w.stopPropagation(),F(n)},className:"absolute top-0.5 right-0.5 w-4 h-4 rounded-full bg-red-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer border-none p-0",children:t.jsx(I,{size:10})})]},n))}),i&&t.jsxs("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4 animate-fade",onClick:()=>d(null),children:[t.jsxs("div",{className:"absolute top-5 right-5 z-10 flex gap-4",children:[t.jsx("button",{className:"text-white/70 hover:text-white bg-transparent border-none cursor-pointer transition-colors",onClick:R,title:"Descargar imagen",children:t.jsx(T,{size:32})}),t.jsx("button",{className:"text-white/70 hover:text-white bg-transparent border-none cursor-pointer transition-colors",onClick:()=>d(null),children:t.jsx(I,{size:32})})]}),C&&t.jsx("button",{onClick:P,className:"absolute left-5 top-1/2 -translate-y-1/2 text-white/70 hover:text-white bg-transparent border-none cursor-pointer p-2 z-10",children:t.jsx(K,{size:48})}),t.jsxs("div",{className:"max-w-5xl max-h-full flex flex-col items-center",onClick:e=>e.stopPropagation(),children:[t.jsx("img",{src:i.dataUrl,alt:i.name,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl"}),t.jsxs("div",{className:"mt-4 text-center",children:[t.jsx("p",{className:"text-white font-medium text-lg",children:i.name}),t.jsxs("p",{className:"text-white/60 text-sm",children:[z(i.size)," ",h.length>1&&`(${u+1} de ${h.length})`]})]})]}),D&&t.jsx("button",{onClick:$,className:"absolute right-5 top-1/2 -translate-y-1/2 text-white/70 hover:text-white bg-transparent border-none cursor-pointer p-2 z-10",children:t.jsx(B,{size:48})})]})]})}function Z({count:s}){return!s||s===0?null:t.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-text-muted",children:[t.jsx(q,{size:10}),s]})}export{Y as A,K as C,q as P,Z as a};
