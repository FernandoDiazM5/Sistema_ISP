import { c as z, a as u, r as o, j as e, M as U, X, U as ye } from "./index-DIKRPrqK.js"; import { K as L } from "./KPICard-Bl-5sFMW.js"; import { P as Ne } from "./phone-CSgEqKjS.js"; import { S as Z } from "./search-BIGsAA0i.js"; import { P as Ce } from "./plus-kuQV4eW5.js"; import { P as we } from "./pen-line-DoB9Rc1E.js"; import { T as Se } from "./trash-2-iPzHOsuE.js"; import { S as ke } from "./sparkles-V2u05z37.js"; import { C as _e } from "./chevron-right-CuLm-tZZ.js"; const Te = [["rect", { width: "14", height: "14", x: "8", y: "8", rx: "2", ry: "2", key: "17jyea" }], ["path", { d: "M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2", key: "zix9uf" }]], Q = z("copy", Te); const ze = [["path", { d: "M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z", key: "10ikf1" }]], Me = z("play", ze); const Pe = [["path", { d: "M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z", key: "1ffxy3" }], ["path", { d: "m21.854 2.147-10.94 10.939", key: "12cjpa" }]], T = z("send", Pe); const Ae = [["rect", { width: "18", height: "18", x: "3", y: "3", rx: "2", key: "afitv7" }]], Ee = z("square", Ae); const Ie = [["path", { d: "M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z", key: "r04s7s" }]], R = z("star", Ie); function $e() { return localStorage.getItem("isp_gemini_api_key") || void 0 || "" } const Le = ["gemini-2.0-flash-exp", "gemini-1.5-flash", "gemini-1.5-pro", "gemini-1.0-pro"], De = { formal: { label: "Formal", emoji: "ðŸ‘”", desc: "Tono profesional y corporativo" }, amigable: { label: "Amigable", emoji: "ðŸ˜Š", desc: "Tono cercano y cÃ¡lido" }, urgente: { label: "Urgente", emoji: "âš¡", desc: "Tono directo y con sentido de urgencia" }, persuasivo: { label: "Persuasivo", emoji: "ðŸŽ¯", desc: "Tono convincente para cobranza" } }; async function Fe(i, a, g = "") {
  if (!i) throw new Error("No hay texto para reescribir"); const b = $e(); if (!b) throw new Error("API Key de Gemini no configurada. Por favor configÃºrala en ConfiguraciÃ³n."); const S = `ActÃºa como un asistente experto de soporte tÃ©cnico y cobranzas para un ISP (Proveedor de Internet).
Tu tarea es reescribir el siguiente mensaje usando un tono: ${a.toUpperCase()}.

${g ? `Contexto del Cliente: ${g}.` : ""}
Mensaje original: "${i}"

Reglas:
1. MantÃ©n las variables importantes (montos, fechas) si existen en el original.
2. SÃ© conciso, profesional y usa buena ortografÃ­a.
3. IMPORTANTE: Solo devuelve el texto del mensaje reescrito, sin comillas, sin introducciones ni explicaciones.`; for (const j of Le) try { const x = `https://generativelanguage.googleapis.com/v1beta/models/${j}:generateContent?key=${b}`, r = await fetch(x, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ contents: [{ parts: [{ text: S }] }] }) }); if (r.status === 404) continue; if (!r.ok) { const h = await r.json().catch(() => ({})); throw new Error(h.error?.message || `Error ${r.status}`) } const v = await r.json(); if (v.candidates?.[0]?.content) return v.candidates[0].content.parts[0].text } catch (x) { console.warn(`Modelo ${j} fallÃ³:`, x) } throw new Error("No se pudo conectar con la IA. Verifica tu API Key y conexiÃ³n.")
} function D(i, a) { const g = new Date, b = g.getHours(), S = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"], j = b >= 19 || b < 5 ? "Buenas noches" : b >= 12 ? "Buenas tardes" : "Buenos dÃ­as"; let x = i.replace(/{Saludo}/g, j).replace(/{Mes}/g, S[g.getMonth()]).replace(/{Anio}/g, String(g.getFullYear())); if (!a) return x.replace(/{Nombre}/g, "").replace(/{([^{}]+)}/g, ""); const r = (a.nombre || "").toLowerCase().replace(/\b\w/g, h => h.toUpperCase()); x = x.replace(/{Nombre}/g, r); const v = { precio: a.precio ? `S/. ${a.precio.toFixed(2)}` : "", plan: a.plan || "", deuda_monto: a.deuda_monto ? `S/. ${a.deuda_monto.toFixed(2)}` : "S/. 0.00", deuda_meses: a.deuda_meses || "0", direccion: a.direccion || "", proximo_pago: a.proximo_pago || "", zona: a.zona || "", movil_1: a.movil_1 || "", estado_cuenta: a.estado_cuenta || "", tecnologia: a.tecnologia || "", ip: a.ip || "" }; return x.replace(/{([^{}]+)}/g, (h, f) => { const k = f.toLowerCase().replace(/\s+/g, "_"); return v[k] !== void 0 ? v[k] : a[f] || h }) } const ee = ["Todas", "Cobranza", "General", "Soporte", "PromociÃ³n"], Oe = [{ key: "{Saludo}", desc: "Buenos dÃ­as/tardes/noches" }, { key: "{Nombre}", desc: "Nombre del cliente" }, { key: "{precio}", desc: "Precio del plan" }, { key: "{plan}", desc: "Plan contratado" }, { key: "{deuda_monto}", desc: "Monto de deuda" }, { key: "{deuda_meses}", desc: "Meses de deuda" }, { key: "{direccion}", desc: "DirecciÃ³n del cliente" }, { key: "{proximo_pago}", desc: "Fecha prÃ³ximo pago" }, { key: "{zona}", desc: "Zona del cliente" }, { key: "{Mes}", desc: "Mes actual" }, { key: "{Anio}", desc: "AÃ±o actual" }]; function Je() {
  const i = u(t => t.clients), a = u(t => t.templates), g = u(t => t.addTemplate), b = u(t => t.updateTemplate), S = u(t => t.deleteTemplate), j = u(t => t.incrementTemplateUse), x = u(t => t.addWhatsappLog), r = u(t => t.whatsappLogs), v = u(t => t.campaignActive), h = u(t => t.setCampaign), [f, k] = o.useState("plantillas"), [M, te] = o.useState(""), [P, se] = o.useState("Todas"), [ae, C] = o.useState(!1), [A, V] = o.useState(null), [m, y] = o.useState({ titulo: "", categoria: "Cobranza", mensaje: "", favorito: !1 }), [n, B] = o.useState(null), [w, oe] = o.useState(null), [p, E] = o.useState(""), [I, G] = o.useState(""), [F, re] = o.useState(""), [W, K] = o.useState(!1), [c, H] = o.useState([]), [N, ne] = o.useState(null), [l, O] = o.useState(0), [_, le] = o.useState("all"), q = o.useMemo(() => { let t = [...a]; if (P !== "Todas" && (t = t.filter(s => s.categoria === P)), M) { const s = M.toLowerCase(); t = t.filter(d => d.titulo.toLowerCase().includes(s) || d.mensaje.toLowerCase().includes(s)) } return t.sort((s, d) => s.favorito !== d.favorito ? s.favorito ? -1 : 1 : (d.uso || 0) - (s.uso || 0)), t }, [a, P, M]), J = o.useMemo(() => { if (!I) return []; const t = I.toLowerCase(); return i.filter(s => s.nombre.toLowerCase().includes(t) || s.movil_1?.includes(t) || s.id.includes(t)).slice(0, 10) }, [i, I]), $ = o.useMemo(() => ({ totalTemplates: a.length, totalSent: r.length, todaySent: r.filter(t => new Date(t.fecha).toDateString() === new Date().toDateString()).length, favorites: a.filter(t => t.favorito).length }), [a, r]), ie = () => { V(null), y({ titulo: "", categoria: "Cobranza", mensaje: "", favorito: !1 }), C(!0) }, ce = t => { V(t), y({ titulo: t.titulo, categoria: t.categoria, mensaje: t.mensaje, favorito: t.favorito }), C(!0) }, de = () => { !m.titulo || !m.mensaje || (A ? b(A.id, m) : g(m), C(!1)) }, xe = t => { confirm("Â¿Eliminar esta plantilla?") && S(t) }, Y = t => { oe(t), E(D(t.mensaje, n)) }, me = t => { B(t), G(""), w && E(D(w.mensaje, t)) }, pe = () => { const t = n?.movil_1 || F; if (!t) return; const s = t.replace(/\D/g, ""), d = `https://wa.me/51${s}?text=${encodeURIComponent(p)}`; window.open(d, "_blank"), w && j(w.id), x({ clienteId: n?.id || "manual", clienteNombre: n?.nombre || `Manual (${s})`, plantilla: w?.titulo || "Manual", mensaje: p, telefono: s }) }, ue = async t => { if (p) { K(!0); try { const s = n ? `Cliente: ${n.nombre}, Deuda: S/. ${n.deuda_monto || 0}, Estado: ${n.estado_cuenta}` : "", d = await Fe(p, t, s); E(d) } catch (s) { alert("Error IA: " + s.message) } K(!1) } }, be = () => { let t = [...i]; if (_ === "deudores" ? t = t.filter(s => s.deuda_monto > 0) : _ === "cortados" ? t = t.filter(s => s.estado_servicio === "Cortado" || s.estado_cuenta === "SUSPENDIDO") : _ === "activos" && (t = t.filter(s => s.status === "ONLINE" || s.estado_cuenta === "ACTIVO")), t = t.filter(s => s.movil_1), t.length === 0) return alert("No hay clientes con nÃºmero de telÃ©fono para esta selecciÃ³n"); H(t), O(0), h({ campaignActive: !0 }) }, he = () => { const t = c[l]; if (!t || !N) return; const s = D(N.mensaje, t), d = t.movil_1.replace(/\D/g, ""), ve = `https://wa.me/51${d}?text=${encodeURIComponent(s)}`; window.open(ve, "_blank"), j(N.id), x({ clienteId: t.id, clienteNombre: t.nombre, plantilla: N.titulo, mensaje: s, telefono: d }), l + 1 < c.length ? O(l + 1) : (h({ campaignActive: !1 }), alert("CampaÃ±a finalizada")) }, ge = () => { h({ campaignActive: !1 }), H([]), O(0) }, fe = t => { y(s => ({ ...s, mensaje: s.mensaje + t })) }, je = [{ id: "plantillas", label: "Plantillas", icon: e.jsx(U, { size: 16 }) }, { id: "enviar", label: "Enviar Mensaje", icon: e.jsx(T, { size: 16 }) }, { id: "campana", label: "CampaÃ±a", icon: e.jsx(ye, { size: 16 }) }, { id: "historial", label: "Historial", icon: e.jsx(Q, { size: 16 }) }]; return e.jsxs("div", {
    className: "animate-fade p-6 px-8 h-full overflow-y-auto", children: [e.jsx("div", { className: "flex justify-between items-center mb-6", children: e.jsxs("div", { children: [e.jsx("h1", { className: "text-[26px] font-bold tracking-tight", children: "WhatsApp & Plantillas" }), e.jsx("p", { className: "text-text-secondary text-sm mt-1", children: "MensajerÃ­a masiva, plantillas y campaÃ±as" })] }) }), e.jsxs("div", { className: "grid grid-cols-4 gap-4 mb-6", children: [e.jsx(L, { title: "Plantillas", value: $.totalTemplates, icon: e.jsx(U, { size: 20 }), color: "#3b82f6" }), e.jsx(L, { title: "Mensajes Enviados", value: $.totalSent, icon: e.jsx(T, { size: 20 }), color: "#10b981" }), e.jsx(L, { title: "Enviados Hoy", value: $.todaySent, icon: e.jsx(Ne, { size: 20 }), color: "#8b5cf6" }), e.jsx(L, { title: "Favoritas", value: $.favorites, icon: e.jsx(R, { size: 20 }), color: "#f59e0b" })] }), e.jsx("div", {
      className: "flex gap-1 mb-6 bg-bg-secondary p-1 rounded-xl w-fit", children: je.map(t => e.jsxs("button", {
        onClick: () => k(t.id), className: `flex items-center gap-1.5 py-2 px-4 rounded-lg text-xs font-semibold cursor-pointer border-none transition-all
3. IMPORTANTE: Solo devuelve el texto del mensaje reescrito, sin comillas, sin introducciones ni explicaciones.`; for(const j of Le)try{ const x = `https://generativelanguage.googleapis.com/v1beta/models/${j}:generateContent?key=${b}`, r=await fetch(x, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ contents: [{ parts: [{ text: S }] }] }) }); if(r.status === 404)continue; if(!r.ok){ const h = await r.json().catch(() => ({})); throw new Error(h.error?.message || `Error ${r.status}`) }const v = await r.json(); if(v.candidates?.[0]?.content)return v.candidates[0].content.parts[0].text
}catch (x) { console.warn(`Modelo ${j} fallÃ³:`, x) } throw new Error("No se pudo conectar con la IA. Verifica tu API Key y conexiÃ³n.")}function D(i, a) { const g = new Date, b = g.getHours(), S = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"], j = b >= 19 || b < 5 ? "Buenas noches" : b >= 12 ? "Buenas tardes" : "Buenos dÃ­as"; let x = i.replace(/{Saludo}/g, j).replace(/{Mes}/g, S[g.getMonth()]).replace(/{Anio}/g, String(g.getFullYear())); if (!a) return x.replace(/{Nombre}/g, "").replace(/{([^{}]+)}/g, ""); const r = (a.nombre || "").toLowerCase().replace(/\b\w/g, h => h.toUpperCase()); x = x.replace(/{Nombre}/g, r); const v = { precio: a.precio ? `S/. ${a.precio.toFixed(2)}` : "", plan: a.plan || "", deuda_monto: a.deuda_monto ? `S/. ${a.deuda_monto.toFixed(2)}` : "S/. 0.00", deuda_meses: a.deuda_meses || "0", direccion: a.direccion || "", proximo_pago: a.proximo_pago || "", zona: a.zona || "", movil_1: a.movil_1 || "", estado_cuenta: a.estado_cuenta || "", tecnologia: a.tecnologia || "", ip: a.ip || "" }; return x.replace(/{([^{}]+)}/g, (h, f) => { const k = f.toLowerCase().replace(/\s+/g, "_"); return v[k] !== void 0 ? v[k] : a[f] || h }) } const ee = ["Todas", "Cobranza", "General", "Soporte", "PromociÃ³n"], Oe = [{ key: "{Saludo}", desc: "Buenos dÃ­as/tardes/noches" }, { key: "{Nombre}", desc: "Nombre del cliente" }, { key: "{precio}", desc: "Precio del plan" }, { key: "{plan}", desc: "Plan contratado" }, { key: "{deuda_monto}", desc: "Monto de deuda" }, { key: "{deuda_meses}", desc: "Meses de deuda" }, { key: "{direccion}", desc: "DirecciÃ³n del cliente" }, { key: "{proximo_pago}", desc: "Fecha prÃ³ximo pago" }, { key: "{zona}", desc: "Zona del cliente" }, { key: "{Mes}", desc: "Mes actual" }, { key: "{Anio}", desc: "AÃ±o actual" }]; function Je() {
  const i = u(t => t.clients), a = u(t => t.templates), g = u(t => t.addTemplate), b = u(t => t.updateTemplate), S = u(t => t.deleteTemplate), j = u(t => t.incrementTemplateUse), x = u(t => t.addWhatsappLog), r = u(t => t.whatsappLogs), v = u(t => t.campaignActive), h = u(t => t.setCampaign), [f, k] = o.useState("plantillas"), [M, te] = o.useState(""), [P, se] = o.useState("Todas"), [ae, C] = o.useState(!1), [A, V] = o.useState(null), [m, y] = o.useState({ titulo: "", categoria: "Cobranza", mensaje: "", favorito: !1 }), [n, B] = o.useState(null), [w, oe] = o.useState(null), [p, E] = o.useState(""), [I, G] = o.useState(""), [F, re] = o.useState(""), [W, K] = o.useState(!1), [c, H] = o.useState([]), [N, ne] = o.useState(null), [l, O] = o.useState(0), [_, le] = o.useState("all"), q = o.useMemo(() => { let t = [...a]; if (P !== "Todas" && (t = t.filter(s => s.categoria === P)), M) { const s = M.toLowerCase(); t = t.filter(d => d.titulo.toLowerCase().includes(s) || d.mensaje.toLowerCase().includes(s)) } return t.sort((s, d) => s.favorito !== d.favorito ? s.favorito ? -1 : 1 : (d.uso || 0) - (s.uso || 0)), t }, [a, P, M]), J = o.useMemo(() => { if (!I) return []; const t = I.toLowerCase(); return i.filter(s => s.nombre.toLowerCase().includes(t) || s.movil_1?.includes(t) || s.id.includes(t)).slice(0, 10) }, [i, I]), $ = o.useMemo(() => ({ totalTemplates: a.length, totalSent: r.length, todaySent: r.filter(t => new Date(t.fecha).toDateString() === new Date().toDateString()).length, favorites: a.filter(t => t.favorito).length }), [a, r]), ie = () => { V(null), y({ titulo: "", categoria: "Cobranza", mensaje: "", favorito: !1 }), C(!0) }, ce = t => { V(t), y({ titulo: t.titulo, categoria: t.categoria, mensaje: t.mensaje, favorito: t.favorito }), C(!0) }, de = () => { !m.titulo || !m.mensaje || (A ? b(A.id, m) : g(m), C(!1)) }, xe = t => { confirm("Â¿Eliminar esta plantilla?") && S(t) }, Y = t => { oe(t), E(D(t.mensaje, n)) }, me = t => { B(t), G(""), w && E(D(w.mensaje, t)) }, pe = () => { const t = n?.movil_1 || F; if (!t) return; let s = t.replace(/\D/g, ""); s.startsWith("51") || (s = "51" + s); const d = `https://wa.me/${s}?text=${encodeURIComponent(p)}`; window.open(d, "_blank"), w && j(w.id), x({ clienteId: n?.id || "manual", clienteNombre: n?.nombre || `Manual (${s})`, plantilla: w?.titulo || "Manual", mensaje: p, telefono: s }) }, ue = async t => { if (p) { K(!0); try { const s = n ? `Cliente: ${n.nombre}, Deuda: S/. ${n.deuda_monto || 0}, Estado: ${n.estado_cuenta}` : "", d = await Fe(p, t, s); E(d) } catch (s) { alert("Error IA: " + s.message) } K(!1) } }, be = () => { let t = [...i]; if (_ === "deudores" ? t = t.filter(s => s.deuda_monto > 0) : _ === "cortados" ? t = t.filter(s => s.estado_servicio === "Cortado" || s.estado_cuenta === "SUSPENDIDO") : _ === "activos" && (t = t.filter(s => s.status === "ONLINE" || s.estado_cuenta === "ACTIVO")), t = t.filter(s => s.movil_1), t.length === 0) return alert("No hay clientes con nÃºmero de telÃ©fono para esta selecciÃ³n"); H(t), O(0), h({ campaignActive: !0 }) }, he = () => { const t = c[l]; if (!t || !N) return; const s = D(N.mensaje, t); let d = t.movil_1.replace(/\D/g, ""); d.startsWith("51") || (d = "51" + d); const ve = `https://wa.me/${d}?text=${encodeURIComponent(s)}`; window.open(ve, "_blank"), j(N.id), x({ clienteId: t.id, clienteNombre: t.nombre, plantilla: N.titulo, mensaje: s, telefono: d }), l + 1 < c.length ? O(l + 1) : (h({ campaignActive: !1 }), alert("CampaÃ±a finalizada")) }, ge = () => { h({ campaignActive: !1 }), H([]), O(0) }, fe = t => { y(s => ({ ...s, mensaje: s.mensaje + t })) }, je = [{ id: "plantillas", label: "Plantillas", icon: e.jsx(U, { size: 16 }) }, { id: "enviar", label: "Enviar Mensaje", icon: e.jsx(T, { size: 16 }) }, { id: "campana", label: "CampaÃ±a", icon: e.jsx(ye, { size: 16 }) }, { id: "historial", label: "Historial", icon: e.jsx(Q, { size: 16 }) }]; return e.jsxs("div", {
    className: "animate-fade p-6 px-8 h-full overflow-y-auto", children: [e.jsx("div", { className: "flex justify-between items-center mb-6", children: e.jsxs("div", { children: [e.jsx("h1", { className: "text-[26px] font-bold tracking-tight", children: "WhatsApp & Plantillas" }), e.jsx("p", { className: "text-text-secondary text-sm mt-1", children: "MensajerÃ­a masiva, plantillas y campaÃ±as" })] }) }), e.jsxs("div", { className: "grid grid-cols-4 gap-4 mb-6", children: [e.jsx(L, { title: "Plantillas", value: $.totalTemplates, icon: e.jsx(U, { size: 20 }), color: "#3b82f6" }), e.jsx(L, { title: "Mensajes Enviados", value: $.totalSent, icon: e.jsx(T, { size: 20 }), color: "#10b981" }), e.jsx(L, { title: "Enviados Hoy", value: $.todaySent, icon: e.jsx(Ne, { size: 20 }), color: "#8b5cf6" }), e.jsx(L, { title: "Favoritas", value: $.favorites, icon: e.jsx(R, { size: 20 }), color: "#f59e0b" })] }), e.jsx("div", {
      className: "flex gap-1 mb-6 bg-bg-secondary p-1 rounded-xl w-fit", children: je.map(t => e.jsxs("button", {
        onClick: () => k(t.id), className: `flex items-center gap-1.5 py-2 px-4 rounded-lg text-xs font-semibold cursor-pointer border-none transition-all
              ${f === t.id ? "bg-bg-card text-text-primary shadow-sm" : "bg-transparent text-text-muted hover:text-text-secondary"}`, children: [t.icon, " ", t.label]
      }, t.id))
    }), f === "plantillas" && e.jsxs(e.Fragment, {
      children: [e.jsxs("div", {
        className: "flex items-center gap-3 mb-4", children: [e.jsxs("div", { className: "flex-1 relative", children: [e.jsx(Z, { size: 14, className: "absolute left-3 top-1/2 -translate-y-1/2 text-text-muted" }), e.jsx("input", { value: M, onChange: t => te(t.target.value), placeholder: "Buscar plantillas...", className: "w-full pl-9 pr-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm" })] }), e.jsx("div", {
          className: "flex gap-1", children: ee.map(t => e.jsx("button", {
            onClick: () => se(t), className: `py-1.5 px-3 rounded-lg text-[11px] font-semibold cursor-pointer border-none transition-all
                    ${P === t ? "bg-accent-blue text-white" : "bg-bg-secondary text-text-muted hover:text-text-secondary"}`, children: t
          }, t))
        }), e.jsxs("button", { onClick: ie, className: "py-2 px-4 rounded-lg bg-accent-green border-none text-white text-xs font-semibold cursor-pointer flex items-center gap-1.5", children: [e.jsx(Ce, { size: 14 }), " Nueva"] })]
      }), e.jsxs("div", { className: "grid grid-cols-3 gap-4", children: [q.map(t => e.jsxs("div", { className: "bg-bg-card rounded-2xl border border-border p-4 flex flex-col", children: [e.jsxs("div", { className: "flex items-start justify-between mb-2", children: [e.jsxs("div", { className: "flex-1 min-w-0", children: [e.jsx("h4", { className: "text-sm font-semibold truncate", children: t.titulo }), e.jsx("span", { className: "text-[10px] text-text-muted bg-bg-secondary py-0.5 px-2 rounded mt-1 inline-block", children: t.categoria })] }), e.jsxs("div", { className: "flex items-center gap-1", children: [t.favorito && e.jsx(R, { size: 14, className: "text-accent-yellow fill-accent-yellow" }), e.jsxs("span", { className: "text-[10px] text-text-muted font-mono", children: [t.uso || 0, "x"] })] })] }), e.jsx("p", { className: "text-[12px] text-text-secondary flex-1 mb-3 line-clamp-3", children: t.mensaje }), e.jsxs("div", { className: "flex gap-1 pt-2 border-t border-border", children: [e.jsxs("button", { onClick: () => { k("enviar"), Y(t) }, className: "flex-1 py-1.5 rounded-lg bg-accent-green/10 text-accent-green text-[11px] font-semibold cursor-pointer border-none", children: [e.jsx(T, { size: 12, className: "inline mr-1" }), " Usar"] }), e.jsx("button", { onClick: () => ce(t), className: "p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-blue", children: e.jsx(we, { size: 12 }) }), e.jsx("button", { onClick: () => b(t.id, { favorito: !t.favorito }), className: "p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-yellow", children: e.jsx(R, { size: 12, className: t.favorito ? "fill-accent-yellow text-accent-yellow" : "" }) }), e.jsx("button", { onClick: () => xe(t.id), className: "p-1.5 rounded-lg bg-bg-secondary text-text-muted cursor-pointer border-none hover:text-accent-red", children: e.jsx(Se, { size: 12 }) })] })] }, t.id)), q.length === 0 && e.jsxs("div", { className: "col-span-3 text-center py-10 text-text-muted", children: [e.jsx(U, { size: 40, className: "mx-auto mb-3 opacity-30" }), e.jsx("p", { className: "text-sm", children: "No hay plantillas" })] })] })]
    }), f === "enviar" && e.jsxs("div", {
      className: "grid grid-cols-2 gap-6", children: [e.jsxs("div", {
        children: [e.jsxs("div", { className: "bg-bg-card rounded-2xl border border-border p-4 mb-4", children: [e.jsx("h3", { className: "text-sm font-semibold mb-3", children: "Seleccionar Cliente" }), n ? e.jsxs("div", { className: "flex items-center justify-between p-3 rounded-xl bg-accent-blue/5 border border-accent-blue/20", children: [e.jsxs("div", { children: [e.jsx("p", { className: "text-sm font-semibold", children: n.nombre }), e.jsxs("p", { className: "text-[11px] text-text-muted font-mono", children: [n.movil_1, " Â· ", n.id] })] }), e.jsx("button", { onClick: () => B(null), className: "p-1 rounded-lg bg-bg-secondary border-none cursor-pointer text-text-muted hover:text-accent-red", children: e.jsx(X, { size: 14 }) })] }) : e.jsxs("div", { className: "relative", children: [e.jsx(Z, { size: 14, className: "absolute left-3 top-1/2 -translate-y-1/2 text-text-muted" }), e.jsx("input", { value: I, onChange: t => G(t.target.value), placeholder: "Buscar por nombre, mÃ³vil o ID...", className: "w-full pl-9 pr-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm" }), J.length > 0 && e.jsx("div", { className: "absolute top-full left-0 right-0 mt-1 bg-bg-card border border-border rounded-xl shadow-lg z-10 max-h-[200px] overflow-y-auto", children: J.map(t => e.jsxs("button", { onClick: () => me(t), className: "w-full text-left p-3 text-sm cursor-pointer bg-transparent border-none hover:bg-bg-secondary transition-colors flex justify-between", children: [e.jsx("span", { className: "font-medium", children: t.nombre }), e.jsx("span", { className: "text-[11px] text-text-muted font-mono", children: t.movil_1 })] }, t.id)) })] }), !n && e.jsxs("div", { className: "mt-3", children: [e.jsx("p", { className: "text-[11px] text-text-muted mb-1.5", children: "O envÃ­o manual:" }), e.jsx("input", { value: F, onChange: t => re(t.target.value), placeholder: "NÃºmero de telÃ©fono (9 dÃ­gitos)", className: "w-full px-4 py-2 rounded-xl bg-bg-secondary border border-border text-sm font-mono" })] })] }), e.jsxs("div", {
          className: "bg-bg-card rounded-2xl border border-border p-4", children: [e.jsx("h3", { className: "text-sm font-semibold mb-3", children: "Seleccionar Plantilla" }), e.jsx("div", {
            className: "flex flex-col gap-1.5 max-h-[250px] overflow-y-auto", children: a.map(t => e.jsxs("button", {
              onClick: () => Y(t), className: `text-left p-3 rounded-xl text-xs cursor-pointer border transition-all
                      ${w?.id === t.id ? "border-accent-blue bg-accent-blue/5" : "border-border bg-bg-secondary hover:border-border"}`, children: [e.jsxs("div", { className: "flex items-center justify-between", children: [e.jsx("span", { className: "font-semibold", children: t.titulo }), e.jsx("span", { className: "text-[10px] text-text-muted", children: t.categoria })] }), e.jsx("p", { className: "text-[11px] text-text-muted mt-1 truncate", children: t.mensaje })]
            }, t.id))
          })]
        })]
      }), e.jsxs("div", { children: [e.jsxs("div", { className: "bg-bg-card rounded-2xl border border-border p-4 mb-4", children: [e.jsx("h3", { className: "text-sm font-semibold mb-3", children: "Vista Previa del Mensaje" }), e.jsx("textarea", { value: p, onChange: t => E(t.target.value), rows: 8, className: "w-full p-4 rounded-xl bg-bg-secondary border border-border text-sm resize-none font-mono", placeholder: "Selecciona una plantilla o escribe un mensaje..." }), e.jsxs("div", { className: "mt-3", children: [e.jsxs("p", { className: "text-[11px] text-text-muted mb-2 flex items-center gap-1", children: [e.jsx(ke, { size: 12 }), " Reescribir con IA (Gemini)"] }), e.jsx("div", { className: "flex gap-1.5", children: Object.entries(De).map(([t, s]) => e.jsx("button", { onClick: () => ue(t), disabled: W || !p, className: "py-1.5 px-3 rounded-lg bg-bg-secondary border border-border text-[11px] font-semibold cursor-pointer hover:border-accent-purple disabled:opacity-40 disabled:cursor-not-allowed transition-colors", children: W ? "..." : `${s.emoji} ${s.label}` }, t)) })] })] }), e.jsxs("button", { onClick: pe, disabled: !p || !n?.movil_1 && !F, className: "w-full py-3 rounded-xl bg-accent-green border-none text-white text-sm font-bold cursor-pointer flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-40 disabled:cursor-not-allowed transition-opacity", children: [e.jsx(T, { size: 18 }), "Enviar por WhatsApp"] }), e.jsxs("button", { onClick: () => { p && navigator.clipboard.writeText(p) }, disabled: !p, className: "w-full mt-2 py-2.5 rounded-xl bg-bg-secondary border border-border text-text-secondary text-xs font-semibold cursor-pointer flex items-center justify-center gap-2 hover:border-accent-blue disabled:opacity-40 disabled:cursor-not-allowed transition-colors", children: [e.jsx(Q, { size: 14 }), "Copiar texto al portapapeles"] })] })]
    }), f === "campana" && e.jsx("div", {
      children: v ? e.jsxs("div", {
        className: "bg-bg-card rounded-2xl border border-accent-blue/30 p-6", children: [e.jsxs("div", { className: "flex items-center justify-between mb-4", children: [e.jsxs("h3", { className: "text-sm font-semibold flex items-center gap-2", children: [e.jsx("div", { className: "w-2 h-2 rounded-full bg-accent-green animate-pulse" }), "CampaÃ±a en Curso"] }), e.jsxs("span", { className: "text-xs text-text-muted font-mono", children: [l + 1, " / ", c.length] })] }), e.jsx("div", { className: "w-full h-2 bg-bg-secondary rounded-full mb-4 overflow-hidden", children: e.jsx("div", { className: "h-full bg-accent-blue rounded-full transition-all", style: { width: `${(l + 1) / c.length * 100}%` } }) }), c[l] && e.jsxs("div", {
          className: "bg-bg-secondary rounded-xl p-4 mb-4", children: [e.jsxs("div", {
            className: "flex items-center justify-between mb-2", children: [e.jsxs("div", { children: [e.jsx("p", { className: "text-sm font-bold", children: c[l].nombre }), e.jsxs("p", { className: "text-[11px] text-text-muted font-mono", children: [c[l].movil_1, " Â· ", c[l].zona] })] }), e.jsx("span", {
              className: `py-1 px-2.5 rounded-lg text-[10px] font-bold
                      ${c[l].deuda_monto > 0 ? "bg-accent-red/15 text-accent-red" : "bg-accent-green/15 text-accent-green"}`, children: c[l].deuda_monto > 0 ? `Deuda: S/. ${c[l].deuda_monto}` : "Al dÃ­a"
            })]
          }), e.jsx("div", { className: "bg-bg-card rounded-lg p-3 text-xs text-text-secondary font-mono", children: D(N.mensaje, c[l]) })]
        }), e.jsxs("div", { className: "flex gap-3", children: [e.jsxs("button", { onClick: he, className: "flex-1 py-2.5 rounded-xl bg-accent-green border-none text-white text-sm font-bold cursor-pointer flex items-center justify-center gap-2", children: [e.jsx(T, { size: 16 }), " Enviar y Siguiente", e.jsx(_e, { size: 16 })] }), e.jsxs("button", { onClick: ge, className: "py-2.5 px-6 rounded-xl bg-accent-red/10 border border-accent-red/30 text-accent-red text-sm font-semibold cursor-pointer flex items-center gap-2", children: [e.jsx(Ee, { size: 14 }), " Detener"] })] })]
      }) : e.jsxs("div", {
        className: "bg-bg-card rounded-2xl border border-border p-6", children: [e.jsx("h3", { className: "text-sm font-semibold mb-4", children: "Configurar CampaÃ±a Masiva" }), e.jsxs("div", {
          className: "grid grid-cols-2 gap-6", children: [e.jsxs("div", {
            children: [e.jsx("label", { className: "text-xs text-text-muted mb-2 block", children: "Filtro de Clientes" }), e.jsx("div", {
              className: "flex flex-col gap-2", children: [{ value: "all", label: "Todos los clientes", count: i.filter(t => t.movil_1).length }, { value: "deudores", label: "Clientes con deuda", count: i.filter(t => t.deuda_monto > 0 && t.movil_1).length }, { value: "cortados", label: "Cortados / Suspendidos", count: i.filter(t => (t.estado_servicio === "Cortado" || t.estado_cuenta === "SUSPENDIDO") && t.movil_1).length }, { value: "activos", label: "Clientes activos", count: i.filter(t => (t.status === "ONLINE" || t.estado_cuenta === "ACTIVO") && t.movil_1).length }].map(t => e.jsxs("label", {
                className: `flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all
                          ${_ === t.value ? "border-accent-blue bg-accent-blue/5" : "border-border bg-bg-secondary"}`, children: [e.jsx("input", { type: "radio", name: "campFilter", value: t.value, checked: _ === t.value, onChange: () => le(t.value), className: "accent-accent-blue" }), e.jsx("span", { className: "text-sm font-medium flex-1", children: t.label }), e.jsx("span", { className: "text-xs text-text-muted font-mono", children: t.count })]
              }, t.value))
            })]
          }), e.jsxs("div", {
            children: [e.jsx("label", { className: "text-xs text-text-muted mb-2 block", children: "Plantilla para la campaÃ±a" }), e.jsx("div", {
              className: "flex flex-col gap-1.5 max-h-[200px] overflow-y-auto", children: a.map(t => e.jsxs("button", {
                onClick: () => ne(t), className: `text-left p-3 rounded-xl text-xs cursor-pointer border transition-all
                          ${N?.id === t.id ? "border-accent-green bg-accent-green/5" : "border-border bg-bg-secondary"}`, children: [e.jsx("span", { className: "font-semibold", children: t.titulo }), e.jsx("p", { className: "text-[11px] text-text-muted truncate mt-0.5", children: t.mensaje })]
              }, t.id))
            })]
          })]
        }), e.jsxs("button", { onClick: be, disabled: !N, className: "mt-6 w-full py-3 rounded-xl bg-accent-blue border-none text-white text-sm font-bold cursor-pointer flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-40 disabled:cursor-not-allowed transition-opacity", children: [e.jsx(Me, { size: 18 }), "Iniciar CampaÃ±a"] })]
      })
    }), f === "historial" && e.jsxs("div", { className: "bg-bg-card rounded-2xl border border-border overflow-hidden", children: [e.jsx("div", { className: "py-4 px-6 border-b border-border", children: e.jsxs("h3", { className: "text-sm font-semibold", children: ["Historial de EnvÃ­os (", r.length, ")"] }) }), e.jsx("div", { className: "max-h-[500px] overflow-y-auto", children: e.jsxs("table", { className: "w-full text-[13px]", children: [e.jsx("thead", { children: e.jsxs("tr", { className: "text-left text-[11px] text-text-muted uppercase bg-bg-secondary sticky top-0", children: [e.jsx("th", { className: "py-3 px-4", children: "Fecha" }), e.jsx("th", { className: "py-3 px-4", children: "Cliente" }), e.jsx("th", { className: "py-3 px-4", children: "Plantilla" }), e.jsx("th", { className: "py-3 px-4", children: "TelÃ©fono" }), e.jsx("th", { className: "py-3 px-4", children: "Mensaje" })] }) }), e.jsxs("tbody", { children: [r.map(t => e.jsxs("tr", { className: "border-b border-border", children: [e.jsx("td", { className: "py-3 px-4 text-text-muted text-xs", children: new Date(t.fecha).toLocaleString("es-PE", { dateStyle: "short", timeStyle: "short" }) }), e.jsx("td", { className: "py-3 px-4 font-medium", children: t.clienteNombre }), e.jsx("td", { className: "py-3 px-4", children: e.jsx("span", { className: "text-[11px] bg-accent-blue/10 text-accent-blue py-0.5 px-2 rounded", children: t.plantilla }) }), e.jsx("td", { className: "py-3 px-4 font-mono text-xs", children: t.telefono }), e.jsx("td", { className: "py-3 px-4 text-text-secondary text-xs truncate max-w-[250px]", children: t.mensaje })] }, t.id)), r.length === 0 && e.jsx("tr", { children: e.jsx("td", { colSpan: 5, className: "py-10 text-center text-text-muted", children: "No hay envÃ­os registrados" }) })] })] }) })] }), ae && e.jsx("div", { className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center", onClick: () => C(!1), children: e.jsxs("div", { className: "bg-bg-card rounded-2xl border border-border w-[550px] max-h-[85vh] overflow-y-auto", onClick: t => t.stopPropagation(), children: [e.jsxs("div", { className: "p-5 border-b border-border flex items-center justify-between", children: [e.jsx("h3", { className: "text-sm font-bold", children: A ? "Editar Plantilla" : "Nueva Plantilla" }), e.jsx("button", { onClick: () => C(!1), className: "p-1 rounded-lg bg-bg-secondary border-none cursor-pointer text-text-muted hover:text-text-primary", children: e.jsx(X, { size: 16 }) })] }), e.jsxs("div", { className: "p-5 flex flex-col gap-4", children: [e.jsxs("div", { children: [e.jsx("label", { className: "text-xs text-text-muted mb-1.5 block", children: "TÃ­tulo" }), e.jsx("input", { value: m.titulo, onChange: t => y(s => ({ ...s, titulo: t.target.value })), className: "w-full px-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm", placeholder: "Ej: Cobro Mensual" })] }), e.jsxs("div", { children: [e.jsx("label", { className: "text-xs text-text-muted mb-1.5 block", children: "CategorÃ­a" }), e.jsx("select", { value: m.categoria, onChange: t => y(s => ({ ...s, categoria: t.target.value })), className: "w-full px-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm", children: ee.filter(t => t !== "Todas").map(t => e.jsx("option", { value: t, children: t }, t)) })] }), e.jsxs("div", { children: [e.jsx("label", { className: "text-xs text-text-muted mb-1.5 block", children: "Mensaje" }), e.jsx("textarea", { value: m.mensaje, onChange: t => y(s => ({ ...s, mensaje: t.target.value })), rows: 5, className: "w-full px-4 py-2.5 rounded-xl bg-bg-secondary border border-border text-sm resize-none font-mono", placeholder: "Escribe el mensaje con variables..." })] }), e.jsxs("div", { children: [e.jsx("label", { className: "text-xs text-text-muted mb-1.5 block", children: "Insertar Variable" }), e.jsx("div", { className: "flex flex-wrap gap-1", children: Oe.map(t => e.jsx("button", { onClick: () => fe(t.key), title: t.desc, className: "py-1 px-2 rounded-lg bg-accent-blue/10 text-accent-blue text-[10px] font-mono font-semibold cursor-pointer border-none hover:bg-accent-blue/20 transition-colors", children: t.key }, t.key)) })] }), e.jsxs("label", { className: "flex items-center gap-2 cursor-pointer", children: [e.jsx("input", { type: "checkbox", checked: m.favorito, onChange: t => y(s => ({ ...s, favorito: t.target.checked })), className: "accent-accent-yellow" }), e.jsx("span", { className: "text-xs font-medium", children: "Marcar como favorita" })] })] }), e.jsxs("div", { className: "p-5 border-t border-border flex justify-end gap-2", children: [e.jsx("button", { onClick: () => C(!1), className: "py-2 px-5 rounded-lg bg-bg-secondary border border-border text-text-secondary text-sm cursor-pointer", children: "Cancelar" }), e.jsx("button", { onClick: de, disabled: !m.titulo || !m.mensaje, className: "py-2 px-5 rounded-lg bg-accent-blue border-none text-white text-sm font-semibold cursor-pointer disabled:opacity-40", children: A ? "Guardar Cambios" : "Crear Plantilla" })] })] }) })]
  })
} export { Je as default };
