import{c as T,u as _,a as E,r as o,j as e,W as L,T as O,C as R}from"./index-DBbpf6L9.js";import{l as U}from"./authAPI-B3Wh5n12.js";import{M as P}from"./mail-DGHwbYFA.js";import{E as B}from"./eye-off-mPTzlF71.js";import{E as M}from"./eye-BC8INoTL.js";const V=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],A=T("lock",V);function J(){const{login:g}=_(),h=E(t=>t.loadCurrentUserByEmail),k=E(t=>t.getUserByUid),[i,y]=o.useState("email"),[p,C]=o.useState(""),[b,I]=o.useState(""),[f,S]=o.useState(!1),[v,l]=o.useState(""),[c,n]=o.useState(!1),[d,x]=o.useState(""),u=o.useRef(!1),m=o.useRef(null),j=o.useCallback(async t=>{try{n(!0),l("");const r=JSON.parse(atob(t.credential.split(".")[1])),a=r.email,s=await h(a);if(!s){l("No tienes autorización para acceder a este sistema. Contacta al administrador."),n(!1);return}if(!s.activo){l("Tu cuenta ha sido desactivada. Contacta al administrador."),n(!1);return}g({email:s.email,nombre:s.nombre,foto:s.foto||r.picture,rol:s.rol,uid:s.uid,permisos:s.permisos}),n(!1)}catch(r){l("Error al procesar el inicio de sesión. Intenta nuevamente."),console.error("Error en login:",r),n(!1)}},[g,h]);o.useEffect(()=>{let t,r=0;const a=20,s=()=>{const N=R.GOOGLE_CLIENT_ID;if(u.current)return!0;if(!N)return x("No se encontró el GOOGLE_CLIENT_ID. Si limpiaste la caché del navegador, necesitas volver a configurarlo en el archivo .env o en localStorage."),!0;if(!window.google||!window.google.accounts)return r++,r>=a?(x("No se pudo cargar el servicio de Google. Verifica tu conexión a internet o intenta recargar la página."),!0):!1;try{return window.google.accounts.id.initialize({client_id:N,callback:j,ux_mode:"popup"}),u.current=!0,x(""),!0}catch(G){return console.error("Error al inicializar Google:",G),x("Error al inicializar Google OAuth. Verifica la configuración del Client ID."),!0}},w=()=>{s()||(t=setTimeout(w,500))};return w(),()=>{clearTimeout(t),u.current=!1}},[j]),o.useEffect(()=>{if(i!=="google"||!m.current||d)return;let t,r=0;const a=()=>{if(u.current&&window.google&&window.google.accounts){m.current.innerHTML="";try{window.google.accounts.id.renderButton(m.current,{type:"standard",theme:"filled_black",size:"large",text:"continue_with",shape:"pill",width:360,locale:"es"})}catch(s){console.error("Error renderizando boton de google:",s)}}else r++,r<20&&(t=setTimeout(a,500))};return a(),()=>clearTimeout(t)},[i,d]);const z=async t=>{if(t.preventDefault(),!p||!b){l("Por favor completa todos los campos");return}try{n(!0),l("");const r=await U(p,b);if(!r.success){l(r.error),n(!1);return}const a=await k(r.uid);if(!a){l("Usuario no encontrado en el sistema. Contacta al administrador."),n(!1);return}if(!a.activo){l("Tu cuenta ha sido desactivada. Contacta al administrador."),n(!1);return}g({email:a.email,nombre:a.nombre,foto:a.foto,rol:a.rol,uid:a.uid,permisos:a.permisos}),n(!1)}catch(r){console.error("Error en login:",r),l("Error al iniciar sesión. Intenta nuevamente."),n(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",style:{background:"radial-gradient(ellipse at 20% 50%, #0f172a 0%, #0a0e1a 50%, #050709 100%)"},children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:"linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px)",backgroundSize:"60px 60px"}}),e.jsx("div",{className:"absolute top-[20%] left-[15%] w-[300px] h-[300px] rounded-full",style:{background:"radial-gradient(circle, rgba(59,130,246,0.08) 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute bottom-[20%] right-[15%] w-[400px] h-[400px] rounded-full",style:{background:"radial-gradient(circle, rgba(139,92,246,0.06) 0%, transparent 70%)"}}),e.jsxs("div",{className:"animate-fade w-full max-w-[420px] mx-4 p-6 sm:p-10 rounded-[20px] relative z-10",style:{background:"linear-gradient(145deg, rgba(26,32,53,0.9) 0%, rgba(17,24,39,0.95) 100%)",border:"1px solid rgba(59,130,246,0.15)",boxShadow:"0 25px 80px rgba(0,0,0,0.5), 0 0 60px rgba(59,130,246,0.05)",backdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center text-white",style:{background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",boxShadow:"0 8px 32px rgba(59,130,246,0.3)"},children:e.jsx(L,{size:28})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight mb-1",children:"ISP Sistema de Gestión"}),e.jsx("p",{className:"text-text-secondary text-sm",children:"Radio Enlace · Fibra Óptica · IPTV"})]}),e.jsxs("div",{className:"flex gap-2 mb-6 p-1 bg-bg-secondary rounded-xl",children:[e.jsx("button",{onClick:()=>y("email"),className:`flex-1 py-2 px-4 rounded-lg text-xs font-semibold transition-all border-none cursor-pointer ${i==="email"?"bg-accent-blue text-white shadow-sm":"bg-transparent text-text-secondary hover:text-text-primary"}`,children:"Email y Contraseña"}),e.jsx("button",{onClick:()=>y("google"),className:`flex-1 py-2 px-4 rounded-lg text-xs font-semibold transition-all border-none cursor-pointer ${i==="google"?"bg-accent-blue text-white shadow-sm":"bg-transparent text-text-secondary hover:text-text-primary"}`,children:"Google OAuth"})]}),i==="email"&&e.jsxs("form",{onSubmit:z,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-1.5",children:"Correo Electrónico"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"email",value:p,onChange:t=>C(t.target.value),placeholder:"tu-email@ejemplo.com",className:"w-full py-2.5 pl-10 pr-4 bg-bg-secondary border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted transition-colors",disabled:c})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-1.5",children:"Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:f?"text":"password",value:b,onChange:t=>I(t.target.value),placeholder:"••••••••",className:"w-full py-2.5 pl-10 pr-10 bg-bg-secondary border border-border rounded-lg text-sm text-text-primary outline-none focus:border-accent-blue placeholder:text-text-muted transition-colors",disabled:c}),e.jsx("button",{type:"button",onClick:()=>S(!f),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors bg-transparent border-none cursor-pointer p-0",children:f?e.jsx(B,{size:16}):e.jsx(M,{size:16})})]})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 px-5 rounded-xl text-white border-none text-sm font-semibold cursor-pointer transition-opacity hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed mt-2",style:{background:"linear-gradient(135deg, #3b82f6, #6366f1)"},children:c?"Verificando...":"Iniciar Sesión"})]}),i==="google"&&e.jsx("div",{className:"flex flex-col gap-4",children:d?e.jsxs("div",{className:"flex flex-col items-center gap-3 py-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/15 flex items-center justify-center",children:e.jsx(O,{size:24,className:"text-amber-400"})}),e.jsx("p",{className:"text-xs text-amber-300 text-center leading-relaxed max-w-[320px]",children:d}),e.jsxs("p",{className:"text-[11px] text-text-muted text-center leading-relaxed",children:["Usa la pestaña ",e.jsx("strong",{className:"text-text-secondary",children:"Email y Contraseña"})," como alternativa, o configura el ",e.jsx("code",{className:"bg-bg-secondary px-1.5 py-0.5 rounded text-accent-cyan text-[10px]",children:"VITE_GOOGLE_CLIENT_ID"})," en tu archivo ",e.jsx("code",{className:"bg-bg-secondary px-1.5 py-0.5 rounded text-accent-cyan text-[10px]",children:".env"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-text-secondary text-center mb-2",children:"Inicia sesión con tu cuenta de Google autorizada"}),c?e.jsx("div",{className:"w-full py-3 text-center text-sm text-text-secondary",children:"Verificando..."}):e.jsx("div",{ref:m,className:"flex justify-center"})]})}),v&&e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-accent-red/10 border border-accent-red/20",children:e.jsx("p",{className:"text-xs text-accent-red text-center leading-relaxed",children:v})}),e.jsx("p",{className:"mt-6 text-[11px] text-text-muted text-center",children:"Solo usuarios autorizados pueden acceder"})]})]})}export{J as default};
